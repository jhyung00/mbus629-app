<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced ROE Masterclass</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --secondary: #0ea5e9;
            --accent: #f43f5e;
            --accent-gradient: linear-gradient(135deg, #f43f5e 0%, #fb7185 100%);
            --success: #10b981;
            --success-gradient: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --error: #ef4444;
            --dark-box: #1e1b4b;
            --dark-gradient: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            --formula-bg: #fff9db; 
            --bg-color: #f8fafc;
            --text-color: #334155;
            --text-light: #94a3b8;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(99, 102, 241, 0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #app-container {
            width: 100%;
            max-width: 1300px;
            height: 95vh;
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            position: relative;
            box-shadow: var(--shadow-lg);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.6);
        }

        .slide {
            display: none;
            flex: 1;
            padding: 2.5rem 3rem;
            overflow-y: auto;
            flex-direction: column;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-soft {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; color: var(--dark-box); line-height: 1.2; }
        h1 { font-size: 3rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1.2rem; }
        h2 { font-size: 2.2rem; margin-bottom: 1.2rem; position: relative; display: inline-block; }
        h2::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 50px; height: 5px; background: var(--accent-gradient); border-radius: 3px; }

        p, li { font-size: 1.05rem; line-height: 1.6; margin-bottom: 0.8rem; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; align-items: start; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.2rem; }

        .card { background: var(--white); padding: 1.8rem; border-radius: 20px; box-shadow: var(--shadow-sm); border: 1px solid #e2e8f0; height: 100%; transition: transform 0.2s; }
        .card-dark { background: var(--dark-gradient); color: var(--white); padding: 2rem; border-radius: 20px; position: relative; overflow: hidden; box-shadow: var(--shadow-lg); }
        .card-highlight { border-left: 8px solid var(--accent); background: white; padding: 2rem; border-radius: 20px; box-shadow: var(--shadow-sm); }

        .eq-box { background: #f1f5f9; padding: 15px; border-radius: 12px; font-family: 'Fira Code', monospace; margin: 10px 0; border-left: 6px solid var(--secondary); color: var(--dark-box); font-size: 1rem; }
        .card-dark .eq-box { background: rgba(0, 0, 0, 0.3); border-color: var(--white); color: var(--white); }

        .formula-card-styled { background: var(--formula-bg); border: 1px solid #e9ecef; padding: 20px; border-radius: 16px; color: #333; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }

        .btn { background: var(--primary-gradient); color: white; border: none; padding: 12px 24px; border-radius: 50px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-family: 'Space Grotesk'; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3); }
        .btn-success { background: var(--success-gradient); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #curriculum-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--glass); backdrop-filter: blur(15px); z-index: 1000; display: none; padding: 4rem; overflow-y: auto; }
        .toc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
        .toc-btn { background: white; border: 1px solid #e2e8f0; padding: 12px; border-radius: 12px; text-align: left; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; font-size: 0.9rem; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .toc-btn:hover { background: #f0f9ff; border-color: var(--secondary); transform: translateX(5px); }
        .toc-num { background: var(--primary-gradient); color: white; width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 0.7rem; flex-shrink: 0; }

        .bs-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: white; padding: 20px; border-radius: 20px; box-shadow: var(--shadow-sm); }
        .bs-column h3 { text-align: center; font-size: 0.8rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .bs-item { padding: 8px 12px; margin: 4px 0; border: 2px solid #f1f5f9; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; font-weight: 600; transition: 0.2s; font-size: 0.85rem; }
        .bs-item.selected { background: #e0f2fe; border-color: var(--secondary); color: var(--secondary); }
        .bs-item.correct { background: #d1fae5; border-color: var(--success); color: #065f46; }
        .bs-item.wrong { background: #fee2e2; border-color: var(--error); color: #991b1b; }

        .is-table { width: 100%; border-collapse: separate; border-spacing: 0 2px; }
        .is-table td { padding: 8px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; }
        .is-total { font-weight: 800; background: #f8fafc; color: var(--primary); }

        #nav-bar { background: rgba(255,255,255,0.9); padding: 0.8rem 2rem; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #e2e8f0; z-index: 100; position: relative; }
        .progress-bar { flex: 1; height: 6px; background: #e2e8f0; margin: 0 20px; border-radius: 10px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--accent-gradient); width: 0%; transition: width 0.4s; }

        .flip-container { perspective: 1000px; cursor: pointer; height: 280px; }
        .flip-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-container.flipped .flip-inner { transform: rotateY(180deg); }
        .flip-front, .flip-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; box-shadow: var(--shadow-sm); }
        .flip-front { background: var(--dark-gradient); color: white; border: 1px solid rgba(255,255,255,0.1); }
        .flip-back { transform: rotateY(180deg); background: white; border: 4px solid var(--primary); color: var(--text-color); }

        .strategy-chart { position: relative; height: 320px; border-left: 3px solid #94a3b8; border-bottom: 3px solid #94a3b8; margin: 20px; background: radial-gradient(circle at center, rgba(99, 102, 241, 0.05) 0%, transparent 70%); }
        .strategy-circle { width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; font-weight: bold; position: absolute; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: center; border: 2px solid rgba(255,255,255,0.3); z-index: 5; font-size: 0.8rem; }
        .curve-line { position: absolute; width: 100%; height: 100%; border: 3px dashed #cbd5e0; border-radius: 0 0 0 100%; border-top: none; border-right: none; top: 0; left: 0; pointer-events: none; }

        .lever-viz { display:flex; align-items:flex-end; height: 180px; justify-content:center; gap: 20px; margin-top: 10px; }
        .lever-bar { width:60px; display:flex; flex-direction:column; justify-content:flex-end; transition: height 0.3s; border-radius: 8px 8px 0 0; position:relative; }

        .bullet-point { opacity: 0 !important; transition: 0.5s; transform: translateX(-15px); list-style: none; margin-bottom: 8px; padding: 10px; border-left: 4px solid var(--success); background: rgba(255,255,255,0.1); display: flex; align-items: center; font-size: 0.95rem; }
        .bullet-point::before { content: '✨'; margin-right: 12px; }
        .bullet-visible { opacity: 1 !important; transform: translateX(0); }

        .text-center { text-align: center; }
        .text-white { color: white !important; -webkit-text-fill-color: white !important; }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }
        .text-accent { color: var(--accent); }
        .text-primary { color: var(--primary) !important; -webkit-text-fill-color: var(--primary) !important;}
        .text-secondary { color: var(--secondary) !important; -webkit-text-fill-color: var(--secondary) !important;}
        .font-bold { font-weight: 800; }
        .mt-4 { margin-top: 1.5rem; }

        .def-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
        .def-table td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.85rem; text-align: left; vertical-align: top; }
        .def-table .label { font-weight: 800; color: #a5b4fc; width: 80px; }
        .def-table .name { font-weight: 600; color: white; width: 200px; }
        .def-table .formula { font-family: 'Fira Code', monospace; color: #e2e8f0; font-size: 0.8rem; }

        .scenario-footer { margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px dashed rgba(255,255,255,0.2); display: flex; justify-content: space-around; }
        .scenario-footer div { text-align: center; }
        .scenario-footer p { font-size: 0.7rem; margin-bottom: 3px; font-family: 'Fira Code', monospace; color: #a5b4fc; }
        .scenario-footer h5 { font-size: 0.8rem; color: white; font-family: 'Fira Code', monospace; }
    </style>
</head>
<body>

<div id="app-container">

    <!-- Curriculum Overlay -->
    <div id="curriculum-overlay">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2>Masterclass Curriculum</h2>
            <button class="btn" style="background: var(--error);" onclick="toggleCurriculum()">Close <i class="fas fa-times"></i></button>
        </div>
        <div id="toc-grid" class="toc-grid"></div>
    </div>

    <!-- Slide 1: Hook Story -->
    <div class="slide active">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
            <div class="card-dark" style="padding: 3.5rem; text-align: center; max-width: 950px; border-radius: 40px; animation: pulse-soft 3s infinite ease-in-out;">
                <h1 class="text-white">A Tale of Two 40% ROEs</h1>
                <div class="grid-2 mt-4">
                    <!-- The Software Sage (Operations) -->
                    <div class="flip-container" onclick="this.classList.toggle('flipped')">
                        <div class="flip-inner" style="height:100%">
                            <div class="flip-front" style="background: rgba(255,255,255,0.1); border: 2px solid var(--success);">
                                <i class="fas fa-code fa-3x mb-3 text-success"></i>
                                <h3 class="text-white">The Software Sage</h3>
                                <p class="text-white" style="font-size: 0.9rem;">High Margin, Zero Debt.</p>
                                <p style="font-size: 0.7rem; opacity: 0.7;">(Click to see engine)</p>
                            </div>
                            <div class="flip-back">
                                <p style="font-size: 0.95rem;">Earns $4M on $10M Equity. Every cent of that 40% ROE comes from pure operational brilliance. This is <strong>Operating Return</strong>.</p>
                            </div>
                        </div>
                    </div>
                    <!-- The Debt Dealer (Leverage) -->
                    <div class="flip-container" onclick="this.classList.toggle('flipped')">
                        <div class="flip-inner" style="height:100%">
                            <div class="flip-front" style="background: rgba(255,255,255,0.1); border: 2px solid var(--accent);">
                                <i class="fas fa-balance-scale-right fa-3x mb-3 text-accent"></i>
                                <h3 class="text-white">The Debt Dealer</h3>
                                <p class="text-white" style="font-size: 0.9rem;">Low Margin, Heavy Debt.</p>
                                <p style="font-size: 0.7rem; opacity: 0.7;">(Click to see engine)</p>
                            </div>
                            <div class="flip-back">
                                <p style="font-size: 0.95rem;">Has only $1M equity but borrowed $9M to control $10M in assets. The return is mostly <strong>Non-operating Return</strong>. One bad year and they vanish.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-4" style="background: rgba(255,255,255,0.15); border: none; padding: 1.5rem;">
                    <p class="text-white" style="font-size: 1.1rem; margin: 0;"><strong>The Truth:</strong> Traditional ROE sees them as twins. Advanced Analysis reveals one is an artisan, the other is a risk-architect. Ready to decode the difference?</p>
                </div>
                <button class="btn mt-4" style="background: white; color: var(--primary);" onclick="nextSlide()">Analyze the Engines <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Slide 2: Core Problem -->
    <div class="slide">
        <h2>The Conflation Problem</h2>
        <div class="grid-2">
            <div>
                <p>Advanced Analysis separates the firm into two distinct activity buckets:</p>
                <div class="card card-highlight" style="border-left-color: var(--secondary); margin-bottom: 15px;">
                    <h3 class="text-secondary">1. Operating Engine</h3>
                    <p>Creating products and services. Measures how well the core business generates cash.</p>
                </div>
                <div class="card card-highlight" style="border-left-color: var(--accent);">
                    <h3 class="text-accent">2. Financing Choices (NNO)</h3>
                    <p>Deciding how much debt to take vs. how much cash to hold. Measures risk and capital structure.</p>
                </div>
            </div>
            <div class="card-dark text-center">
                <i class="fas fa-exclamation-circle fa-3x mb-4 opacity-50"></i>
                <h3 class="text-white">Traditional View</h3>
                <p class="eq-box" style="font-size: 1.6rem; background: rgba(0,0,0,0.2); border: none; color: white;">ROE = Net Income / Avg Equity</p>
                <p class="text-white">This hides whether a company is an artisan or a risk-architect.</p>
            </div>
        </div>
    </div>

    <!-- Slide 3: Concept: NOA -->
    <div class="slide">
        <h2>Concept: Net Operating Assets (NOA)</h2>
        <p>Before looking at financing, we must isolate the <strong>Operating Engine's</strong> capital base.</p>
        <div class="card-dark text-center" style="margin-bottom: 20px;">
            <h3 class="text-white" style="font-size: 1.8rem;">NOA = Operating Assets - Operating Liabilities</h3>
        </div>
        <div class="grid-2">
            <div class="card">
                <h4 class="text-primary">Operating Assets</h4>
                <p>Assets required to run the core business daily.</p>
                <ul style="padding-left: 20px; font-size: 0.9rem;">
                    <li>Inventory & Accounts Receivable</li>
                    <li>Property, Plant & Equipment (Net)</li>
                    <li>Right of Use Assets</li>
                    <li>Intangible Assets & Goodwill</li>
                </ul>
            </div>
            <div class="card">
                <h4 class="text-secondary">Operating Liabilities</h4>
                <p><strong>Non-interest bearing</strong> obligations that arise from operations (not borrowing).</p>
                <ul style="padding-left: 20px; font-size: 0.9rem;">
                    <li>Accounts Payable</li>
                    <li>Accrued Expenses & Wages</li>
                    <li>Unearned (Deferred) Revenue</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Slide 4: Concept: NNO -->
    <div class="slide">
        <h2>Concept: Net Nonoperating Obligations (NNO)</h2>
        <p>In Advanced DuPont, we look at our <strong>Net Financing Position</strong> by netting cash against debt.</p>
        <div class="card-dark text-center" style="margin-bottom: 20px;">
            <h3 class="text-white" style="font-size: 1.8rem;">NNO = Nonoperating Liabilities - Nonoperating Assets</h3>
        </div>
        <div class="grid-2">
            <div class="card">
                <h4 class="text-accent">Nonoperating Liabilities</h4>
                <p>Interest-bearing obligations used to fund the company.</p>
                <ul style="padding-left: 20px; font-size: 0.9rem;">
                    <li>Short-term & Long-term Debt</li>
                    <li>Bonds Payable</li>
                    <li>Lease Obligation</li>
                </ul>
            </div>
            <div class="card">
                <h4 class="text-secondary">Nonoperating Assets</h4>
                <p>Cash and investments NOT needed for daily operations.</p>
                <ul style="padding-left: 20px; font-size: 0.9rem;">
                    <li>Cash & Excess Cash</li>
                    <li>Marketable Securities</li>
                    <li>Short-term Investments</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Slide 5: Activity: Filter the Core -->
    <div class="slide">
        <h2>Activity: Filter the Core</h2>
        <p>Select items that belong to the <strong>Core Operating Engine</strong>. Leave NNO (Financing) items unselected.</p>
        <div class="bs-container">
            <div class="bs-column">
                <h3>Assets</h3>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Inventory</span> <span>$200</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Cash & Excess Cash</span> <span>$550</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>PPE (Factories)</span> <span>$800</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Right of Use Asset</span> <span>$150</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Goodwill</span> <span>$150</span></div>
            </div>
            <div class="bs-column">
                <h3>Liabilities & Equity</h3>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Accounts Payable</span> <span>$80</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Long-term Bonds</span> <span>$400</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Lease Obligation</span> <span>$120</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Unearned Revenue</span> <span>$20</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Equity</span> <span>$1,100</span></div>
            </div>
        </div>
        <div class="text-center mt-4">
            <button class="btn" onclick="checkBS()">Check Classification</button>
            <p id="bs-feedback" class="mt-2 font-bold"></p>
        </div>
    </div>

    <!-- Slide 6: Pfizer NOA Case Study -->
    <div class="slide">
        <h2>Case Study: Pfizer's NOA (2022)</h2>
        <div class="grid-2">
            <div class="card">
                <h3>The Calculation ($M)</h3>
                <table class="is-table">
                    <tr><td>Total Operating Assets</td><td class="text-right">$170,437</td></tr>
                    <tr><td>(Less) Operating Liabilities</td><td class="text-right">($59,939)</td></tr>
                    <tr class="is-total"><td>Net Operating Assets (NOA)</td><td class="text-right">$110,498</td></tr>
                </table>
                <p class="mt-4" style="font-size: 0.9rem; color: var(--text-light);">*Interest-bearing Debt and Net Cash were removed to isolate the core capital base.</p>
            </div>
            <div class="card-dark text-center flex-center" style="display:flex; flex-direction:column; justify-content:center;">
                <i class="fas fa-calculator fa-3x mb-4 text-white"></i>
                <h3 class="text-white">Net Operating Assets</h3>
                <h1 style="color: white; -webkit-text-fill-color: white; font-size: 3rem;">$110.5B</h1>
                <p class="text-white" style="opacity: 0.8;">The "True" capital running the business.</p>
            </div>
        </div>
    </div>

    <!-- Slide 7: Concept: NOPAT Shield Logic -->
    <div class="slide">
        <h2>The NOPAT Tax Logic</h2>
        <p>Net Operating Profit After Tax (NOPAT) removes the tax distortion caused by debt and cash.</p>
        <div class="grid-2">
            <div class="card card-highlight" style="border-left-color: var(--accent);">
                <h3 class="text-accent">Scenario 1: Net Non-Op Expense</h3>
                <p>Interest Expense lowers taxable income. <strong>Your operating income is higher than taxable income</strong> (that was used to calculate Net Income).</p>
                <div class="eq-box">Operating Tax > Reported Tax</div>
            </div>
            <div class="card card-highlight" style="border-left-color: var(--success);">
                <h3 class="text-success">Scenario 2: Net Non-Op Income</h3>
                <p>Interest Income raises taxable income. <strong>Your operating income is lower than taxable income</strong> (that was used to calculate Net Income).</p>
                <div class="eq-box">Operating Tax < Reported Tax</div>
            </div>
        </div>
    </div>

    <!-- Slide 8: Method 1: Top Down -->
    <div class="slide">
        <h2>Method 1: Top Down NOPAT</h2>
        <p>Start from the operating profit before tax and apply the true operating tax.</p>
        <div class="card-dark">
            <h3 class="text-white">The Formula</h3>
            <div class="eq-box" style="font-size: 1.5rem; text-align: center;">
                NOPAT = NOPBT - Taxes on Operating Income
            </div>
            <div style="margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                <p class="text-white"><strong>Taxes on Operating Income</strong> = Reported Tax + <span class="text-accent font-bold">Tax Shield</span></p>
                <p class="text-white" style="margin-top: 10px;">Where <span class="text-accent font-bold">Tax Shield</span> = Net Non-Op Expense &times; Tax Rate</p>
                <p class="text-white" style="font-size: 0.9rem; margin-top: 15px; color: #cbd5e0;">
                    <i class="fas fa-shield-alt mr-2"></i> This adjustment accounts for the tax shield due to net-non operating expense (you paid less tax due to this).
                </p>
            </div>
        </div>
    </div>

    <!-- Slide 9: Method 2: Bottom Up -->
    <div class="slide">
        <h2>Method 2: Bottom Up NOPAT</h2>
        <p>Start from Net Income and "add back" the financing impact net of tax.</p>
        <div class="card-dark">
            <h3 class="text-white">The Equation</h3>
            <div class="eq-box" style="font-size: 1.8rem; text-align: center; margin: 2rem 0;">
                NOPAT = NI + [Net Non-Op Exp &times; (1 - Tax Rate)]
            </div>
            <p class="text-white">Because Net Income is an <strong>after-tax</strong> number, we must add back the <strong>after-tax</strong> cost of interest.</p>
            <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px;">
                <p class="text-white" style="font-size: 0.95rem; opacity: 0.9;">
                    <i class="fas fa-info-circle mr-1"></i> By adding this back, you are effectively <strong>removing the financing impact</strong> from Net Income to isolate the core engine.
                </p>
            </div>
        </div>
    </div>

    <!-- Slide 10: Scenario 1: Net Non-Op Expense Case -->
    <div class="slide">
        <h2>Scenario 1: Net Non-Op Expense Case</h2>
        <div class="grid-2">
            <div class="card">
                <h3>Data: Debt Co.</h3>
                <ul class="mt-4">
                    <li>NOPBT: $1,000</li>
                    <li>Interest Expense: $100</li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: $720</li>
                    <li>Reported Tax: $180</li>
                </ul>
            </div>
            <div class="card-dark">
                <h3 class="text-white">Calculated Result</h3>
                <div style="margin: 20px 0;">
                    <h1 class="text-success" style="font-size: 3.5rem;">NOPAT = $800</h1>
                    <p class="text-white" style="opacity: 0.8;">Both methodologies converge here:</p>
                </div>
                <div class="scenario-footer">
                    <div>
                        <p>Top Down Formula</p>
                        <h5>$1,000 - ($180 + $20 Shield)</h5>
                    </div>
                    <div>
                        <p>Bottom Up Formula</p>
                        <h5>$720 + ($100 &times; 0.8)</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 11: Scenario 2: Net Non-Op Income Case -->
    <div class="slide">
        <h2>Scenario 2: Net Non-Op Income Case</h2>
        <div class="grid-2">
            <div class="card">
                <h3>Data: Cash Co.</h3>
                <ul class="mt-4">
                    <li>NOPBT: $1,000</li>
                    <li>Interest <em>Income</em>: $100</li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: $880</li>
                    <li>Reported Tax: $220</li>
                </ul>
            </div>
            <div class="card-dark">
                <h3 class="text-white">Calculated Result</h3>
                <div style="margin: 20px 0;">
                    <h1 class="text-success" style="font-size: 3.5rem;">NOPAT = $800</h1>
                    <p class="text-white" style="opacity: 0.8;">Non-op income is successfully removed:</p>
                </div>
                <div class="scenario-footer">
                    <div>
                        <p>Top Down Formula</p>
                        <h5>$1,000 - ($220 - $20 ExtraTax)</h5>
                    </div>
                    <div>
                        <p>Bottom Up Formula</p>
                        <h5>$880 - ($100 &times; 0.8)</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 12: Pfizer NOPAT Study -->
    <div class="slide">
        <h2>Case Study: Pfizer's NOPAT (2022)</h2>
        <div class="card">
            <table class="is-table">
                <tr><td>Operating Profit (NOPBT)</td><td class="text-right">$34,719</td></tr>
                <tr><td>Reported Tax Expense</td><td class="text-right">$3,328</td></tr>
                <tr><td class="text-accent">Tax Shield Adjustment (from NNE)</td><td class="text-right">($2)</td></tr>
                <tr class="is-total"><td>= Taxes on Operating Income</td><td class="text-right">$3,326</td></tr>
                <tr style="background: var(--dark-gradient); color: white; font-weight: bold; font-size: 1.2rem;">
                    <td class="text-white">NOPAT (Net Operating Profit After Tax)</td><td class="text-right text-white">$31,393</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Slide 13: RNOA Reveal -->
    <div class="slide">
        <h2>The Result: RNOA</h2>
        <p>Combining NOPAT and NOA gives us the "Truth Teller" of performance.</p>
        <div class="eq-box" style="text-align: center; font-size: 1.8rem; border-color: var(--primary);">
            <span class="text-primary">R</span><span class="text-accent">N</span><span class="text-primary">OA</span> = NOPAT / Average NOA
        </div>
        <div class="grid-2 mt-4">
            <div class="card-dark text-center" style="border: 2px solid var(--accent);">
                <h3 class="text-white">Traditional <span class="text-primary">RO</span><span class="text-secondary">A</span></h3>
                <h1 style="font-size: 4rem;" class="text-white">16.6%</h1>
                <p class="text-white">Diluted by excess cash and debt.</p>
            </div>
            <div class="card-dark text-center" style="border: 2px solid var(--success);">
                <h3 class="text-white">Advanced <span class="text-primary">R</span><span class="text-accent">N</span><span class="text-primary">OA</span></h3>
                <h1 class="text-success" style="-webkit-text-fill-color: var(--success); font-size: 4rem;">32.1%</h1>
                <p class="text-white">Pure Operating Efficiency.</p>
            </div>
        </div>
    </div>

    <!-- Slide 14: Drivers (NOPM & NOAT) -->
    <div class="slide">
        <h2>Decomposing RNOA</h2>
        <div class="grid-2">
            <div class="card-dark" style="border-left: 10px solid var(--primary);">
                <h3 class="text-white"><span class="text-accent">NO</span><span class="text-secondary">PM</span></h3>
                <p class="text-white">Net Operating Profit Margin</p>
                <div class="eq-box">NOPAT / Sales</div>
            </div>
            <div class="card-dark" style="border-left: 10px solid var(--secondary);">
                <h3 class="text-white"><span class="text-accent">NO</span><span class="text-secondary">AT</span></h3>
                <p class="text-white">Net Operating Asset Turnover</p>
                <div class="eq-box">Sales / Avg NOA</div>
            </div>
        </div>
        <div class="strategy-chart mt-4">
            <div class="curve-line"></div>
            <!-- Industry Data Points -->
            <div class="strategy-circle" style="background: var(--primary-gradient); top: 10px; left: 160px;">
                <span>Consumer Staples</span>
                <span style="font-size: 0.6rem;">High Turn / Low Margin</span>
            </div>
            <div class="strategy-circle" style="background: var(--accent-gradient); bottom: 60px; right: 50px;">
                <span>Semiconductors</span>
                <span style="font-size: 0.6rem;">Low Turn / High Margin</span>
            </div>
            <div class="strategy-circle" style="background: var(--secondary); bottom: 100px; right: 150px; border-style: solid; border-width: 4px; border-color: white;">
                <span>Pfizer</span>
                <span style="font-size: 0.7rem;">31% Margin</span>
            </div>
            <div style="position: absolute; bottom: -25px; right: 0; font-weight: bold; color: var(--text-light);">Margin (<span class="text-accent">NO</span><span class="text-secondary">PM</span>) &rarr;</div>
            <div style="position: absolute; top: 0; left: -25px; font-weight: bold; color: var(--text-light); transform: rotate(-90deg);">Turnover (<span class="text-accent">NO</span><span class="text-secondary">AT</span>) &rarr;</div>
        </div>
    </div>

    <!-- Slide 15: ANALYSIS DECISION -->
    <div class="slide">
        <h2>ANALYSIS DECISION: You Are the CEO</h2>
        <div class="card card-highlight">
            <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                You are analyzing the performance of your company. Your analysis of RNOA reveals the following (industry benchmarks in parentheses): 
                <strong>RNOA is 16% (10%)</strong>, <strong>NOPM is 18% (17%)</strong>, and <strong>NOAT is 0.89 (0.59)</strong>. 
                <br><br>
                What interpretations do you draw that are useful for managing your company?
            </p>
            <button class="btn btn-success" onclick="toggleCEOAnswer()">Reveal Strategy Analysis</button>
            <div id="ceo-answer" style="display: none; margin-top: 2rem; padding: 1.5rem; background: #f0fdf4; border-radius: 12px; border: 1px solid #bcf0da;">
                <p><strong>Suggested Analysis:</strong> Your company is performing substantially better than its competitors. Namely, your RNOA of 16% is markedly superior to competitors' RNOA of 10%.</p>
                <p>However, RNOA disaggregation shows that this is <strong>mainly attributed to your NOAT of 0.89</strong> versus competitors' NOAT of 0.59. Your NOPM of 18% is essentially identical to competitors' NOPM of 17%.</p>
                <p><strong>Management upshot:</strong> You will want to maintain your high NOAT as further improvements are probably difficult to achieve. Importantly, you are likely to achieve the greatest benefit with efforts at <strong>improving your NOPM of 18%</strong>, which is only marginally better than the industry norm.</p>
            </div>
        </div>
    </div>

    <!-- Slide 16: ROE Decomposition Definitions -->
    <div class="slide">
        <h2>ROE = Operating Return + Non-operating Return</h2>
        <p>A surgical breakdown of exactly how returns are created.</p>
        <div class="card-dark" style="padding: 2.5rem 2rem; min-height: 520px; height: auto;">
            <h3 class="text-white" style="font-size: 1.8rem; margin-bottom: 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px;">ROE = <span class="text-primary">R</span><span class="text-accent">N</span><span class="text-primary">OA</span> + (FLEV &times; Spread)</h3>
            <table class="def-table">
                <tr>
                    <td class="label">NNO</td>
                    <td class="name">Net nonoperating obligations</td>
                    <td class="formula">Nonoperating liabilities – Nonoperating assets</td>
                </tr>
                <tr>
                    <td class="label">FLEV</td>
                    <td class="name">Financial leverage</td>
                    <td class="formula">Average NNO / Average total stockholders’ equity</td>
                </tr>
                <tr>
                    <td class="label">NNE</td>
                    <td class="name">Net nonoperating expense</td>
                    <td class="formula">NOPAT – Total net income; or [Nonoperating expenses &times; (1 – Statutory TR)]</td>
                </tr>
                <tr>
                    <td class="label">NNEP</td>
                    <td class="name">Net nonoperating expense %</td>
                    <td class="formula">NNE / Average NNO</td>
                </tr>
                <tr>
                    <td class="label">Spread</td>
                    <td class="name">Operational Spread</td>
                    <td class="formula">RNOA – NNEP</td>
                </tr>
            </table>
            <div class="grid-2 mt-4">
                <div style="font-size: 0.85rem; color: #a5b4fc; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px;">
                    <strong>FLEV Interpretation:</strong> Net debt (debt net of cash and investments) relative to shareholders' investment.
                </div>
                <div style="font-size: 0.85rem; color: #fb7185; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px;">
                    <strong>Spread Interpretation:</strong> Difference between what net operating assets earn and what net debt costs.
                </div>
            </div>
        </div>
        
        <div class="grid-2 mt-4">
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner" style="height:100%">
                    <div class="flip-front" style="background: var(--primary-gradient);">
                        <h4 class="text-white">Strategy 1: Increase FLEV</h4>
                        <p class="text-white" style="font-size: 0.8rem; opacity: 0.8;">Borrowing more proportionately.</p>
                    </div>
                    <div class="flip-back">
                        <p>Increase FLEV by borrowing more, which increases NNO relative to equity. This multiplies the Operational Spread for shareholders.</p>
                    </div>
                </div>
            </div>
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner" style="height:100%">
                    <div class="flip-front" style="background: var(--accent-gradient);">
                        <h4 class="text-white">Strategy 2: Increase Spread</h4>
                        <p class="text-white" style="font-size: 0.8rem; opacity: 0.8;">Borrowing at a lower cost.</p>
                    </div>
                    <div class="flip-back">
                        <p>Lower interest costs decrease NNEP and increase the Operational Spread, allowing stockholders to enjoy higher returns for every dollar borrowed.</p>
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-top: 1.5rem; padding: 1rem; border-radius: 12px; background: #eff6ff; border: 1px solid #dbeafe;">
            <p style="font-size: 0.9rem; margin: 0; color: #1e40af; text-align: center;">
                <strong>Upshot:</strong> If a company can borrow more funds at the same rate or borrow at a lower rate, stockholders enjoy a higher ROE.
            </p>
        </div>
    </div>

    <!-- Slide 17: Leverage Simulator -->
    <div class="slide">
        <h2>Leverage Simulator (Pfizer Case Study)</h2>
        <p>See how Pfizer's massive positive spread turns small leverage into an ROE powerhouse.</p>
        
        <div class="formula-card-styled" style="margin-bottom: 1.5rem; position: relative; padding: 30px;">
            <div style="display: flex; justify-content: center; align-items: center; font-size: 1.1rem; gap: 8px; font-weight: 700;">
                <span style="flex-shrink:0;">Nonoperating return =</span>
                <!-- FLEV Column -->
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div style="display: flex; flex-direction: column; align-items: center; min-width: 140px;">
                        <div style="border-bottom: 2px solid #333; padding: 0 10px;">Average NNO</div>
                        <div>Average EQ</div>
                    </div>
                    <div style="color: #f43f5e; margin-top: 8px; font-size: 0.85rem; font-weight: 800;">
                        <i class="fas fa-long-arrow-alt-up"></i><br>FLEV
                    </div>
                </div>
                <span style="padding-bottom: 45px;">&times;</span>
                <!-- Spread Column -->
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div style="padding: 10px 0;">(RNOA - NNEP)</div>
                    <div style="color: #f43f5e; margin-top: 8px; font-size: 0.85rem; font-weight: 800;">
                        <i class="fas fa-long-arrow-alt-up"></i><br>Spread
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.2rem; background: #f8fafc; padding: 1rem;">
            <div class="grid-3">
                <div class="text-center">
                    <p style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 2px;">RNOA</p>
                    <h3 class="text-primary" style="margin: 0;">32.1%</h3>
                </div>
                <div class="text-center" style="border-left: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                     <p style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 2px;">Net Nonop Cost</p>
                    <h3 style="margin: 0;">~0%</h3>
                </div>
                <div class="text-center">
                     <p style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 2px;">Spread</p>
                    <h3 class="text-success" style="margin: 0;">~32%</h3>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; align-items:center; gap:20px; margin-bottom: 15px;">
                <label class="font-bold" style="font-size: 0.9rem;">Adjust FLEV (Net Debt / Equity):</label>
                <input type="range" id="flev-slider" min="0" max="1.5" step="0.05" value="0.13" oninput="updateSim()" style="flex:1;">
                <span id="flev-val" class="font-bold text-primary">0.13</span>
            </div>
            <div class="lever-viz">
                <div style="text-align:center;">
                    <div class="lever-bar" style="height: 120px; background: var(--primary-gradient); width: 70px;">
                        <span style="position:absolute; top:-25px; left:0; width:100%; color: var(--primary); font-weight:bold; font-size:0.8rem;">32.1%</span>
                    </div>
                    <p style="margin-top:8px; font-weight:bold; font-size:0.85rem;">RNOA</p>
                </div>
                <div style="font-size: 1.5rem; padding-bottom: 40px;">+</div>
                <div style="text-align:center;">
                    <div id="sim-boost-bar" class="lever-bar" style="height: 20px; background: var(--accent-gradient); width: 70px;">
                        <span id="sim-boost-text" style="position:absolute; top:-30px; left:0; width:100%; color: var(--accent); font-weight:bold; font-size:0.8rem;">4.2%</span>
                    </div>
                    <p style="margin-top:8px; font-weight:bold; font-size:0.85rem;">Boost</p>
                </div>
                <div style="font-size: 1.5rem; padding-bottom: 40px;">=</div>
                <div style="text-align:center;">
                    <div id="sim-roe-bar" class="lever-bar" style="height: 140px; background: var(--success-gradient); width: 85px;">
                        <span id="sim-roe-text" style="position:absolute; top:-30px; left:0; width:100%; color: var(--success); font-size:1.2rem; font-weight:bold;">36.3%</span>
                    </div>
                    <p style="margin-top:8px; font-weight:bold; font-size:0.85rem;">ROE</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 18: Apple Case Study (Flip Card) -->
    <div class="slide">
        <h2>Case Study: Apple (Cash Drag)</h2>
        <div class="flex-center" style="height: 400px; display:flex; justify-content:center; align-items:center;">
            <div class="flip-container" onclick="this.classList.toggle('flipped')" style="width: 600px;">
                <div class="flip-inner" style="height:100%">
                    <div class="flip-front">
                        <i class="fab fa-apple fa-4x mb-4 text-white"></i>
                        <h3 class="text-white">Apple 2022</h3>
                        <div class="grid-2 mt-4" style="width: 100%;">
                            <div style="text-align:center;">
                                <h1 class="text-white">865%</h1>
                                <p class="text-white" style="font-size: 0.8rem;">RNOA</p>
                            </div>
                            <div style="text-align:center;">
                                <h1 class="text-white">176%</h1>
                                <p class="text-white" style="font-size: 0.8rem;">ROE</p>
                            </div>
                        </div>
                        <p class="mt-4 text-white" style="opacity: 0.8;">(Click to see why ROE is lower than RNOA)</p>
                    </div>
                    <div class="flip-back" style="padding: 2.5rem; display:flex; flex-direction:column; justify-content:center;">
                        <h3 class="text-error">The Cash Drag</h3>
                        <p>Apple holds massive cash reserves (~$100B+) that earn very low returns (2-4%).</p>
                        <p>When you blend <strong>865% Operating Return</strong> with <strong>2% Cash Return</strong>, the overall ROE is "dragged" down.</p>
                        <div class="eq-box" style="border-left-color: var(--error);">This is called <strong>Negative Leverage</strong>.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 19: Strategic Summary -->
    <div class="slide">
        <h2>Strategic Management Summary</h2>
        <div class="card-dark" style="min-height: 400px;">
            <ul style="padding: 0;">
                <li class="bullet-point text-white">
                    <strong>The Operational Truth:</strong> Disaggregation forces you to check if high returns are driven by raw performance (RNOA) or just a low-cost debt multiplier.
                </li>
                <li class="bullet-point text-white">
                    <strong>Efficiency vs. Engineering:</strong> Superior managers generate ROE through NOPM and NOAT, rather than relying on financial engineering through FLEV.
                </li>
                <li class="bullet-point text-white">
                    <strong>The Leverage Trap:</strong> Debt only creates value when Operational Spread is positive. If RNOA falls below interest rates, leverage destroys value faster than it built it.
                </li>
                <li class="bullet-point text-white">
                    <strong>Safety's Opportunity Cost:</strong> Cash Drag (ROE < RNOA) reveals the hidden cost of liquidity. Managers must choose between the safety of cash and the high returns of reinvestment.
                </li>
                <li class="bullet-point text-white">
                    <strong>Diagnostic Benchmarking:</strong> Use RNOA disaggregation to find specifically where competitors are beating you—is it pricing power (NOPM) or speed of sales (NOAT)?
                </li>
            </ul>
        </div>
        <div class="text-center mt-4">
            <button class="btn" style="background: white; color: var(--primary);" onclick="revealSummary()">Reveal Strategic Insights</button>
        </div>
    </div>

    <!-- Quizzes (20-27) -->
    <div class="slide">
        <h2>Quiz 1: Classification</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">Accounts Payable is a(n):</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Operating Liability</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Nonoperating Liability</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 2: Tax Logic</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">For a company with high debt (Net Expense), NOPAT is found by:</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Adding back the tax shield</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Subtracting the tax shield</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 3: ROE vs RNOA</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">If RNOA > ROE, the company likely has:</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">High Debt</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Excess Cash (Cash Drag)</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 4: NOA Calculation</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">Calc NOA: Op Assets = 500, Op Liab = 200, Excess Cash = 100.</p>
            <input type="number" id="q4-input" class="fib-input mt-4" placeholder="Enter NOA value...">
            <button class="btn mt-4" onclick="checkQ4()">Submit</button>
            <p id="q4-fb" class="mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 5: Business Models</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">A high-end luxury brand usually has:</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">High Margin, Low Turnover</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Low Margin, High Turnover</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 6: Spread Meaning</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">If Spread is 0, ROE will be:</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Equal to RNOA</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Zero</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 7: Apple Logic</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">Holding $100B in cash at 2% returns while Ops earn 30% is:</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Value Enhancing</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Return Dilutive (Cash Drag)</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 8: Pure NOPAT</h2>
        <div class="card">
            <p style="font-size: 1.3rem;">If a company has Zero NNO (Debt = Cash), NOPAT is:</p>
            <div class="grid-2 mt-4">
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Equal to Net Income</button>
                <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Zero</button>
            </div>
            <p class="quiz-feedback mt-4 text-center font-bold"></p>
        </div>
    </div>

    <!-- Slide 28: Completion -->
    <div class="slide">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
            <div class="card-dark text-center" style="padding: 5rem; border-radius: 40px;">
                <i class="fas fa-trophy fa-5x text-warning mb-4"></i>
                <h1 class="text-white">Masterclass Complete</h1>
                <p class="text-white mt-4" style="font-size: 1.2rem;">You've mastered Advanced DuPont Analysis.</p>
                <button class="btn mt-4" style="background: white; color: var(--primary);" onclick="location.reload()">Restart Course</button>
            </div>
        </div>
    </div>

    <!-- Nav Bar -->
    <div id="nav-bar">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="font-weight: 800; color: var(--primary); font-size: 0.9rem;">ADVANCED ROE</div>
            <button class="btn" style="padding: 6px 12px; font-size: 0.7rem; border-radius: 6px;" onclick="toggleCurriculum()"><i class="fas fa-list mr-1"></i> Curriculum</button>
        </div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div>
            <button class="btn" style="padding: 8px 16px; background: white; color: black; border: 1px solid #ccc;" onclick="prevSlide()">Back</button>
            <button class="btn" style="padding: 8px 16px;" onclick="nextSlide()">Next</button>
        </div>
    </div>

</div>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;

    function updateNav() {
        slides.forEach((s, i) => s.classList.toggle('active', i === currentSlide));
        const progress = ((currentSlide + 1) / totalSlides) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        window.scrollTo(0, 0);
    }

    function nextSlide() { if(currentSlide < totalSlides - 1) { currentSlide++; updateNav(); } }
    function prevSlide() { if(currentSlide > 0) { currentSlide--; updateNav(); } }
    function jumpToSlide(i) { currentSlide = i; if(document.getElementById('curriculum-overlay').style.display === 'block') toggleCurriculum(); updateNav(); }

    function toggleCurriculum() {
        const overlay = document.getElementById('curriculum-overlay');
        overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';
    }

    function toggleCEOAnswer() {
        const ans = document.getElementById('ceo-answer');
        ans.style.display = ans.style.display === 'none' ? 'block' : 'none';
    }

    function toggleBS(el) { el.classList.toggle('selected'); }

    function checkBS() {
        const items = document.querySelectorAll('.bs-item');
        let allCorrect = true;
        items.forEach(item => {
            const isOp = item.getAttribute('onclick').includes("'op'");
            const isSelected = item.classList.contains('selected');
            item.classList.remove('correct', 'wrong');
            if (isOp) {
                if (isSelected) item.classList.add('correct');
                else { item.classList.add('wrong'); allCorrect = false; }
            } else {
                if (!isSelected) item.classList.add('correct');
                else { item.classList.add('wrong'); allCorrect = false; }
            }
        });
        const fb = document.getElementById('bs-feedback');
        fb.innerText = allCorrect ? "Excellent Classification!" : "Re-evaluate financing vs operations (Debt, Lease Obligations, and Cash are non-operating).";
        fb.className = allCorrect ? "text-success mt-2 font-bold" : "text-error mt-2 font-bold";
    }

    function updateSim() {
        const flev = parseFloat(document.getElementById('flev-slider').value);
        document.getElementById('flev-val').innerText = flev.toFixed(2);
        const rnoa = 32.1, spread = 32.2;
        const impact = flev * spread;
        const roe = rnoa + impact;
        document.getElementById('sim-boost-text').innerText = impact.toFixed(1) + "%";
        document.getElementById('sim-roe-text').innerText = roe.toFixed(1) + "%";
        
        const scale = 3.5;
        document.getElementById('sim-boost-bar').style.height = (impact * scale) + "px";
        document.getElementById('sim-roe-bar').style.height = (roe * scale) + "px";
    }

    function revealSummary() {
        const bullets = document.querySelectorAll('.bullet-point');
        bullets.forEach((b, i) => {
            b.classList.remove('bullet-visible');
            setTimeout(() => b.classList.add('bullet-visible'), i * 350);
        });
    }

    function quizCheck(btn, isCorrect) {
        const fb = btn.parentElement.nextElementSibling;
        btn.parentElement.querySelectorAll('button').forEach(b => b.disabled = true);
        if (isCorrect) {
            btn.style.background = "var(--success)"; btn.style.color = "white";
            fb.innerText = "Correct!"; fb.className = "text-success mt-4 font-bold";
        } else {
            btn.style.background = "var(--error)"; btn.style.color = "white";
            fb.innerText = "Incorrect."; fb.className = "text-error mt-4 font-bold";
        }
    }

    function checkQ4() {
        const val = document.getElementById('q4-input').value;
        const fb = document.getElementById('q4-fb');
        if (val == 300) {
            fb.innerText = "Correct! (500 Assets - 200 Liabilities). Excess cash is excluded from NOA.";
            fb.className = "text-success mt-4 font-bold";
        } else {
            fb.innerText = "Try again. NOA = Op Assets - Op Liab (Ignore Cash).";
            fb.className = "text-error mt-4 font-bold";
        }
    }

    function generateTOC() {
        const container = document.getElementById('toc-grid');
        slides.forEach((slide, i) => {
            const h2 = slide.querySelector('h2') || slide.querySelector('h1');
            if (h2) {
                const item = document.createElement('div');
                item.className = "toc-btn"; item.onclick = () => jumpToSlide(i);
                item.innerHTML = `<div class="toc-num">${i + 1}</div><span>${h2.innerText}</span>`;
                container.appendChild(item);
            }
        });
    }

    window.onload = () => { generateTOC(); updateNav(); updateSim(); };
</script>
</body>
</html>
