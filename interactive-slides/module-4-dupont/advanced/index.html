<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced ROE: Operating vs. Nonoperating</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Vibrant Palette */
            --primary: #6366f1; /* Indigo */
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --secondary: #0ea5e9; /* Sky Blue */
            --accent: #f43f5e; /* Rose/Coral */
            --accent-gradient: linear-gradient(135deg, #f43f5e 0%, #fb7185 100%);
            --success: #10b981; /* Emerald */
            --success-gradient: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --error: #ef4444;
            --dark-box: #1e1b4b; /* Deep Indigo */
            --dark-gradient: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            --bg-color: #f8fafc;
            --text-color: #334155;
            --text-light: #94a3b8;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 20px 25px -5px rgba(99, 102, 241, 0.15), 0 10px 10px -5px rgba(99, 102, 241, 0.04);
            --shadow-neon: 0 0 15px rgba(99, 102, 241, 0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* --- Layout --- */
        #app-container {
            width: 100%;
            max-width: 1300px;
            height: 95vh;
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            position: relative;
            box-shadow: var(--shadow-lg);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.6);
        }

        .slide {
            display: none;
            flex: 1;
            padding: 3rem;
            overflow-y: auto;
            flex-direction: column;
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- Typography & Utils --- */
        h1, h2, h3 { 
            font-family: 'Space Grotesk', sans-serif; 
            color: var(--dark-box); 
            line-height: 1.2; 
        }
        
        h1 { 
            font-size: 3.5rem; 
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
        }

        h2 { 
            font-size: 2.5rem; 
            margin-bottom: 1.5rem;
            position: relative;
            display: inline-block;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 60px;
            height: 6px;
            background: var(--accent-gradient);
            border-radius: 3px;
        }

        p, li { font-size: 1.15rem; line-height: 1.7; margin-bottom: 1rem; color: var(--text-color); }
        
        .text-center { text-align: center; }
        .flex-center { display: flex; justify-content: center; align-items: center; height: 100%; }
        .mt-4 { margin-top: 2rem; }
        .text-white { color: white !important; -webkit-text-fill-color: white !important; }
        .text-accent { color: var(--accent); }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }
        .font-weight-bold { font-weight: bold; }
        .text-right { text-align: right; }
        
        /* --- Grid Systems --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }

        /* --- Cards & Boxes --- */
        .card {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
            border: 1px solid #e2e8f0;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-dark {
            background: var(--dark-gradient);
            color: var(--white);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        /* Abstract decorative circle for dark cards */
        .card-dark::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
        }
        
        .card-dark h3, .card-dark p, .card-dark li { color: var(--white); }

        .card-highlight { 
            border-left: 8px solid var(--accent); 
            background: white; 
            padding: 2.5rem; 
            border-radius: 20px; 
            box-shadow: var(--shadow-sm); 
            height: 100%; 
        }
        
        /* --- Interactive Elements --- */
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            font-family: 'Space Grotesk', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn:hover { 
            transform: translateY(-3px) scale(1.02); 
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5); 
        }
        .btn:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .btn-tab {
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.95rem;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            margin: 0 5px;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        .btn-tab.active {
            background: white;
            color: var(--dark-box);
            border-color: white;
            font-weight: 800;
            box-shadow: 0 0 15px rgba(255,255,255,0.4);
        }

        /* --- Balance Sheet Table --- */
        .bs-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }
        .bs-column h3 { text-align: center; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; color: var(--text-light); font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
        .bs-item {
            padding: 12px 20px;
            margin: 8px 0;
            border: 2px solid #f1f5f9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            font-weight: 600;
        }
        .bs-item:hover { background: #f8fafc; border-color: var(--secondary); }
        .bs-item.selected { background: #e0f2fe; border-color: var(--secondary); color: var(--secondary); }
        .bs-item.correct { background: #d1fae5; border-color: var(--success); color: #065f46; }
        .bs-item.wrong { background: #fee2e2; border-color: var(--error); color: #991b1b; }
        
        /* Tables */
        .is-table, .def-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
        }
        .is-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .is-table tr:last-child td { border-bottom: none; }
        .is-total { font-weight: 800; background: #f8fafc; border-radius: 8px; color: var(--primary); }
        
        .def-table th { background: var(--primary); color: white; padding: 15px; text-align: left; border-radius: 8px 8px 0 0; }
        .def-table td { padding: 15px; border-bottom: 1px solid #eee; }

        /* --- Flip Cards --- */
        .flip-container { perspective: 1000px; height: 320px; cursor: pointer; }
        .flip-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            box-shadow: var(--shadow-lg);
            border-radius: 20px;
        }
        .flip-container.flipped .flip-inner { transform: rotateY(180deg); }
        .flip-front, .flip-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            border-radius: 20px;
        }
        .flip-front { 
            background: var(--primary-gradient); 
            color: white; 
            border: 1px solid rgba(255,255,255,0.2);
        }
        .flip-back { 
            background: var(--white); 
            color: var(--text-color); 
            transform: rotateY(180deg); 
            border: 4px solid var(--primary); 
        }
        .flip-front h3, .flip-front p, .flip-front i { color: white; -webkit-text-fill-color: white; }

        /* --- Math Equation Box --- */
        .eq-box {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Fira Code', monospace;
            margin: 15px 0;
            border-left: 6px solid var(--secondary);
            font-size: 1.1rem;
            color: var(--dark-box);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* --- Strategy Chart --- */
        .strategy-chart {
            position: relative; height: 400px; 
            border-left: 3px solid #94a3b8; 
            border-bottom: 3px solid #94a3b8; 
            margin: 20px;
            background: radial-gradient(circle at center, rgba(99, 102, 241, 0.05) 0%, transparent 70%);
        }
        .strategy-circle {
            width: 140px; height: 140px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; color: white; font-weight: bold;
            position: absolute; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            text-align: center; font-size: 1rem;
            z-index: 5;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255,255,255,0.3);
        }
        .curve-line {
            position: absolute;
            width: 100%; height: 100%;
            border: 3px dashed #cbd5e0;
            border-radius: 0 0 0 100%;
            border-top: none; border-right: none;
            top: 0; left: 0;
            pointer-events: none;
        }

        /* --- Navigation --- */
        #nav-bar {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.5);
            padding: 1.5rem 2.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        .progress-bar { flex: 1; height: 10px; background: #e2e8f0; margin: 0 30px; border-radius: 10px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--accent-gradient); width: 0%; border-radius: 10px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 10px rgba(244, 63, 94, 0.5); }

        /* --- Calculator Row (Clickable) --- */
        .calc-row-btn {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border: 1px solid #e2e8f0;
            margin-bottom: 8px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .calc-row-btn:hover { background: #f0f9ff; border-color: var(--secondary); transform: translateX(5px); }
        .calc-row-btn:active { transform: scale(0.98); }

        /* Step Reveal */
        .step-hidden { display: none; }
        .step-visible { display: block; animation: fadeIn 0.5s; }
        
        .bullet-point { opacity: 0; transition: all 0.6s ease-out; list-style: none; margin-bottom: 15px; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; }
        .bullet-point::before { content: 'âœ¨'; margin-right: 15px; }
        .bullet-visible { opacity: 1; transform: translateX(0); }

        /* Lever Visualization */
        .lever-container { position: relative; height: 150px; margin-top: 30px; }
        .lever-beam { width: 80%; height: 12px; background: #334155; position: absolute; top: 100px; left: 10%; transform-origin: 30% 50%; transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); border-radius: 6px; }
        .lever-fulcrum { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 50px solid var(--secondary); position: absolute; top: 100px; left: 30%; transform: translateX(-50%) translateY(10px); filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        .lever-weight { width: 70px; height: 70px; background: var(--accent-gradient); position: absolute; bottom: 8px; right: 0; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; border-radius: 12px; box-shadow: var(--shadow-sm); }
        .lever-effort { width: 80px; height: 80px; background: var(--success-gradient); position: absolute; bottom: 8px; left: -10px; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; border-radius:50%; box-shadow: var(--shadow-lg); z-index: 2; font-size: 0.9rem;}

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .fib-input {
            padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1.2rem; font-family: 'Fira Code', monospace; transition: border-color 0.3s;
        }
        .fib-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }

        /* TOC Styling */
        .toc-btn { 
            background: white; border: 1px solid #e2e8f0; padding: 15px; 
            border-radius: 12px; text-align: left; cursor: pointer; transition: all 0.2s;
            display: flex; align-items: center; font-size: 0.95rem; font-weight: 600; color: var(--text-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .toc-btn:hover { background: #f0f9ff; border-color: var(--secondary); transform: translateX(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .toc-num { 
            background: var(--primary-gradient); color: white; width: 30px; height: 30px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            margin-right: 12px; font-size: 0.8rem; flex-shrink: 0; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="app-container">

    <!-- Slide 1: Hook -->
    <div class="slide active">
        <div class="flex-center" style="flex-direction: column;">
            <div class="card-dark" style="padding: 5rem; border-radius: 30px; max-width: 900px; text-align: center;">
                <div style="background: rgba(255,255,255,0.1); width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem auto;">
                    <i class="fas fa-chart-pie fa-3x text-white"></i>
                </div>
                <h1 style="color: white; -webkit-text-fill-color: white; margin-bottom: 1.5rem;">Advanced ROE Analysis</h1>
                <p style="font-size: 1.6rem; color: #e2e8f0;">Return on Equity is the "Ultimate Measure" of shareholder value.</p>
                <p style="opacity: 0.9; color: #cbd5e0;">But traditional ROE conflates two very different things: <strong style="color: var(--success);">Operations</strong> and <strong style="color: var(--accent);">Financing</strong>.</p>
                <button class="btn mt-4" style="background: white; color: var(--primary); font-weight: 800;" onclick="nextSlide()">Start Disaggregation <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </div>
    </div>

    <!-- Slide 2: Table of Contents -->
    <div class="slide">
        <h2>Table of Contents</h2>
        <p>Jump to any section of the module.</p>
        <div id="toc-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; padding-bottom: 20px;">
            <!-- Generated by JS -->
        </div>
    </div>

    <!-- Slide 3: The Problem -->
    <div class="slide">
        <h2>The Core Problem: Conflation</h2>
        <div class="grid-2">
            <div>
                <p>ROE combines two fundamentally different activities:</p>
                <div class="card card-highlight" style="border-left-color: var(--secondary);">
                    <h3 style="color: var(--secondary);">1. Operating Activities</h3>
                    <p>Creating and selling goods (The Engine).</p>
                </div>
                <div class="card card-highlight mt-4" style="border-left-color: var(--accent);">
                    <h3 style="color: var(--accent);">2. Nonoperating Activities</h3>
                    <p>Financing and Investing decisions (The Fuel/Debt).</p>
                </div>
            </div>
            <div class="card-dark text-center">
                <i class="fas fa-exclamation-triangle fa-3x mb-4 text-white" style="opacity: 0.5;"></i>
                <h3 class="text-white">Traditional Equation</h3>
                <p style="font-size: 1.8rem; margin: 2rem 0; font-family:'Fira Code'; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">ROE = Net Income / Average Equity</p>
                <p class="text-white">This formula hides whether returns come from excellence or risky debt.</p>
            </div>
        </div>
    </div>

    <!-- Slide 4: The Solution (NOA & NOPAT) -->
    <div class="slide">
        <h2>The Solution: Reformulation</h2>
        <p>To isolate true performance, we reformulate the financial statements into two buckets.</p>
        <div class="grid-2">
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: var(--secondary);">
                        <i class="fas fa-balance-scale fa-4x mb-4"></i>
                        <h3>Balance Sheet Reformulation</h3>
                        <p style="margin-top: 15px; opacity: 0.8; font-size: 0.9rem;">(Click to Flip)</p>
                    </div>
                    <div class="flip-back" style="border-color: var(--secondary);">
                        <h3 style="color: var(--secondary);">Net Operating Assets (NOA)</h3>
                        <p>We separate Operating Assets from Operating Liabilities to find the true capital invested in the core business.</p>
                        <p class="eq-box" style="border-left-color: var(--secondary);">NOA = Op Assets - Op Liabilities</p>
                    </div>
                </div>
            </div>
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: var(--accent);">
                        <i class="fas fa-file-invoice-dollar fa-4x mb-4"></i>
                        <h3>Income Statement Reformulation</h3>
                        <p style="margin-top: 15px; opacity: 0.8; font-size: 0.9rem;">(Click to Flip)</p>
                    </div>
                    <div class="flip-back" style="border-color: var(--accent);">
                        <h3 style="color: var(--accent);">Net Operating Profit After Tax (NOPAT)</h3>
                        <p>We isolate operating profit and adjust taxes to reflect only operations, removing the "tax shield" from debt.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 5: Interactive Sorting (NOA) -->
    <div class="slide">
        <h2>Activity: Identify Operating Items</h2>
        <p>Click the items below that are <strong style="color: var(--secondary);">Operating</strong> (Assets or Liabilities). Leave Nonoperating items (Debt/Cash) unselected.</p>
        
        <div class="bs-container">
            <div class="bs-column">
                <h3>Assets</h3>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Accounts Receivable</span> <span>$100</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Cash & Short-term Inv</span> <span>$500</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Inventory</span> <span>$200</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>PPE (Factories)</span> <span>$800</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Goodwill</span> <span>$150</span></div>
            </div>
            <div class="bs-column">
                <h3>Liabilities & Equity</h3>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Accounts Payable</span> <span>$80</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Short-term Debt</span> <span>$50</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Long-term Debt</span> <span>$400</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Unearned Revenue</span> <span>$20</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Equity</span> <span>$1200</span></div>
            </div>
        </div>
        <div class="text-center">
            <button class="btn mt-4" onclick="checkBS()">Check Classification</button>
            <p id="bs-feedback" class="mt-2 font-weight-bold" style="min-height: 1.5rem;"></p>
        </div>
    </div>

    <!-- Slide 6: Concept: Reformulating NOA -->
    <div class="slide">
        <h2>First, Reformulate the Balance Sheet</h2>
        <p>Net Operating Assets (NOA) represents the capital invested in a company's core operations.</p>
        
        <div class="card card-highlight text-center" style="padding: 3rem; background: #f0f9ff; border-left-color: var(--secondary);">
            <h3 style="color: var(--secondary); font-size: 2rem;">Net Operating Assets = Operating Assets - Operating Liabilities</h3>
        </div>
        
        <div class="mt-4 grid-2">
            <div class="card">
                <h4 style="color: var(--accent);">Crucial Distinction</h4>
                <ul style="padding-left: 20px;">
                    <li>We treat interest-bearing debt (a financing choice) differently from accounts payable (an operational liability).</li>
                    <li>Cash is generally considered nonoperating unless explicitly stated as needed for operations.</li>
                </ul>
            </div>
            <div class="card-dark flex-center">
               <i class="fas fa-sitemap fa-4x text-white"></i>
            </div>
        </div>
    </div>

    <!-- Slide 7: Pfizer NOA Result -->
    <div class="slide">
        <h2>Case Study: Pfizer's NOA (2022)</h2>
        <p>Using the classification logic from the previous slides, here is Pfizer's true capital base.</p>
        <div class="grid-2">
            <div class="card">
                <h3>The Data ($M)</h3>
                <table style="width:100%; border-collapse:collapse; margin-top:15px;">
                    <tr style="border-bottom:1px solid #eee;"><td>Total Operating Assets</td><td class="text-right"><strong>$170,437</strong></td></tr>
                    <tr style="border-bottom:1px solid #eee;"><td>(Less) Operating Liabilities</td><td class="text-right"><strong>($59,939)</strong></td></tr>
                    <tr style="background:#e0f2fe; font-weight:bold; border-radius: 8px;">
                        <td style="border-radius: 8px 0 0 8px;">Net Operating Assets (NOA)</td>
                        <td class="text-right" style="color:var(--secondary); border-radius: 0 8px 8px 0;">$110,498</td>
                    </tr>
                </table>
                <p class="mt-4" style="font-size:0.9rem; color:var(--text-light);"><i class="fas fa-info-circle mr-2"></i>Debt and Excess Cash are excluded.</p>
            </div>
            <div class="card-dark text-center">
                <i class="fas fa-calculator fa-3x mb-4 text-white"></i>
                <h3 class="text-white">The Calculation</h3>
                <p class="text-white" style="font-size: 1.2rem; margin-top: 2rem; opacity: 0.8;">NOA = OA - OL</p>
                <div style="border-top: 2px solid rgba(255,255,255,0.3); width: 80%; margin: 20px auto;"></div>
                <p class="text-white" style="font-size: 2rem;">$110,498</p>
                <p class="text-white" style="opacity: 0.8;">= $170,437 - $59,939</p>
            </div>
        </div>
    </div>

    <!-- Slide 8: NOPAT Theory 1 (Visualized) -->
    <div class="slide">
        <h2>Concept: NOPAT & The Tax Shield</h2>
        <div class="grid-2">
            <div>
                <h3>Why Adjustment is Needed?</h3>
                <p>Net Income is "contaminated" by Nonoperating items. <br>
                <span class="text-error" style="color: #ef4444 !important;">Interest Expense</span> creates a <strong>Tax Shield</strong> (lowers tax). <br>
                <span class="text-success" style="color: #10b981 !important;">Interest Income</span> creates <strong>Extra Tax Liability</strong> (increases tax).</p>
                <div class="card-highlight mt-4" style="background: #fff1f2; border-left-color: var(--accent);">
                    <p><strong>Goal:</strong> Measure profit as if the company had <strong style="color: var(--accent);">Zero Debt</strong> and <strong style="color: var(--secondary);">Zero Cash</strong>.</p>
                    <p>This reveals the "true" tax generated by operations alone.</p>
                </div>
            </div>
            <div class="card-dark text-center" style="position: relative;">
                <div style="margin-bottom: 20px;">
                    <button class="btn-tab active" onclick="switchScenario('debt', this)" id="btn-debt">Scenario A: Debt (Expense)</button>
                    <button class="btn-tab" onclick="switchScenario('cash', this)" id="btn-cash">Scenario B: Cash (Income)</button>
                </div>

                <!-- Scenario A: Debt -->
                <div id="scene-debt" style="height: 350px; position:relative;">
                      <h4 class="text-white mb-2">Scenario: Interest Expense (Debt)</h4>
                      <p style="font-size:0.8rem; color: #cbd5e0; margin-bottom: 20px;">Taxable Income was LOWERED by Interest Expense</p>
                      <div style="display: flex; justify-content: center; align-items: flex-end; height: 200px; gap: 40px;">
                        <!-- With Debt -->
                        <div style="width: 120px; display:flex; flex-direction:column; justify-content:flex-end; height:100%;">
                            <div class="text-white mb-2 font-weight-bold" style="font-size:0.8rem;">With Debt (Shield Active)</div>
                            <div style="height: 100px; background: var(--secondary); border-radius: 8px; position:relative; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                                 Actual Tax Paid
                            </div>
                        </div>
                        <div style="height: 100%; display: flex; align-items: center;">
                            <i class="fas fa-plus text-white"></i>
                        </div>
                        <!-- Without Debt -->
                        <div style="width: 120px; display:flex; flex-direction:column; justify-content:flex-end; height:100%;">
                            <div class="text-white mb-2 font-weight-bold" style="font-size:0.8rem;">Without Debt (Shield Gone)</div>
                            <div id="viz-shield-debt" style="height: 0px; background: var(--accent); transition: height 1s; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.7rem; overflow: hidden; width:100%; border-radius: 8px 8px 0 0;">Lost Shield</div>
                            <div style="height: 100px; background: var(--secondary); border-radius: 0 0 8px 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; width:100%;">
                                Actual Tax Paid
                            </div>
                        </div>
                      </div>
                      <div class="text-white mt-2" style="font-size: 0.9rem;" id="label-debt">
                        Result: <strong>Op Tax > Reported Tax</strong>
                      </div>
                      <button class="btn mt-4" style="background:white; color:var(--dark-box); padding: 10px 20px; font-size: 0.9rem; box-shadow: none;" id="sim-btn-debt" onclick="animateShield('debt')">Add Back Shield</button>
                </div>

                <!-- Scenario B: Cash -->
                <div id="scene-cash" style="height: 350px; position:relative; display:none;">
                      <h4 class="text-white mb-2">Scenario: Interest Income (Cash)</h4>
                      <p style="font-size:0.8rem; color: #cbd5e0; margin-bottom: 20px;">Taxable Income was INCREASED by Interest Income</p>
                      <div style="display: flex; justify-content: center; align-items: flex-end; height: 200px; gap: 40px;">
                        <!-- With Cash -->
                        <div style="width: 120px; display:flex; flex-direction:column; justify-content:flex-end; height:100%;">
                            <div class="text-white mb-2 font-weight-bold" style="font-size:0.8rem;">With Cash (Extra Tax)</div>
                            <!-- Represents TOTAL TAX: Op Tax + Tax on Int -->
                            <div style="height: 140px; background: var(--secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; width:100%; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                                 Actual Tax Paid
                            </div>
                        </div>
                        <div style="height: 100%; display: flex; align-items: center;">
                            <i class="fas fa-minus text-white"></i>
                        </div>
                        <!-- Without Cash (Operating Only) -->
                        <div style="width: 120px; display:flex; flex-direction:column; justify-content:flex-end; height:100%;">
                            <div class="text-white mb-2 font-weight-bold" style="font-size:0.8rem;">Without Cash (Core Only)</div>
                            <!-- Top Part: Tax on Int (Animates away/shrinks) -->
                             <div id="viz-shield-cash-top" style="height: 40px; background: var(--accent); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.7rem; width:100%; transition: height 1s; overflow:hidden; border-radius: 8px 8px 0 0;">Tax on Int</div>
                            <!-- Bottom Part: Op Tax -->
                            <div style="height: 100px; background: var(--secondary); border-radius: 0 0 8px 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; width:100%;">
                                 Op Tax
                            </div>
                        </div>
                      </div>
                      <div class="text-white mt-2" style="font-size: 0.9rem;" id="label-cash">
                        Result: <strong>Op Tax < Reported Tax</strong>
                      </div>
                      <button class="btn mt-4" style="background:white; color:var(--dark-box); padding: 10px 20px; font-size: 0.9rem; box-shadow: none;" id="sim-btn-cash" onclick="animateShield('cash')">Remove Inv Tax</button>
                </div>

            </div>
        </div>
    </div>
    
    <!-- Slide 9: Tax Shield Scenarios (Interactive) -->
    <div class="slide">
        <h2>Scenario: Which direction to adjust?</h2>
        <p>Click to see how we adjust Reported Taxes to get Operating Taxes.</p>
        <div class="grid-2">
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);">
                        <i class="fas fa-arrow-down fa-3x mb-3 text-white"></i>
                        <h3 style="color:white;">Case A: High Debt</h3>
                        <p class="text-white" style="margin-top:10px; font-weight:bold;">(Net Non-Operating Expense)</p>
                        <p class="text-white">Pays Interest &rarr; Lowers Taxable Income</p>
                        <p class="text-white" style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">(Click)</p>
                    </div>
                    <div class="flip-back" style="border-color: #ef4444;">
                        <h3 style="color: #ef4444;">Add Back Shield</h3>
                        <p>You paid LESS tax because of debt.</p>
                        <p>Without the debt, you would pay more tax. The shield has disappeared, so we add it back.</p>
                        <p class="eq-box" style="border-left-color: #ef4444;">Op Tax = Reported Tax + Shield</p>
                    </div>
                </div>
            </div>
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: var(--success-gradient);">
                        <i class="fas fa-arrow-up fa-3x mb-3 text-white"></i>
                        <h3 style="color:white;">Case B: High Cash</h3>
                        <p class="text-white" style="margin-top:10px; font-weight:bold;">(Net Non-Operating Income)</p>
                        <p class="text-white">Earns Interest &rarr; Increases Taxable Income</p>
                        <p class="text-white" style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">(Click)</p>
                    </div>
                    <div class="flip-back" style="border-color: var(--success);">
                        <h3 style="color: var(--success);">Subtract Shield</h3>
                        <p>You paid MORE tax because of investment income.</p>
                        <p>Without the cash, you pay less tax.</p>
                        <p class="eq-box" style="border-left-color: var(--success);">Op Tax = Reported Tax - Extra Tax</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 10: Method 1 (Top-Down) -->
    <div class="slide">
        <h2>Calculation Method 1: Top-Down</h2>
        <p>Start from Sales and work down to find <strong>Net Operating Profit Before Tax (NOPBT)</strong>.</p>
        <div class="grid-2">
            <div class="card" style="border: 2px solid var(--secondary);">
                <h3 style="color: var(--secondary);">Income Statement Format</h3>
                <table style="width:100%; border-collapse:separate; border-spacing: 0 5px; margin-top:10px;">
                    <tr><td>Revenue</td><td class="text-right">$$$</td></tr>
                    <tr><td>(-) COGS</td><td class="text-right">($)</td></tr>
                    <tr><td>(-) SG&A</td><td class="text-right">($)</td></tr>
                    <tr style="border-bottom:1px solid #eee;"><td>(-) R&D / Depr</td><td class="text-right">($)</td></tr>
                    <tr style="background:#e0f2fe; font-weight:bold; border-radius: 8px;"><td style="border-radius: 8px 0 0 8px;">= NOPBT (EBIT)</td><td class="text-right" style="color:var(--secondary); border-radius: 0 8px 8px 0;">$$$</td></tr>
                </table>
                <p class="mt-4" style="color:#64748b; font-size:0.9rem;"><i class="fas fa-exclamation-circle mr-1"></i>Do NOT subtract interest here</p>
            </div>
            <div class="card-dark text-center flex-center">
                <div>
                    <h3 class="text-white">Then... Adjust for Tax</h3>
                    <p class="text-white mt-4" style="font-size: 1.4rem;">Net Operating Profit After Tax = NOPBT - Tax on Operating Income</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 11: Method 2 (Bottom-Up) -->
    <div class="slide">
        <h2>Calculation Method 2: Bottom-Up</h2>
        <p>Alternatively, start from Net Income.</p>
        <div class="card-dark text-center" style="padding: 4rem;">
            <h3 class="text-white">The Formula</h3>
            <p class="text-white mt-4" style="font-size: 1.2rem; opacity: 0.9;">Net Income + Net Non-Op Expense (After Tax)</p>
            <div class="eq-box mt-4" style="color: var(--dark-box); background: white; font-size: 1.5rem; padding: 2rem;">
                Net Income + (Net NonOp Exp * (1 - Tax Rate))
            </div>
            <p class="text-white mt-4">This adds back the interest "net of tax" to return to the operating profit.</p>
        </div>
    </div>

    <!-- Slide 12: Scenario 1 (Positive Debt) -->
    <div class="slide">
        <h2>Scenario 1: Standard Company (Positive Debt)</h2>
        <div class="eq-box">Net Operating Profit After Tax = NOPBT - (Reported Tax + Tax Shield)</div>
        <p>Most companies pay interest. Let's see how NOPAT works for "Company X".</p>
        <div class="grid-2">
            <div class="card">
                <h3>Company X Data</h3>
                <ul class="mt-4">
                    <li>NOPBT: <strong>$1,000</strong></li>
                    <li>Interest Expense: <strong>$100</strong></li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: <strong>$720</strong></li>
                    <li>Reported Tax: <strong>$180</strong> <small>(on $900 pretax)</small></li>
                </ul>
            </div>
            <div class="card-highlight" style="background: #f0fdf4; border-left-color: var(--success);">
                <h3 style="color: var(--success);">Calculation</h3>
                <p>1. Tax Shield = $100 * 20% = <strong style="color: var(--accent);">$20</strong></p>
                <p>2. Tax on Operating Income = $180 (Reported) + $20 (Shield) = <strong>$200</strong></p>
                <p>3. NOPAT (Top-Down) = $1,000 - $200 = <strong style="font-size: 1.3rem;">$800</strong></p>
                <hr style="border-top: 1px dashed #cbd5e0; margin: 20px 0;">
                <p class="text-success"><i class="fas fa-check-circle mr-2"></i><strong>Logic Check:</strong> If Comp X had 0 debt, it would pay $200 tax on $1,000 profit.</p>
            </div>
        </div>
    </div>

    <!-- Slide 13: Standard Company (Bottom-Up Check) -->
    <div class="slide">
        <h2>Scenario 1: Bottom-Up Check</h2>
        <p>Does the Bottom-Up method give the same result?</p>
         <div class="grid-2">
             <div class="card">
                <h3>Company X Data</h3>
                <ul class="mt-4">
                    <li>NOPBT: <strong>$1,000</strong></li>
                    <li>Interest Expense: <strong>$100</strong></li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: <strong>$720</strong></li>
                    <li>Reported Tax: <strong>$180</strong></li>
                </ul>
            </div>
            <div class="card-dark text-center">
                <h3 class="text-white">Bottom-Up Formula</h3>
                <p class="text-white" style="font-size:1.2rem;">Net Income + [Interest * (1 - Tax Rate)]</p>
                <div class="mt-4 text-white" style="font-size:1.5rem; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
                    $720 + [$100 * (1 - 0.20)]<br>
                    $720 + [$100 * 0.80]<br>
                    $720 + $80 = <strong style="color: var(--success);">$800</strong>
                </div>
                <p class="text-success mt-4" style="background: white; display: inline-block; padding: 5px 15px; border-radius: 20px; color: var(--success) !important;">Match Confirmed!</p>
            </div>
        </div>
    </div>

    <!-- Slide 14: Scenario 2 (Negative Shield) -->
    <div class="slide">
        <h2>Scenario 2: "Cash Rich" Company (Negative Shield)</h2>
        <div class="eq-box">Net Operating Profit After Tax = NOPBT - (Reported Tax - Tax on Inv Income)</div>
        <p>What if a company has more Interest Income than Expense? (e.g. Apple/Pfizer)</p>
        <div class="grid-2">
            <div class="card">
                <h3>Company Y Data</h3>
                <ul class="mt-4">
                    <li>NOPBT: <strong>$1,000</strong></li>
                    <li>Interest <em>Income</em>: <strong>$100</strong></li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: <strong>$880</strong></li>
                    <li>Reported Tax: <strong>$220</strong> <small>(on $1100 pretax)</small></li>
                </ul>
            </div>
            <div class="card-highlight" style="border-left-color: var(--error); background: #fff5f5;">
                <h3 style="color: var(--error);">Top-Down Calculation</h3>
                <p>1. Shield = ($100 Income) * 20% = <strong style="color: var(--error);">($20)</strong> <small>Negative Shield</small></p>
                <p>2. Tax on Ops = $220 (Reported) + ($20) = <strong>$200</strong></p>
                <p>3. NOPAT (Top-Down) = $1,000 - $200 = <strong style="font-size: 1.3rem;">$800</strong></p>
                <hr style="border-top: 1px dashed #cbd5e0; margin: 20px 0;">
                <p><strong>Note:</strong> We subtract the extra tax paid on investment income to find the core operating tax.</p>
            </div>
        </div>
    </div>

    <!-- Slide 15: Scenario 2 Bottom-Up -->
    <div class="slide">
        <h2>Scenario 2: Bottom-Up Check</h2>
        <p>Does it match for the Cash Rich company too?</p>
         <div class="grid-2">
             <div class="card">
                <h3>Company Y Data</h3>
                <ul class="mt-4">
                    <li>NOPBT: <strong>$1,000</strong></li>
                    <li>Interest <em>Income</em>: <strong>$100</strong></li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: <strong>$880</strong></li>
                    <li>Reported Tax: <strong>$220</strong></li>
                </ul>
            </div>
            <div class="card-dark text-center">
                <h3 class="text-white">Bottom-Up Formula</h3>
                <p class="text-white">Net Income + [Net NonOp Exp * (1 - Tax Rate)]</p>
                <p class="text-white mt-2" style="font-size: 0.9rem; opacity: 0.8;"><em>Remember: Net NonOp Exp is Negative (-$100) because it's Income.</em></p>
                <div class="mt-4 text-white" style="font-size:1.5rem; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
                    $880 + [($100) * (1 - 0.20)]<br>
                    $880 + [($100) * 0.80]<br>
                    $880 - $80 = <strong style="color: var(--success);">$800</strong>
                </div>
                <p class="text-success mt-4" style="background: white; display: inline-block; padding: 5px 15px; border-radius: 20px; color: var(--success) !important;">Match Confirmed!</p>
            </div>
        </div>
    </div>

    <!-- Slide 16: Case Study Pfizer (Detailed) -->
    <div class="slide">
        <h2>Case Study: Pfizer's NOPAT (2022)</h2>
        <div class="card" style="padding: 1rem; overflow-y: auto;">
            <table class="is-table">
                <tr><td>Revenues</td><td class="text-right">$100,330</td></tr>
                <tr><td>Cost of sales</td><td class="text-right">34,344</td></tr>
                <tr><td>Selling, informational & admin</td><td class="text-right">13,677</td></tr>
                <tr><td>Research & development</td><td class="text-right">11,428</td></tr>
                <tr><td>Acquired IPR&D</td><td class="text-right">953</td></tr>
                <tr><td>Amortization of intangibles</td><td class="text-right">3,609</td></tr>
                <tr><td>Restructuring charges</td><td class="text-right">1,375</td></tr>
                <tr><td>Other operating (income) expense</td><td class="text-right">225</td></tr>
                <tr class="is-total"><td style="border-radius: 8px 0 0 8px;">= NOPBT (Operating Profit)</td><td class="text-right" style="color:var(--primary); border-radius: 0 8px 8px 0;">$34,719</td></tr>
                <tr><td colspan="2" style="border:none; height:10px;"></td></tr>
                <tr><td>Reported Tax Expense</td><td class="text-right">$3,328</td></tr>
                <tr><td style="color:#64748b; font-size: 0.9rem;">Net Nonoperating Income (Shield Calculation)</td><td class="text-right" style="color:#64748b; font-size: 0.9rem;">$10</td></tr>
                <tr><td style="color:var(--accent); font-weight:600;">Tax Shield ($10 * 22%)</td><td class="text-right" style="color:var(--accent); font-weight:600;">($2)</td></tr>
                <tr class="is-total"><td style="border-radius: 8px 0 0 8px;">= Tax on Operating Income</td><td class="text-right" style="border-radius: 0 8px 8px 0;">3,326</td></tr>
                <tr><td colspan="2" style="border:none; height:10px;"></td></tr>
                <tr style="background:var(--dark-gradient); color:white; font-weight:bold; font-size:1.2rem;"><td style="border-radius: 8px 0 0 8px;">Net Operating Profit After Tax</td><td class="text-right" style="border-radius: 0 8px 8px 0;">$31,393</td></tr>
            </table>
        </div>
    </div>
    
    <!-- Slide 17: RNOA Reveal -->
    <div class="slide">
        <h2>The Result: Return on Net Operating Assets</h2>
        <p>Now we combine Slide 5 (NOA) and Slide 14 (NOPAT).</p>
        <div class="flex-center" style="flex-direction: column;">
            <div class="eq-box" style="font-size: 1.5rem; text-align: center; width: 80%;">RNOA = NOPAT / Average NOA</div>
            <div class="grid-2" style="width:100%; margin-top:30px;">
                <div class="flip-container" onclick="this.classList.toggle('flipped')">
                    <div class="flip-inner">
                        <div class="flip-front" style="background: var(--accent-gradient); color: white; border: none;">
                            <h3 class="text-white">Traditional ROA</h3>
                            <h1 class="text-white" style="font-size: 4rem;">16.6%</h1>
                            <p class="text-white" style="opacity: 0.8;">(Click to explain)</p>
                        </div>
                        <div class="flip-back" style="border-color: var(--accent);">
                            <h3 style="color: var(--accent);">Blended View</h3>
                            <p>Mixes high-return operations with low-return cash/debt investments.</p>
                        </div>
                    </div>
                </div>
                
                 <div class="flip-container" onclick="this.classList.toggle('flipped')">
                    <div class="flip-inner">
                        <div class="flip-front" style="background: var(--dark-gradient); color: white; border: 2px solid var(--success);">
                            <h3 class="text-white">Advanced RNOA</h3>
                            <h1 style="color: var(--success); -webkit-text-fill-color: var(--success); font-size: 4rem;">32.1%</h1>
                            <p class="text-white" style="opacity: 0.8;">(Click to explain)</p>
                        </div>
                        <div class="flip-back" style="border-color: var(--success);">
                            <h3 style="color: var(--success);">Core Operating Efficiency</h3>
                            <p>The true return on the assets actually running the business.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 18: RNOA Decomposition -->
    <div class="slide">
        <h2>Decomposing: ROA vs RNOA</h2>
        <div class="grid-2">
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: var(--accent-gradient); color: white; border: none;">
                        <h3 class="text-white">Traditional DuPont (ROA)</h3>
                        <div style="font-family: 'Fira Code', monospace; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; margin-top: 20px; font-size: 0.9rem;">ROA = Profit Margin &times; Asset Turnover</div>
                        <p class="mt-4 text-white">Includes financing noise. Why? (Click)</p>
                    </div>
                    <div class="flip-back" style="border-color: var(--accent);">
                        <h3 style="color: var(--accent);">Noise Explained</h3>
                        <p><strong>Numerator:</strong> Net Income includes Interest Expense.</p>
                        <p><strong>Denominator:</strong> Average Assets includes Cash (which generates little return).</p>
                    </div>
                </div>
            </div>
            
            <div class="card-highlight text-center" style="border-left-color: var(--primary);">
                <h3 style="color: var(--primary);">Advanced (RNOA)</h3>
                <div style="font-family: 'Fira Code', monospace; background: #f1f5f9; padding: 15px; border-radius: 6px; margin: 20px 0; color: var(--primary); font-weight: bold;">RNOA = NOPM &times; NOAT</div>
                <p><strong>Net Operating Profit Margin &times; Net Operating Asset Turnover</strong></p>
                <p>Pure operating metrics.</p>
            </div>
        </div>
        <p class="text-center mt-4">Just like ROA, RNOA breaks down into Profitability and Efficiency.</p>
    </div>

    <!-- Slide 19: Pfizer Drivers -->
    <div class="slide">
        <h2>Pfizer's Engine</h2>
        <div class="grid-2">
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: var(--primary-gradient);">
                        <i class="fas fa-percent fa-3x mb-3 text-white"></i>
                        <h3>Net Operating Profit Margin (NOPM)</h3>
                        <p class="text-white mt-4" style="font-size: 3rem; font-weight: bold;">31.3%</p>
                        <p class="text-white" style="opacity: 0.8;">(Click to Flip)</p>
                    </div>
                    <div class="flip-back" style="border-color: var(--primary);">
                        <h3 style="color: var(--primary);">Interpretation</h3>
                        <p class="eq-box">Equation: NOPAT / Sales</p>
                        <p>Pfizer earns 31.3 cents of pure operating profit for every dollar of sales. <strong class="text-success">Very High Profitability.</strong></p>
                    </div>
                </div>
            </div>
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: var(--secondary);">
                         <i class="fas fa-recycle fa-3x mb-3 text-white"></i>
                        <h3>Net Operating Asset Turnover (NOAT)</h3>
                        <p class="text-white mt-4" style="font-size: 3rem; font-weight: bold;">1.03</p>
                        <p class="text-white" style="opacity: 0.8;">(Click to Flip)</p>
                    </div>
                    <div class="flip-back" style="border-color: var(--secondary);">
                        <h3 style="color: var(--secondary);">Interpretation</h3>
                        <p class="eq-box">Equation: Sales / Avg NOA</p>
                        <p>Pfizer generates $1.03 in sales for every dollar invested in net operating assets. <strong class="text-accent">Moderate Efficiency.</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 20: Strategy Trade-off -->
    <div class="slide">
        <h2>The Strategy Trade-off</h2>
        <div class="strategy-chart">
            <div style="position: absolute; bottom: 15px; right: 15px; font-weight: bold; color: var(--text-color); background: rgba(255,255,255,0.7); padding: 5px 10px; border-radius: 5px;">Margin (NOPM) &rarr;</div>
            <div style="position: absolute; top: 15px; left: 15px; font-weight: bold; color: var(--text-color); background: rgba(255,255,255,0.7); padding: 5px 10px; border-radius: 5px;">Turnover (NOAT) &uarr;</div>
            
            <div class="curve-line"></div>
            
            <!-- Pfizer Circle -->
            <div class="strategy-circle" style="background: var(--primary-gradient); bottom: 80px; right: 60px;">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">Pfizer</div>
                <div>31% Margin</div>
            </div>
            
            <!-- Retailer Circle -->
            <div class="strategy-circle" style="background: var(--accent-gradient); top: 60px; left: 60px;">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">Retailer</div>
                <div>High Turn</div>
            </div>
        </div>
        <p class="text-center">Pfizer relies on <strong class="text-primary">high margins</strong>. A retailer relies on <strong class="text-accent">high turnover</strong>.</p>
    </div>

    <!-- Slide 21: The Advanced Structure Context -->
    <div class="slide">
        <h2>The Advanced DuPont Equation Structure</h2>
        <div class="card-dark text-center" style="margin-bottom:20px; padding: 2.5rem;">
             <h3 style="color:white;">ROE = Operating Return + Nonoperating Return</h3>
        </div>
        
        <div class="grid-2">
            <div class="card">
                 <h4 style="color: var(--secondary);">1. Operating Return</h4>
                 <p>This is simply <strong style="color: var(--secondary);">RNOA</strong> (Return on Net Operating Assets).</p>
            </div>
            <div class="card">
                 <h4 style="color: var(--accent);">2. Nonoperating Return</h4>
                 <p>This requires deeper analysis. It is driven by how we fund the business.</p>
                 <p class="text-accent font-weight-bold" style="font-family: 'Fira Code'; margin-top: 10px;">Formula: FLEV &times; Spread</p>
            </div>
        </div>
        <div class="card-highlight mt-4 text-center" style="background: #fdf2f8; border-left-color: var(--primary);">
            <h3 style="color: var(--primary);">Final Equation: ROE = RNOA + (FLEV &times; Spread)</h3>
        </div>
    </div>

    <!-- Slide 22: Financial Leverage (FLEV) -->
    <div class="slide">
        <h2>Concept: Financial Leverage (FLEV)</h2>
        <div class="card-highlight text-center" style="width: fit-content; margin: 0 auto; padding: 2rem; border-left: 8px solid var(--accent);">
            <h3 style="font-size: 1.5rem; color: var(--accent);">FLEV = Avg Net Nonop Obligations / Avg Equity</h3>
        </div>
        <div class="mt-4">
             <p><strong>Note:</strong> This is different from the basic DuPont "Average Assets / Average Equity" leverage.</p>
             <div class="card-highlight" style="border-left-color: var(--dark-box);">
                <p><strong>Definition of NNO:</strong> Net Nonoperating Obligations = Nonoperating Liabilities - Nonoperating Assets.</p>
                <div class="grid-2 mt-4" style="font-size: 0.95rem;">
                    <div>
                        <strong style="color: var(--accent);">Nonoperating Liabilities (Debt):</strong>
                        <ul style="margin-top: 10px;">
                            <li>Short-term Notes</li>
                            <li>Long-term Bonds</li>
                            <li>Capital Lease Obligations</li>
                            <li>Dividends Payable</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--secondary);">Nonoperating Assets (Cash):</strong>
                        <ul style="margin-top: 10px;">
                            <li>Excess Cash</li>
                            <li>Marketable Securities</li>
                            <li>Discontinued Operations Assets</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 23: The Spread -->
    <div class="slide">
        <h2>Concept: The Spread</h2>
        <div class="card-dark text-center">
            <h3 class="text-white">Spread = RNOA - NNEP</h3>
        </div>
        <div class="mt-4 text-center">
             <p><strong>NNEP = Net Nonoperating Expense / Avg Net Nonoperating Obligations</strong></p>
             <p style="opacity: 0.8;">(This is effectively the Cost of Debt)</p>
        </div>
        
        <div class="grid-2 mt-4">
            <div class="card" style="border-top: 5px solid var(--success);">
                <h4 class="text-success"><i class="fas fa-thumbs-up mr-2"></i>Positive Spread</h4>
                <p>RNOA > Cost of Debt.</p>
                <p>Borrowing money generates excess return for shareholders. "Judicious use of debt."</p>
            </div>
            <div class="card" style="border-top: 5px solid var(--error);">
                <h4 class="text-error"><i class="fas fa-thumbs-down mr-2"></i>Negative Spread</h4>
                <p>RNOA < Cost of Debt.</p>
                <p>Borrowing money destroys value. The operations can't cover the interest cost.</p>
            </div>
        </div>
    </div>

    <!-- Slide 24: Pfizer's Spread -->
    <div class="slide">
        <h2>Pfizer's Spread Analysis</h2>
        <p>Pfizer had a massive positive spread in 2022.</p>
        <div class="card">
            <div class="grid-3">
                <div class="text-center">
                    <p style="font-size: 0.9rem; color: var(--text-light);">RNOA</p>
                    <h2 class="text-primary">32.1%</h2>
                </div>
                <div class="text-center" style="border-left: 1px solid #eee; border-right: 1px solid #eee;">
                     <p style="font-size: 0.9rem; color: var(--text-light);">Net Nonop Cost</p>
                    <h2>~0%</h2>
                </div>
                <div class="text-center">
                     <p style="font-size: 0.9rem; color: var(--text-light);">Spread</p>
                    <h2 class="text-success">~32%</h2>
                </div>
            </div>
            <p class="text-accent mt-4 text-center">Because the spread is positive, even small leverage boosts ROE significantly.</p>
        </div>
        
        <!-- Interactive Leverage Simulator -->
        <div id="pfizer-leverage-sim" style="margin-top:25px; background:white; padding:30px; border-radius:20px; box-shadow:var(--shadow-lg);">
             <h4 style="margin-bottom: 20px;">Leverage Simulator <i class="fas fa-sliders-h ml-2 text-primary"></i></h4>
             <p style="margin-bottom: 20px; opacity: 0.8;">Adjust FLEV to see how leverage amplifies ROE when Spread is positive.</p>
             <div style="display:flex; align-items:center; gap:15px; margin-bottom: 20px;">
                <span style="font-weight: bold; color: var(--dark-box);">FLEV:</span>
                <input type="range" id="pf-lev-slider" min="0" max="2" step="0.1" value="0.13" oninput="updatePfizerLeverage()" style="width:250px; accent-color: var(--primary);">
                <span id="pf-lev-val" style="font-weight:bold; background: var(--primary); color: white; padding: 2px 10px; border-radius: 10px;">0.13</span>
             </div>
             
             <!-- Dynamic Chart -->
             <div style="display:flex; align-items:flex-end; height: 250px; margin-top:20px; justify-content:center; gap: 30px;">
                <div style="text-align:center;">
                     <div style="height:150px; width:80px; background:var(--primary-gradient); margin:0 auto; display:flex; align-items:center; justify-content:center; color:white; border-radius: 8px 8px 0 0; font-weight: bold; box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);">32.1%</div>
                     <p style="margin-top: 10px; font-weight: 600;">RNOA</p>
                </div>
                <div style="font-size:2rem; padding-bottom: 60px; color: var(--text-light);">+</div>
                <div style="text-align:center;">
                     <div id="viz-boost-bar" style="height:20px; width:80px; background:var(--accent-gradient); margin:0 auto; display:flex; align-items:center; justify-content:center; color:white; transition: height 0.2s; border-radius: 8px 8px 0 0; font-weight: bold; box-shadow: 0 5px 15px rgba(244, 63, 94, 0.3);">4.2%</div>
                     <p style="margin-top: 10px; font-weight: 600;">Lev Impact</p>
                </div>
                <div style="font-size:2rem; padding-bottom: 60px; color: var(--text-light);">=</div>
                <div style="text-align:center;">
                     <div id="viz-roe-bar" style="height:170px; width:80px; background:var(--success-gradient); margin:0 auto; display:flex; flex-direction:column; justify-content:flex-end; transition: height 0.2s; border-radius: 8px 8px 0 0; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);">
                         <div id="viz-roe-val" style="height:100%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;">36.3%</div>
                     </div>
                     <p style="margin-top: 10px; font-weight: 600;">ROE</p>
                </div>
             </div>
             
             <div class="mt-4 text-center">
                 <p class="font-weight-bold" id="sim-equation" style="background: #f1f5f9; display: inline-block; padding: 10px 20px; border-radius: 10px; color: var(--dark-box); font-family: 'Fira Code';">36.3% = 32.1% + (0.13 &times; 32.2%)</p>
                 <p id="pf-roe-val" style="display:none;">36.3%</p> <!-- Hidden holder for JS targeting -->
             </div>
        </div>
    </div>

    <!-- Slide 25: Pfizer Final Decomposition -->
    <div class="slide">
        <h2>Pfizer's Final Decomposition</h2>
        <p>Let's check the numbers for 2022.</p>
        <div class="card-dark" style="min-height: 400px; display: flex; flex-direction: column; justify-content: center; background: var(--dark-gradient);">
            <h3 class="text-white text-center mb-4" style="font-size: 2rem;">ROE (36.3%) = RNOA (32.1%) + Nonoperating Return (4.2%)</h3>
            <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 16px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);">
                <p class="text-white" style="font-size: 1.2rem; margin-bottom: 1.5rem;"><i class="fas fa-lightbulb mr-2 text-warning"></i><strong>Insight:</strong> 88% of Pfizer's return (32.1 / 36.3) comes from core operations.</p>
                <p class="text-white" style="font-size: 1.2rem; opacity: 0.9;">Traditional DuPont (ROA 16.6% / ROE 36.3%) suggested only 46% came from operations. The advanced method reveals the truth.</p>
            </div>
        </div>
    </div>

    <!-- Slide 26: Interactive: Equation Builder -->
    <div class="slide">
        <h2>Activity: Build the Equation</h2>
        <p>Click the components to rebuild the Advanced DuPont Formula.</p>
        <div id="eq-display" style="min-height: 80px; background: white; border: 2px dashed #cbd5e0; border-radius: 16px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; color: var(--primary); font-family: 'Fira Code', monospace; box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);"></div>
        <div class="grid-3">
            <button class="btn" onclick="addToEq('RNOA')">RNOA</button>
            <button class="btn" onclick="addToEq('FLEV')">FLEV</button>
            <button class="btn" onclick="addToEq('Spread')">Spread</button>
            <button class="btn" onclick="addToEq('+')" style="background: var(--secondary);">+</button>
            <button class="btn" onclick="addToEq('x')" style="background: var(--secondary);">&times;</button>
        </div>
        <div class="text-center">
            <button class="btn mt-4" style="background: #cbd5e0; color: #475569; box-shadow: none;" onclick="resetEq()">Reset</button>
            <p id="eq-feedback" class="mt-2 text-center" style="font-size: 1.2rem; font-weight: bold; min-height: 2rem;"></p>
        </div>
    </div>

    <!-- Slide 27: Case Study: Apple -->
    <div class="slide">
        <h2>Case Study: Apple (Cash Drag)</h2>
        <div class="grid-2">
            <div class="card">
                <h3>Apple 2022</h3>
                <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-left: 5px solid var(--success);">
                        <p style="margin:0; font-weight:bold; color: var(--success);">RNOA: 864.9%</p>
                        <small>Incredible Efficiency</small>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 10px; border-left: 5px solid var(--secondary);">
                         <p style="margin:0; font-weight:bold; color: var(--secondary);">ROE: 175.5%</p>
                         <small>Lower than RNOA</small>
                    </div>
                </div>
            </div>
            <div class="card-dark">
                <h3 class="text-white">Why?</h3>
                <p class="text-white">Apple holds massive cash reserves (Nonoperating Assets).</p>
                <p class="text-white">Cash earns very low interest (~2%).</p>
                <div style="background: rgba(239, 68, 68, 0.2); padding: 15px; border-radius: 10px; border: 1px solid rgba(239, 68, 68, 0.5); margin-top: 20px;">
                    <p class="text-error" style="color: #fca5a5 !important; margin: 0;"><strong>Negative Leverage:</strong> This cash drags down the overall return.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 28: Visualizing Negative Leverage -->
    <div class="slide">
        <h2>Visualizing Apple's Negative Leverage</h2>
        <p>The "Weight" of Cash.</p>
        <div style="display:flex; align-items:center; height:250px; gap: 20px; margin-top: 20px;">
            <div style="flex:1; background:var(--success-gradient); height:100%; display:flex; align-items:center; justify-content:center; color:white; border-radius: 20px; flex-direction: column; box-shadow: var(--shadow-lg);">
                <span style="opacity: 0.9;">RNOA</span>
                <span style="font-size: 3rem; font-weight: bold;">865%</span>
            </div>
            <div style="font-size:3rem; color: var(--text-light);">-</div>
            <div style="flex:0.5; background:linear-gradient(135deg, #ef4444 0%, #fca5a5 100%); height:60%; display:flex; align-items:center; justify-content:center; color:white; border-radius: 20px; flex-direction: column; box-shadow: var(--shadow-lg);">
                <span style="font-size: 1.2rem; font-weight: bold;">Cash Drag</span>
            </div>
            <div style="font-size:3rem; color: var(--text-light);">=</div>
            <div style="flex:0.8; background:var(--primary-gradient); height:80%; display:flex; align-items:center; justify-content:center; color:white; border-radius: 20px; flex-direction: column; box-shadow: var(--shadow-lg);">
                <span style="opacity: 0.9;">ROE</span>
                <span style="font-size: 2.2rem; font-weight: bold;">176%</span>
            </div>
        </div>
    </div>

    <!-- Slide 29: Summary -->
    <div class="slide">
        <h2>Summary</h2>
        <div class="card-dark" style="padding: 4rem;">
            <ul>
                <li class="bullet-point text-white mb-2"><strong>Reformulation:</strong> Separate Operating from Financing.</li>
                <li class="bullet-point text-white mb-2"><strong>NOA:</strong> Assets - Operating Liabilities (Invested Capital).</li>
                <li class="bullet-point text-white mb-2"><strong>NOPAT:</strong> Operating Profit - Operating Tax (removes debt shield).</li>
                <li class="bullet-point text-white mb-2"><strong>RNOA:</strong> The "Truth Teller" for operational performance.</li>
                <li class="bullet-point text-white mb-2"><strong>Leverage:</strong> Boosts ROE only if Spread is positive.</li>
            </ul>
        </div>
        <div class="text-center mt-4">
            <button class="btn" onclick="revealBullets()">Click to Reveal Summary</button>
            <button class="btn mt-4 w-100" style="background: white; color: var(--primary); border: 2px solid var(--primary);" onclick="nextSlide()">Proceed to Final Quiz <i class="fas fa-chevron-right ml-2"></i></button>
        </div>
    </div>

    <!-- Slide 30-37: Quizzes -->
    <div class="slide">
        <h2>Quiz 1: Classification</h2>
        <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">Accounts Payable is a(n):</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Operating Liability</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">Nonoperating Liability</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 2: Tax Shield</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">To get NOPAT, we adjust reported tax by:</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Adding back the tax shield</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">Subtracting interest</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>

    <div class="slide">
        <h2>Quiz 3: RNOA</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">If RNOA > ROE, the company likely has:</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">High Debt</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Excess Cash (Negative Leverage)</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>
    
    <div class="slide">
        <h2>Quiz 4: NOA</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">Calculate NOA: Op Assets = 100, Op Liab = 40, Cash = 20.</p>
            <input type="number" id="q4-input" class="fib-input" style="width:100%;" placeholder="Enter number...">
            <button class="btn mt-4" onclick="checkQ4()">Check</button>
            <p id="q4-fb" class="mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>
    
    <div class="slide">
        <h2>Quiz 5: Drivers</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">A grocery store typically has:</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">High Margin, Low Turnover</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Low Margin, High Turnover</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>
    
    <div class="slide">
        <h2>Quiz 6: Spread</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">If RNOA is 10% and Net Borrowing Cost is 5%, Leverage is:</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Beneficial (Positive)</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">Harmful (Negative)</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>
    
     <div class="slide">
        <h2>Quiz 7: Apple</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">Why is Apple's RNOA (865%) so much higher than ROE (176%)?</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Cash Drag lowers ROE</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">High Debt increases ROE</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>
    
     <div class="slide">
        <h2>Quiz 8: NOPAT Logic</h2>
         <div class="card">
            <p style="font-size: 1.5rem; margin-bottom: 2rem;">If a company has Zero Debt and Zero Cash, NOPAT equals:</p>
            <div class="grid-2">
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, true)">Net Income</button>
                <button class="btn" style="background:white; color:var(--text-color); border:2px solid #e2e8f0; box-shadow: none;" onclick="quizCheck(this, false)">Gross Profit</button>
            </div>
            <p class="quiz-feedback mt-4 text-center" style="min-height: 2rem; font-weight: bold; font-size: 1.2rem;"></p>
        </div>
    </div>

    <!-- Final Score -->
    <div class="slide">
        <div class="flex-center" style="flex-direction:column;">
            <div class="card-dark text-center" style="padding: 5rem; border-radius: 40px;">
                <i class="fas fa-trophy fa-5x text-warning mb-4" style="filter: drop-shadow(0 0 20px gold);"></i>
                <h1 class="text-white">Masterclass Complete</h1>
                <p class="text-white mt-4" style="font-size: 1.5rem;">You have mastered the advanced decomposition of ROE.</p>
                <button class="btn mt-4" style="background: white; color: var(--primary); font-size: 1.2rem; padding: 15px 40px;" onclick="location.reload()"><i class="fas fa-redo mr-2"></i> Restart Course</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div id="nav-bar">
        <div style="display:flex; align-items:center; gap:15px;">
             <div style="font-weight: 800; color: var(--primary); font-size: 1.2rem; letter-spacing: 1px;">Adv. ROE</div>
             <button class="btn-tab" onclick="jumpToSlide(1)" style="font-size:0.8rem; padding: 5px 12px; border: 1px solid var(--text-light); color: var(--text-color); background: transparent;"> <i class="fas fa-list"></i> Contents</button>
        </div>
        
        <div style="display: flex; align-items: center; flex: 1; margin: 0 20px;">
             <span id="page-indicator" style="font-weight: bold; color: var(--text-light); font-size: 0.9rem; margin-right: 15px; white-space: nowrap;">1 / 30</span>
             <div class="progress-bar" style="margin: 0; width: 100%;">
                <div id="progress-fill"></div>
            </div>
        </div>

        <div>
            <button class="btn" style="padding: 10px 20px; margin-right: 10px; background: white; color: var(--text-color); box-shadow: none; border: 1px solid #e2e8f0;" onclick="prevSlide()"><i class="fas fa-arrow-left"></i></button>
            <button class="btn" style="padding: 10px 20px;" onclick="nextSlide()"><i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

</div>

<script>
    /* --- State Management --- */
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;

    /* --- Navigation Logic --- */
    function updateNav() {
        slides.forEach((s, index) => {
            if(index === currentSlide) s.classList.add('active');
            else s.classList.remove('active');
        });
        const progress = ((currentSlide + 1) / totalSlides) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        
        // Page Number Indicator
        document.getElementById('page-indicator').innerText = (currentSlide + 1) + " / " + totalSlides;
    }

    function nextSlide() {
        if(currentSlide < totalSlides - 1) {
            currentSlide++;
            updateNav();
        }
    }

    function prevSlide() {
        if(currentSlide > 0) {
            currentSlide--;
            updateNav();
        }
    }
    
    function jumpToSlide(index) {
        currentSlide = index;
        updateNav();
    }

    /* --- Interactive Functions --- */

    // Slide 4: Balance Sheet Toggle
    function toggleBS(el, type) {
        if(el.classList.contains('selected')) {
            el.classList.remove('selected');
        } else {
            el.classList.add('selected');
            el.dataset.userChoice = type; 
        }
    }

    function checkBS() {
        const items = document.querySelectorAll('.bs-item');
        let allCorrect = true;
        
        items.forEach(item => {
            const type = item.getAttribute('onclick').includes("'op'") ? 'op' : 'non';
            const isSelected = item.classList.contains('selected');
            
            if(type === 'op') {
                if(isSelected) item.classList.add('correct');
                else { item.classList.add('wrong'); allCorrect = false; }
            } else {
                if(!isSelected) item.classList.add('correct'); 
                else { item.classList.add('wrong'); allCorrect = false; }
            }
        });

        const fb = document.getElementById('bs-feedback');
        if(allCorrect) {
            fb.innerText = "Excellent! You correctly identified the operating items.";
            fb.className = "text-center mt-2 font-weight-bold text-success";
        } else {
            fb.innerText = "Review the red items. Cash and Debt are Nonoperating.";
            fb.className = "text-center mt-2 font-weight-bold text-error";
        }
    }

    // Slide 7: Shield Animation
    function switchScenario(type, btn) {
        document.querySelectorAll('.btn-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if(type === 'debt') {
            document.getElementById('scene-debt').style.display = 'block';
            document.getElementById('scene-cash').style.display = 'none';
        } else {
            document.getElementById('scene-debt').style.display = 'none';
            document.getElementById('scene-cash').style.display = 'block';
        }
    }

    function animateShield(type) {
        if(type === 'debt') {
            const shield = document.getElementById('viz-shield-debt');
            const btn = document.getElementById('sim-btn-debt');
            const label = document.getElementById('label-debt');
            
            if(shield.style.height === '0px' || shield.style.height === '') {
                // ADD BACK SHIELD
                shield.style.height = '30px'; 
                btn.innerText = "Reset";
                btn.style.background = "#e2e8f0";
                label.innerHTML = 'Result: <strong style="color: var(--success) !important;">Tax on NOPBT (Higher)</strong>';
            } else {
                // RESET
                shield.style.height = '0px';
                btn.innerText = "Add Back Shield";
                btn.style.background = "white";
                label.innerHTML = 'Result: <strong>Op Tax > Reported Tax</strong>';
            }
        } else {
            const shield = document.getElementById('viz-shield-cash-top');
            const btn = document.getElementById('sim-btn-cash');
            const label = document.getElementById('label-cash');
            
            if(shield.style.height === '40px') {
                 // REMOVE TAX (Simulate NO Cash)
                 shield.style.height = '0px';
                 btn.innerText = "Reset";
                 btn.style.background = "#e2e8f0";
                 label.innerHTML = 'Result: <strong style="color: var(--success) !important;">Tax on NOPBT (Lower)</strong>';
            } else {
                 // RESET
                 shield.style.height = '40px';
                 btn.innerText = "Remove Inv Tax";
                 btn.style.background = "white";
                 label.innerHTML = 'Result: <strong>Op Tax < Reported Tax</strong>';
            }
        }
    }

    // Slide 22: Pfizer Leverage Simulator
    function updatePfizerLeverage() {
        const flev = parseFloat(document.getElementById('pf-lev-slider').value);
        document.getElementById('pf-lev-val').innerText = flev;
        
        // Constants for Pfizer
        const rnoa = 32.1;
        const spread = 32.2;
        
        const roe = rnoa + (flev * spread);
        document.getElementById('pf-roe-val').innerText = roe.toFixed(1) + "%"; // Placeholder text inside sim
        
        // Use existing chart IDs
        const boostVal = (flev * spread).toFixed(1);
        document.getElementById('viz-boost-bar').innerText = boostVal + "%";
        document.getElementById('viz-roe-val').innerText = roe.toFixed(1) + "%";
        
        // Update Equation Text
        document.getElementById('sim-equation').innerHTML = roe.toFixed(1) + "% = 32.1% + (" + flev + " &times; 32.2%)";
        
        const scale = 4.6;
        document.getElementById('viz-boost-bar').style.height = (boostVal * scale) + "px";
        document.getElementById('viz-roe-bar').style.height = (roe * scale) + "px";
    }

    // Slide 23: Equation Builder
    let eqParts = [];
    function addToEq(part) {
        eqParts.push(part);
        document.getElementById('eq-display').innerText = eqParts.join(" ");
        
        const str = eqParts.join("");
        // ROE = RNOA + (FLEV x Spread)
        if(str.includes("RNOA") && str.includes("FLEV") && str.includes("Spread") && str.includes("+")) {
             document.getElementById('eq-feedback').innerText = "Correct Structure!";
             document.getElementById('eq-feedback').style.color = "var(--success)";
        }
    }
    function resetEq() {
        eqParts = [];
        document.getElementById('eq-display').innerText = "";
        document.getElementById('eq-feedback').innerText = "";
    }
    
    // Slide 26: Reveal Bullets
    function revealBullets() {
        const bullets = document.querySelectorAll('.bullet-point');
        let delay = 0;
        bullets.forEach(b => {
            setTimeout(() => {
                b.classList.add('bullet-visible');
            }, delay);
            delay += 500;
        });
    }

    /* --- Final Quizzes --- */
    function quizCheck(btn, isCorrect) {
        const parent = btn.parentElement;
        const fb = parent.nextElementSibling;
        
        // Disable siblings
        Array.from(parent.children).forEach(b => b.disabled = true);
        
        if(isCorrect) {
            btn.style.background = "var(--success)";
            btn.style.color = "white";
            btn.style.border = "none";
            fb.innerText = "Correct!";
            fb.style.color = "var(--success)";
        } else {
            btn.style.background = "var(--error)";
            btn.style.color = "white";
            btn.style.border = "none";
            fb.innerText = "Incorrect.";
            fb.style.color = "var(--error)";
        }
    }
    
    function checkQ4() {
        const val = document.getElementById('q4-input').value;
        const fb = document.getElementById('q4-fb');
        if(val == 60) {
            fb.innerText = "Correct! (100 - 40)";
            fb.style.color = "var(--success)";
        } else {
            fb.innerText = "Incorrect. Formula: OA - OL";
            fb.style.color = "var(--error)";
        }
    }

    /* --- Generate TOC --- */
    function generateTOC() {
        const tocContainer = document.getElementById('toc-container');
        slides.forEach((slide, index) => {
            // Skip the TOC slide itself in the list if desired, but including it is fine for navigation consistency
            if (index === 1) return; // Optional: skip self

            let title = "Introduction";
            const h2 = slide.querySelector('h2');
            if (h2) title = h2.innerText;
            else if (index === 0) title = "Start: Advanced ROE"; // Override for first slide
            else if (index === totalSlides - 1) title = "Completion"; 

            const btn = document.createElement('div');
            btn.className = 'toc-btn';
            btn.onclick = () => jumpToSlide(index);
            btn.innerHTML = `<div class="toc-num">${index + 1}</div><span>${title}</span>`;
            tocContainer.appendChild(btn);
        });
    }

    // Init
    generateTOC();
    updateNav();

</script>

</body>
</html>
