<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced ROE Masterclass</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --secondary: #0ea5e9;
            --accent: #f43f5e;
            --accent-gradient: linear-gradient(135deg, #f43f5e 0%, #fb7185 100%);
            --success: #10b981;
            --success-gradient: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --error: #ef4444;
            --dark-box: #1e1b4b;
            --dark-gradient: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            --formula-bg: #fff9db; 
            --bg-color: #f8fafc;
            --text-color: #334155;
            --text-light: #94a3b8;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(99, 102, 241, 0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #app-container {
            width: 100%;
            max-width: 1400px;
            height: 95vh;
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            position: relative;
            box-shadow: var(--shadow-lg);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.6);
        }

        .slide {
            display: none;
            flex: 1;
            padding: 2.5rem 3.5rem;
            overflow-y: auto;
            flex-direction: column;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-soft {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; color: var(--dark-box); line-height: 1.2; }
        h1 { font-size: 3.5rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1.5rem; }
        h2 { font-size: 2.6rem; margin-bottom: 1.5rem; position: relative; display: inline-block; }
        h2::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 60px; height: 6px; background: var(--accent-gradient); border-radius: 3px; }
        
        p, li { font-size: 1.2rem; line-height: 1.6; margin-bottom: 1rem; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }

        .card { background: var(--white); padding: 2rem; border-radius: 20px; box-shadow: var(--shadow-sm); border: 1px solid #e2e8f0; height: 100%; transition: transform 0.2s; }
        .card-dark { background: var(--dark-gradient); color: var(--white); padding: 2.5rem; border-radius: 20px; position: relative; overflow: hidden; box-shadow: var(--shadow-lg); }
        .card-highlight { border-left: 8px solid var(--accent); background: white; padding: 2.2rem; border-radius: 20px; box-shadow: var(--shadow-sm); }

        .eq-box { background: #f1f5f9; padding: 20px; border-radius: 12px; font-family: 'Fira Code', monospace; margin: 15px 0; border-left: 6px solid var(--secondary); color: var(--dark-box); font-size: 1.2rem; }
        .card-dark .eq-box { background: rgba(0, 0, 0, 0.3); border-color: var(--white); color: var(--white); }

        .formula-card-styled { background: var(--formula-bg); border: 1px solid #e9ecef; padding: 25px; border-radius: 16px; color: #333; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }

        .btn { background: var(--primary-gradient); color: white; border: none; padding: 14px 28px; border-radius: 50px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-family: 'Space Grotesk'; text-transform: uppercase; letter-spacing: 0.5px; font-size: 1rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3); }
        .btn-success { background: var(--success-gradient); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #curriculum-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--glass); backdrop-filter: blur(15px); z-index: 1000; display: none; padding: 4rem; overflow-y: auto; }
        .toc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .toc-btn { background: white; border: 1px solid #e2e8f0; padding: 15px; border-radius: 12px; text-align: left; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; font-size: 1rem; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .toc-btn:hover { background: #f0f9ff; border-color: var(--secondary); transform: translateX(5px); }
        .toc-num { background: var(--primary-gradient); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 0.8rem; flex-shrink: 0; }

        .bs-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow-sm); }
        .bs-column h3 { text-align: center; font-size: 1rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 12px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .bs-item { padding: 12px 16px; margin: 6px 0; border: 2px solid #f1f5f9; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; font-weight: 600; transition: 0.2s; font-size: 1rem; }
        .bs-item.selected { background: #e0f2fe; border-color: var(--secondary); color: var(--secondary); }
        .bs-item.correct { background: #d1fae5; border-color: var(--success); color: #065f46; }
        .bs-item.wrong { background: #fee2e2; border-color: var(--error); color: #991b1b; }

        .is-table { width: 100%; border-collapse: separate; border-spacing: 0 4px; }
        .is-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 1.1rem; }
        .is-total { font-weight: 800; background: #f8fafc; color: var(--primary); }

        .tax-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; font-family: 'Space Grotesk', sans-serif; }
        .tax-table td { padding: 6px 8px; border-bottom: 1px solid #eee; }
        .tax-table tr:last-child td { border-top: 2px solid #333; border-bottom: 4px double #333; font-weight: bold; background: #f8fafc; }
        .tax-table .val { text-align: right; font-family: 'Fira Code', monospace; }

        #nav-bar { background: rgba(255,255,255,0.9); padding: 1rem 2.5rem; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #e2e8f0; z-index: 100; position: relative; }
        .progress-bar { flex: 1; height: 8px; background: #e2e8f0; margin: 0 25px; border-radius: 10px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--accent-gradient); width: 0%; transition: width 0.4s; }

        .flip-container { perspective: 1000px; cursor: pointer; height: 320px; }
        .flip-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-container.flipped .flip-inner { transform: rotateY(180deg); }
        .flip-front, .flip-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; padding: 25px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; box-shadow: var(--shadow-sm); }
        .flip-front { background: var(--dark-gradient); color: white; border: 1px solid rgba(255,255,255,0.1); }
        .flip-back { transform: rotateY(180deg); background: white; border: 4px solid var(--primary); color: var(--text-color); }

        .strategy-chart { position: relative; height: 400px; border-left: 3px solid #334155; border-bottom: 3px solid #334155; margin: 30px; margin-top: 30px; }
        
        .lever-viz { display:flex; align-items:flex-end; height: 200px; justify-content:center; gap: 25px; margin-top: 15px; }
        .lever-bar { width:70px; display:flex; flex-direction:column; justify-content:flex-end; transition: height 0.3s; border-radius: 8px 8px 0 0; position:relative; }

        .bullet-point { opacity: 0 !important; transition: 0.5s; transform: translateX(-15px); list-style: none; margin-bottom: 12px; padding: 15px; border-left: 5px solid var(--success); background: rgba(255,255,255,0.1); display: flex; align-items: center; font-size: 1.1rem; }
        .bullet-point::before { content: '✨'; margin-right: 15px; }
        .bullet-visible { opacity: 1 !important; transform: translateX(0); }

        .text-center { text-align: center; }
        .text-white { color: white !important; -webkit-text-fill-color: white !important; }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }
        .text-accent { color: var(--accent); }
        .text-primary { color: var(--primary) !important; -webkit-text-fill-color: var(--primary) !important;}
        .text-secondary { color: var(--secondary) !important; -webkit-text-fill-color: var(--secondary) !important;}
        .font-bold { font-weight: 800; }
        .mt-4 { margin-top: 2rem; }

        .def-table { width: 100%; border-collapse: collapse; margin-top: 0.8rem; }
        .def-table td { padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 1rem; text-align: left; vertical-align: top; }
        .def-table .label { font-weight: 800; color: #a5b4fc; width: 90px; }
        .def-table .name { font-weight: 600; color: white; width: 220px; }
        .def-table .formula { font-family: 'Fira Code', monospace; color: #e2e8f0; font-size: 0.95rem; }

        .scenario-footer { margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px dashed rgba(255,255,255,0.2); display: flex; justify-content: space-around; position: relative; }
        .scenario-footer::after { content: ''; position: absolute; left: 50%; top: 10%; bottom: 10%; width: 1px; background: rgba(255,255,255,0.2); }
        .scenario-footer div { text-align: center; width: 45%; }
        .scenario-footer p { font-size: 0.8rem; margin-bottom: 5px; font-family: 'Fira Code', monospace; color: #a5b4fc; }
        .scenario-footer h5 { font-size: 1rem; color: white; font-family: 'Fira Code', monospace; }

        .quadrant-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 10px;
            background: #e2e8f0;
            padding: 2px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .quadrant {
            background: white;
            padding: 15px;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .quadrant:hover { background: #f8fafc; }
        .q-title { font-weight: bold; font-size: 0.9rem; margin-bottom: 8px; text-transform: uppercase; color: var(--text-light); }
        .q-content { font-size: 1rem; color: var(--dark-box); opacity: 0.1; filter: blur(3px); transition: all 0.5s; }
        .q-content.revealed { opacity: 1; filter: blur(0); }
        .q-hint { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--primary); font-size: 0.8rem; font-weight: bold; opacity: 1; transition: 0.3s; pointer-events: none; }
        .quadrant.active .q-hint { opacity: 0; }
        
        .q-op { border-left: 4px solid var(--success); }
        .q-non { border-left: 4px solid var(--error); }
        
        .is-flow-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            justify-content: flex-start;
        }
        .is-box {
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }
        .is-box:hover { transform: scale(1.02); }
        .is-box::after {
            content: '↓';
            position: absolute;
            bottom: -16px;
            left: 50%;
            transform: translateX(-50%);
            color: #cbd5e0;
            font-size: 1.2rem;
            z-index: 10;
        }
        .is-box:last-child::after { content: none; }

        /* New Reveal Styles */
        .reveal-blur { filter: blur(5px); opacity: 0.5; transition: 0.4s; cursor: pointer; user-select: none; }
        .reveal-blur:hover { opacity: 0.8; }
        .reveal-blur.revealed { filter: blur(0); opacity: 1; cursor: default; }

        .click-box { border: 2px dashed #cbd5e0; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; color: #94a3b8; font-weight: bold; }
        .click-box:hover { border-color: var(--primary); color: var(--primary); background: #f0f9ff; }
        .click-box.revealed { border: 2px solid var(--primary); background: white; color: var(--dark-box); cursor: default; }

        /* Viz for Slide 8 (UPDATED) */
        .tax-viz-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 350px;
            padding: 30px;
            background: #f8fafc;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            position: relative;
            margin-top: 20px;
        }
        .viz-col { display: flex; flex-direction: column; align-items: center; width: 35%; transition: 0.5s; position: relative; }
        .viz-bar { width: 100%; border-radius: 12px; transition: height 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; color: white; font-weight: bold; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .viz-overlay { position: absolute; top: 0; width: 100%; transition: height 0.6s; display: flex; justify-content: center; align-items: center; font-size: 0.9rem; font-weight: bold; }
        
        .shield-connector { position: absolute; top: 10%; width: 100%; height: 2px; background: #94a3b8; border-top: 2px dashed #94a3b8; display: none; }
        .viz-label { font-size: 0.9rem; margin-top: 15px; font-weight: bold; text-align: center; color: var(--text-color); }
        .viz-sublabel { font-size: 0.75rem; color: var(--text-light); font-weight: normal; }

        /* Quiz Check Styles */
        .quiz-option {
            background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px; cursor: pointer; transition: 0.2s; text-align: left; display: flex; align-items: center; margin-bottom: 10px;
        }
        .quiz-option:hover { border-color: var(--primary); background: #f0f9ff; }
        .quiz-option.correct { border-color: var(--success); background: #d1fae5; color: #065f46; }
        .quiz-option.wrong { border-color: var(--error); background: #fee2e2; color: #991b1b; }
        .quiz-circle { width: 24px; height: 24px; border: 2px solid #cbd5e0; border-radius: 50%; margin-right: 15px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .quiz-option.correct .quiz-circle { border-color: var(--success); background: var(--success); color: white; border: none; }
        .quiz-option.wrong .quiz-circle { border-color: var(--error); background: var(--error); color: white; border: none; }

    </style>
</head>
<body>

<div id="app-container">

    <!-- Curriculum Overlay -->
    <div id="curriculum-overlay">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2>Masterclass Curriculum</h2>
            <button class="btn" style="background: var(--error);" onclick="toggleCurriculum()">Close <i class="fas fa-times"></i></button>
        </div>
        <div id="toc-grid" class="toc-grid"></div>
    </div>

    <!-- Slide 1: NEW TITLE PAGE -->
    <div class="slide active" style="padding: 1.5rem;">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
            <div class="card-dark text-center" style="padding: 4rem; border-radius: 40px; animation: pulse-soft 3s infinite ease-in-out;">
                <i class="fas fa-chart-line fa-5x text-success mb-4"></i>
                <h1 class="text-white" style="font-size: 3.5rem; margin-bottom: 1rem;">Income Statement Analysis<br>with an Operating Focus</h1>
                <p class="text-white" style="font-size: 1.4rem; opacity: 0.9;">Mastering NOPAT, RNOA, and the DuPont Framework</p>
                <button class="btn mt-4" style="background: white; color: var(--primary);" onclick="nextSlide()">Begin Class <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Slide 2: RECAP / CONCEPT CHECKS (Moved) -->
    <div class="slide">
        <h2>Recap: Concept Checks</h2>
        <p>Review key takeaways from previous content before diving deeper.</p>
        <div class="card" style="max-width: 800px; margin: 0 auto;">
            
            <div class="iq-card" style="border:none; box-shadow:none; padding:0; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:20px;">
                <div style="font-size: 1.1rem; font-weight:bold; margin-bottom: 10px;">Q: The DuPont Framework deconstructs ROE into which three components?</div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" style="font-size:0.9rem;" onclick="checkInterQuiz(this, true)">Profit Margin, Asset Turnover, Financial Leverage</button>
                    <button class="btn btn-outline" style="font-size:0.9rem;" onclick="checkInterQuiz(this, false)">Revenue, Expenses, Net Income</button>
                </div>
                <p class="inter-quiz-fb font-bold mt-2"></p>
            </div>

            <div class="iq-card" style="border:none; box-shadow:none; padding:0; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:20px;">
                <div style="font-size: 1.1rem; font-weight:bold; margin-bottom: 10px;">Q: Why is a Negative Cash Conversion Cycle (like Apple's) advantageous?</div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" style="font-size:0.9rem;" onclick="checkInterQuiz(this, false)">It means the company is losing cash.</button>
                    <button class="btn btn-outline" style="font-size:0.9rem;" onclick="checkInterQuiz(this, true)">It provides interest-free supplier financing.</button>
                </div>
                <p class="inter-quiz-fb font-bold mt-2"></p>
            </div>

            <div class="iq-card" style="border:none; box-shadow:none; padding:0; margin-bottom:20px;">
                <div style="font-size: 1.1rem; font-weight:bold; margin-bottom: 10px;">Q: When calculating ROA or ROE, which Balance Sheet figure should you use?</div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" style="font-size:0.9rem;" onclick="checkInterQuiz(this, false)">Ending Balance</button>
                    <button class="btn btn-outline" style="font-size:0.9rem;" onclick="checkInterQuiz(this, true)">Average Balance</button>
                </div>
                <p class="inter-quiz-fb font-bold mt-2"></p>
            </div>

        </div>
    </div>

    <!-- Slide 3: Hook Story (Was Slide 1) -->
    <div class="slide" style="padding: 1.5rem;">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
            <div class="card-dark" style="padding: 2rem; text-align: center; max-width: 1100px; border-radius: 30px;">
                <h1 class="text-white" style="margin-bottom: 1rem; font-size: 3rem;">Drivers of Return on Equity</h1>
                <div class="grid-2 mt-4" style="gap: 1rem;">
                    <!-- The Software Sage (Operations) -->
                    <div class="flip-container" onclick="this.classList.toggle('flipped')" style="height: 250px;">
                        <div class="flip-inner" style="height:100%">
                            <div class="flip-front" style="background: rgba(255,255,255,0.1); border: 2px solid var(--success); padding: 1.5rem;">
                                <i class="fas fa-code fa-2x mb-3 text-success"></i>
                                <h3 class="text-white" style="font-size: 1.4rem;">The Software Sage</h3>
                                <p class="text-white" style="font-size: 0.9rem;">High Margin, Zero Debt.</p>
                                <p style="font-size: 0.8rem; opacity: 0.7; margin-top:5px;">(Click to Reveal Driver)</p>
                            </div>
                            <div class="flip-back">
                                <p style="font-size: 1rem;">Earns $4M on $10M Equity. Every cent of that 40% ROE comes from pure operational brilliance. This is <strong>Operating Return</strong>.</p>
                            </div>
                        </div>
                    </div>
                    <!-- The Debt Dealer (Leverage) -->
                    <div class="flip-container" onclick="this.classList.toggle('flipped')" style="height: 250px;">
                        <div class="flip-inner" style="height:100%">
                            <div class="flip-front" style="background: rgba(255,255,255,0.1); border: 2px solid var(--accent); padding: 1.5rem;">
                                <i class="fas fa-balance-scale-right fa-2x mb-3 text-accent"></i>
                                <h3 class="text-white" style="font-size: 1.4rem;">The Debt Dealer</h3>
                                <p class="text-white" style="font-size: 0.9rem;">Low Margin, Heavy Debt.</p>
                                <p style="font-size: 0.8rem; opacity: 0.7; margin-top:5px;">(Click to Reveal Driver)</p>
                            </div>
                            <div class="flip-back">
                                <p style="font-size: 1rem;">Has only $1M equity but borrowed $9M to control $10M in assets. The return is mostly <strong>Non-operating Return</strong>.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-4" style="background: rgba(255,255,255,0.15); border: none; padding: 1.5rem; margin-top: 1rem;">
                    <p class="text-white" style="font-size: 1.1rem; margin: 0;"><strong>The Truth:</strong> Traditional ROE sees them as twins. Advanced Analysis reveals one is an artisan, the other is a risk-architect.</p>
                </div>
                <button class="btn mt-4" style="background: white; color: var(--primary); margin-top: 1.5rem;" onclick="nextSlide()">Analyze the Engines <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Slide 4: Core Problem -->
    <div class="slide">
        <h2>The Conflation Problem</h2>
        <div class="grid-2">
            <div>
                <p>Advanced Analysis separates the firm into two distinct activity buckets:</p>
                <div class="card card-highlight" style="border-left-color: var(--secondary); margin-bottom: 20px;">
                    <h3 class="text-secondary">1. Operating Engine</h3>
                    <p>Creating products and services. Measures how well the core business generates cash.</p>
                </div>
                <div class="card card-highlight" style="border-left-color: var(--accent);">
                    <h3 class="text-accent">2. Financing Choices (NNO)</h3>
                    <p>Deciding how much debt to take vs. how much cash to hold. Measures risk and capital structure.</p>
                </div>
            </div>
            <div class="card-dark text-center" style="cursor: pointer;" onclick="this.querySelector('.hidden-overlay').style.opacity = '0';">
                <div class="hidden-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(30, 27, 75, 0.9); display:flex; flex-direction:column; justify-content:center; align-items:center; transition:0.5s; z-index:10;">
                    <i class="fas fa-hand-pointer fa-2x mb-2 text-white"></i>
                    <h3 class="text-white">Click to Reveal Traditional View</h3>
                </div>
                <i class="fas fa-exclamation-circle fa-4x mb-4 opacity-50" style="margin-top: 40px;"></i>
                <h3 class="text-white">Traditional View</h3>
                <p class="eq-box" style="font-size: 2rem; background: rgba(0,0,0,0.2); border: none; color: white;">ROE = Net Income / Avg Equity</p>
                <p class="text-white">This hides whether a company is an artisan or a risk-architect.</p>
            </div>
        </div>
    </div>

    <!-- Slide 5: Concept: NOA -->
    <div class="slide">
        <h2>Concept: Net Operating Assets (NOA)</h2>
        <p>Before looking at financing, we must isolate the <strong>Operating Engine's</strong> capital base.</p>
        <div class="card-dark text-center" style="margin-bottom: 25px;">
            <h3 class="text-white" style="font-size: 2rem;">NOA = Operating Assets - Operating Liabilities</h3>
        </div>
        <div class="grid-2">
            <div class="card">
                <h4 class="text-primary">Operating Assets</h4>
                <p>Assets required to run the core business daily.</p>
                <ul class="reveal-blur" onclick="this.classList.add('revealed')" style="padding-left: 25px; font-size: 1.1rem;">
                    <li>Inventory & Accounts Receivable</li>
                    <li>Property, Plant & Equipment (Net)</li>
                    <li>Right of Use Assets</li>
                    <li>Intangible Assets & Goodwill</li>
                </ul>
                <p style="text-align:center; font-size:0.8rem; color:var(--text-light); margin-top:5px;">(Click to Reveal Items)</p>
            </div>
            <div class="card">
                <h4 class="text-secondary">Operating Liabilities</h4>
                <p><strong>Non-interest bearing</strong> obligations that arise from operations (not borrowing).</p>
                <ul class="reveal-blur" onclick="this.classList.add('revealed')" style="padding-left: 25px; font-size: 1.1rem;">
                    <li>Accounts Payable</li>
                    <li>Accrued Expenses & Wages</li>
                    <li>Unearned (Deferred) Revenue</li>
                </ul>
                <p style="text-align:center; font-size:0.8rem; color:var(--text-light); margin-top:5px;">(Click to Reveal Items)</p>
            </div>
        </div>
    </div>

    <!-- Slide 6: Concept: NNO -->
    <div class="slide">
        <h2>Concept: Net Nonoperating Obligations (NNO)</h2>
        <p>In Advanced DuPont, we look at our <strong>Net Financing Position</strong> by netting cash against debt.</p>
        <div class="card-dark text-center" style="margin-bottom: 25px;">
            <h3 class="text-white" style="font-size: 2rem;">NNO = Nonoperating Liabilities - Nonoperating Assets</h3>
        </div>
        <div class="grid-2">
            <div class="card">
                <h4 class="text-accent">Nonoperating Liabilities</h4>
                <p>Interest-bearing obligations used to fund the company.</p>
                <ul class="reveal-blur" onclick="this.classList.add('revealed')" style="padding-left: 25px; font-size: 1.1rem;">
                    <li>Short-term & Long-term Debt</li>
                    <li>Bonds Payable</li>
                    <li>Lease Obligation</li>
                </ul>
                <p style="text-align:center; font-size:0.8rem; color:var(--text-light); margin-top:5px;">(Click to Reveal Items)</p>
            </div>
            <div class="card">
                <h4 class="text-secondary">Nonoperating Assets</h4>
                <p>Cash and investments NOT needed for daily operations.</p>
                <ul class="reveal-blur" onclick="this.classList.add('revealed')" style="padding-left: 25px; font-size: 1.1rem;">
                    <li>Cash & Excess Cash</li>
                    <li>Marketable Securities</li>
                    <li>Short-term Investments</li>
                </ul>
                <p style="text-align:center; font-size:0.8rem; color:var(--text-light); margin-top:5px;">(Click to Reveal Items)</p>
            </div>
        </div>
    </div>

    <!-- Slide 7: Activity: Filter the Core -->
    <div class="slide">
        <h2>Activity: Filter the Core</h2>
        <p>Select items that belong to the <strong>Core Operating Engine</strong>. Leave NNO (Financing) items unselected.</p>
        <div class="bs-container">
            <div class="bs-column">
                <h3>Assets</h3>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Inventory</span> <span>$200</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Cash & Excess Cash</span> <span>$550</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>PPE (Factories)</span> <span>$800</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Right of Use Asset</span> <span>$150</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Goodwill</span> <span>$150</span></div>
            </div>
            <div class="bs-column">
                <h3>Liabilities & Equity</h3>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Accounts Payable</span> <span>$80</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Long-term Bonds</span> <span>$400</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'non')"><span>Lease Obligation</span> <span>$120</span></div>
                <div class="bs-item" onclick="toggleBS(this, 'op')"><span>Unearned Revenue</span> <span>$20</span></div>
            </div>
        </div>
        <div class="text-center mt-4">
            <button class="btn" onclick="checkBS()">Check Classification</button>
            <p id="bs-feedback" class="mt-2 font-bold"></p>
        </div>
    </div>

    <!-- Slide 8: Visualizing the Split -->
    <div class="slide">
        <h2>Visualizing the Split: Reclassified Statements</h2>
        <p>Explore the four quadrants to see how we reorganize the balance sheet.</p>
        <div class="grid-2">
            <!-- Balance Sheet -->
            <div class="card">
                <h3 class="text-center text-primary mb-3">Balance Sheet (Reclassified)</h3>
                <p style="text-align:center; font-size:0.8rem; margin-bottom:10px; color:var(--text-light);">(Click quadrants to populate)</p>
                <div class="quadrant-grid">
                    <div class="quadrant q-op" onclick="revealQuadrant(this)">
                        <div class="q-hint">Click to Reveal</div>
                        <div class="q-title">Operating Assets</div>
                        <div class="q-content">
                            <div>Assets required to run core business:</div>
                            <ul style="margin-left:15px; font-size:0.9rem; margin-top:5px;">
                                <li>Inventory</li>
                                <li>PP&E</li>
                                <li>Operating Cash</li>
                                <li>A/R</li>
                            </ul>
                        </div>
                    </div>
                    <div class="quadrant q-op" onclick="revealQuadrant(this)">
                        <div class="q-hint">Click to Reveal</div>
                        <div class="q-title">Operating Liabilities</div>
                        <div class="q-content">
                            <div>Spontaneous, non-interest obligations:</div>
                            <ul style="margin-left:15px; font-size:0.9rem; margin-top:5px;">
                                <li>A/P</li>
                                <li>Accrued Expenses</li>
                                <li>Deferred Revenue</li>
                            </ul>
                        </div>
                    </div>
                    <div class="quadrant q-non" onclick="revealQuadrant(this)">
                        <div class="q-hint">Click to Reveal</div>
                        <div class="q-title">Non-Operating Assets</div>
                        <div class="q-content">
                            <div>Assets not essential to operations:</div>
                            <ul style="margin-left:15px; font-size:0.9rem; margin-top:5px;">
                                <li>Excess Cash</li>
                                <li>Marketable Securities</li>
                                <li>Investments</li>
                            </ul>
                        </div>
                    </div>
                    <div class="quadrant q-non" onclick="revealQuadrant(this)">
                        <div class="q-hint">Click to Reveal</div>
                        <div class="q-title">Non-Operating Liabilities</div>
                        <div class="q-content">
                            <div>Financing-related obligations:</div>
                            <ul style="margin-left:15px; font-size:0.9rem; margin-top:5px;">
                                <li>Short-term Debt</li>
                                <li>Long-term Debt</li>
                                <li>Pension Liabilities</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:10px; gap:10px;">
                    <div style="font-size:0.8rem; background: #eff6ff; padding:8px; border-radius:8px; flex:1; color:var(--primary);">
                        <strong>Net Operating Assets (NOA)</strong><br> = Operating Assets − Operating Liabilities
                    </div>
                    <div style="font-size:0.8rem; background: #fff1f2; padding:8px; border-radius:8px; flex:1; color:var(--accent);">
                        <strong>Net Non-Operating Obligations (NNO)</strong><br> = Non-Op Liabilities − Non-Op Assets
                    </div>
                </div>
            </div>

            <!-- Income Statement -->
            <div class="card">
                <h3 class="text-center text-secondary mb-3">Income Statement (Reclassified)</h3>
                <div class="is-flow-container">
                    <div class="is-box" style="background: #f0fdf4; border: 2px solid var(--success);">
                        <div style="font-size:1.1rem; color:var(--success);">Operating Income</div>
                        <div style="font-weight:normal; margin-top:3px; font-size:0.75rem;">(Revenue - COGS - OPEX)<br>Profit generated purely from operations.<br>Independent of financing decisions.</div>
                    </div>
                    <div class="is-box" style="background: #fef2f2; border: 2px solid var(--error);">
                        <div style="font-size:1.1rem; color:var(--error);">Net Non-Operating Items</div>
                        <div style="font-weight:normal; margin-top:3px; font-size:0.75rem;">Interest Income / Expense<br>Gains/Losses from Investments</div>
                    </div>
                    <div class="is-box" style="background: #fff9db; border: 2px solid #eab308;">
                        <div style="font-size:1.1rem; color:#ca8a04;">Tax Expense</div>
                    </div>
                    <div class="is-box" style="background: var(--dark-box); color:white;">
                        <div style="font-size:1.1rem;">Net Income</div>
                        <div style="font-weight:normal; margin-top:3px; font-size:0.75rem; color:#cbd5e0;">Final bottom line.</div>
                    </div>
                </div>
                <div style="margin-top:15px; background: #f8fafc; padding:10px; border-radius:8px; font-size:0.85rem; border: 1px solid #e2e8f0;">
                      <strong>Definitions:</strong><br>
                      <span style="font-family:'Fira Code'">NOPBT = Operating income (or EBIT)</span><br>
                      <span style="font-family:'Fira Code'">NOPAT = NOPBT - tax on operating income</span><br>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkpoint 1 -->
    <div class="slide">
        <h2>Checkpoint 1: Classification</h2>
        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <p style="font-size: 1.3rem; margin-bottom: 2rem;">A company has $100M in a savings account earning 2% interest. How is this classified?</p>
            <div class="quiz-option" onclick="checkInterQuiz(this, false)">
                <div class="quiz-circle">A</div>
                <div>Operating Asset (It's an asset owned by the company)</div>
            </div>
            <div class="quiz-option" onclick="checkInterQuiz(this, true)">
                <div class="quiz-circle">B</div>
                <div>Non-Operating Asset (It earns passive interest, not from customers)</div>
            </div>
            <div class="quiz-option" onclick="checkInterQuiz(this, false)">
                <div class="quiz-circle">C</div>
                <div>Operating Liability (It is owed to the bank)</div>
            </div>
            <p class="inter-quiz-fb font-bold mt-4"></p>
        </div>
    </div>

    <!-- Slide 10: Pfizer NOA Case Study -->
    <div class="slide">
        <h2>Case Study: Pfizer's NOA (2022)</h2>
        <div class="grid-2">
            <div class="card">
                <h3>The Calculation ($M)</h3>
                <table class="is-table">
                    <tr><td>Total Operating Assets</td><td class="text-right click-box" onclick="revealNum(this, '$170,437')">?</td></tr>
                    <tr><td>(Less) Operating Liabilities</td><td class="text-right click-box" onclick="revealNum(this, '($59,939)')">?</td></tr>
                    <tr class="is-total"><td>Net Operating Assets (NOA)</td><td class="text-right">$110,498</td></tr>
                </table>
                <p class="mt-4" style="font-size: 1rem; color: var(--text-light);">*Interest-bearing Debt and Net Cash were removed to isolate the core capital base.</p>
            </div>
            <div class="card-dark text-center flex-center" style="display:flex; flex-direction:column; justify-content:center;">
                <i class="fas fa-calculator fa-4x mb-4 text-white"></i>
                <h3 class="text-white">Net Operating Assets</h3>
                <h1 style="color: white; -webkit-text-fill-color: white; font-size: 4rem;">$110.5B</h1>
                <p class="text-white" style="opacity: 0.8;">The "True" capital running the business.</p>
            </div>
        </div>
    </div>

    <!-- Slide 11: Concept: NOPAT Tax Visualizer (UPDATED) -->
    <div class="slide">
        <h2>The NOPAT Tax Logic</h2>
        <p style="margin-bottom: 2rem;">
            Net Operating Profit After Tax (NOPAT) removes the tax distortion caused by debt (which increases interest expense) and cash (increases interest income). We compare the actual tax bill to what the Core Business would owe alone.
        </p>
        
        <div class="card" style="padding: 2rem;">
            <div style="display:flex; justify-content:center; gap: 20px; margin-bottom: 0px;">
                <button class="btn btn-outline" id="btn-debt" onclick="updateTaxViz('debt')">Scenario: High Debt</button>
                <button class="btn btn-outline" id="btn-cash" onclick="updateTaxViz('cash')">Scenario: Excess Cash</button>
            </div>

            <div class="tax-viz-container">
                <!-- Column 1: Theoretical (Tax on Op Inc) -->
                <div class="viz-col">
                    <div class="viz-label" style="margin-bottom:10px;">Tax on Operating Income</div>
                    <div id="bar-op" class="viz-bar" style="height: 250px; background: var(--success-gradient);">
                        <div style="margin-top:auto; margin-bottom:10px;">Op Income $100</div>
                        <div id="overlay-op" class="viz-overlay" style="height: 50px; background: rgba(0,0,0,0.3);">
                            Tax Owed on Op Inc ($20)
                        </div>
                    </div>
                </div>

                <!-- Spacer / Shield -->
                <div style="width: 20%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10;">
                    <div id="shield-badge" style="background: var(--primary); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; margin-bottom: 10px; transition: 0.3s;">
                        Tax Shield: $4
                    </div>
                    <i class="fas fa-long-arrow-alt-right" style="color: #cbd5e0; font-size: 2rem;"></i>
                </div>

                <!-- Column 2: Actual (Reported) -->
                <div class="viz-col">
                    <div class="viz-label" style="margin-bottom:10px;">Actual (Reported)</div>
                    <div id="bar-taxable" class="viz-bar" style="height: 200px; background: var(--dark-gradient);">
                        <div id="val-taxable" style="margin-top:auto; margin-bottom:10px;">Taxable Inc $80</div>
                        <div id="overlay-taxable" class="viz-overlay" style="height: 40px; background: #f43f5e;">
                            Reported Tax ($16)
                        </div>
                    </div>
                </div>
            </div>

            <div id="viz-insight" style="margin-top: 20px; padding: 15px; border-radius: 10px; background: #eff6ff; border-left: 5px solid var(--primary); font-size: 1.1rem; transition: 0.3s;">
                <!-- JS populates this -->
            </div>
        </div>
    </div>

    <!-- Checkpoint 2 -->
    <div class="slide">
        <h2>Checkpoint 2: Tax Logic</h2>
        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <p style="font-size: 1.3rem; margin-bottom: 2rem;">If a company has high Interest Expense, their Taxable Income is LOWER than their Operating Income. This means their Reported Tax is _________ than the tax owed on operating income.</p>
            <div class="quiz-option" onclick="checkInterQuiz(this, true)">
                <div class="quiz-circle">A</div>
                <div>Lower (Positive Tax Shield)</div>
            </div>
            <div class="quiz-option" onclick="checkInterQuiz(this, false)">
                <div class="quiz-circle">B</div>
                <div>Higher (Negative Tax Shield)</div>
            </div>
            <div class="quiz-option" onclick="checkInterQuiz(this, false)">
                <div class="quiz-circle">C</div>
                <div>The same</div>
            </div>
            <p class="inter-quiz-fb font-bold mt-4"></p>
        </div>
    </div>

    <!-- Slide 13: Method 1: Top Down -->
    <div class="slide">
        <h2>Method 1: Top Down NOPAT</h2>
        <p>Start from the operating profit before tax and apply the true operating tax.</p>
        <div class="grid-2">
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="card-dark">
                    <h3 class="text-white">The Formula</h3>
                    <div class="eq-box" style="font-size: 1.4rem; text-align: center;">
                        NOPAT = NOPBT - Taxes on Operating Income
                    </div>
                </div>

                <div class="flip-container" onclick="this.classList.toggle('flipped')" style="height: 250px;">
                    <div class="flip-inner" style="height:100%">
                        <div class="flip-front" style="background: white; border: 2px solid var(--primary); color: var(--text-color); box-shadow: var(--shadow-sm);">
                            <h3 class="text-primary"><i class="fas fa-question-circle mr-2"></i>Critical Question</h3>
                            <p class="font-bold mt-2" style="font-size: 1.1rem; line-height: 1.3;">Why can't we just do NOPBT * (1 - Tax Rate)?</p>
                            <p style="font-size: 0.8rem; opacity: 0.7; margin-top:5px;">(Click to Reveal Answer)</p>
                        </div>
                        <div class="flip-back" style="background: var(--primary); color: white; border: none; padding: 20px; text-align: left;">
                             <p style="font-size: 0.95rem;">Tax expense on the income statement is not taxable income × statutory tax rate due to a variety of deductions.</p>
                             <p style="font-size: 0.95rem; margin-top:10px;">However, <strong>non-operating items (such as interest expense)</strong> typically carry a full tax benefit at the full statutory rate.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="text-primary" style="font-size: 1.3rem;">Pfizer Tax Analysis (2022)</h3>
                <table class="tax-table">
                    <tr><td>U.S. statutory income tax rate</td><td class="val">21.0%</td></tr>
                    <tr><td>Taxation of non-U.S. operations</td><td class="val reveal-blur" onclick="this.classList.add('revealed')">(5.0)</td></tr>
                    <tr><td>Tax settlements and resolution...</td><td class="val reveal-blur" onclick="this.classList.add('revealed')">(3.0)</td></tr>
                    <tr><td>Foreign-derived intangible income...</td><td class="val reveal-blur" onclick="this.classList.add('revealed')">(1.9)</td></tr>
                    <tr><td>U.S. R&D tax credit</td><td class="val reveal-blur" onclick="this.classList.add('revealed')">(0.6)</td></tr>
                    <tr><td>Interest</td><td class="val">0.2</td></tr>
                    <tr><td>All other, net</td><td class="val">(1.1)</td></tr>
                    <tr><td>Effective tax rate</td><td class="val">9.6%</td></tr>
                </table>
                <div style="margin-top: 15px; font-size: 0.85rem; color: var(--text-light); border-top: 1px solid #eee; padding-top:10px;">
                    <i class="fas fa-info-circle"></i> <strong>Note:</strong> Items reducing rate to 9.6% are Operating. Financing items use Statutory Rate (22% est).
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 14: Method 2: Bottom Up -->
    <div class="slide">
        <h2>Method 2: Bottom Up NOPAT</h2>
        <p>Start from Net Income and "add back" the financing impact net of tax.</p>
        <div class="card-dark">
            <h3 class="text-white">Build The Equation</h3>
            
            <div class="eq-box" style="font-size: 2rem; text-align: center; margin: 2.5rem 0; min-height: 80px; transition: 0.3s;">
                NOPAT = Net Income + [Net Non-Op Exp × (1 - t)]
            </div>
            
            <p class="text-white">Because Net Income is an <strong>after-tax</strong> number, we must add back the <strong>after-tax</strong> cost of interest.</p>
            <div style="margin-top: 25px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px;">
                <p class="text-white" style="font-size: 1.1rem; opacity: 0.9;">
                    <i class="fas fa-info-circle mr-1"></i> By adding this back, you are effectively <strong>removing the financing impact</strong> from Net Income to isolate the core engine.
                </p>
            </div>
        </div>
    </div>

    <!-- Slide 15: Scenario 1 -->
    <div class="slide">
        <h2>Scenario 1: Net Non-Op Expense Case</h2>
        <div class="grid-2">
            <div class="card">
                <h3>Data: Debt Co.</h3>
                <ul class="mt-4">
                    <li>NOPBT: $1,000</li>
                    <li>Interest Expense: $100</li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: $720</li>
                    <li>Reported Tax: $180</li>
                </ul>
            </div>
            <div class="card-dark">
                <h3 class="text-white">Calculated Result</h3>
                <div style="margin: 20px 0;">
                    <h1 class="text-success" style="font-size: 4rem;">NOPAT = $800</h1>
                    <p class="text-white" style="opacity: 0.8;">Both methodologies converge here:</p>
                </div>
                <div class="scenario-footer">
                    <div>
                        <p>Top Down Formula</p>
                        <h5 class="reveal-blur" onclick="this.classList.add('revealed')">$1,000 - ($180 + $20 Shield)</h5>
                    </div>
                    <div>
                        <p>Bottom Up Formula</p>
                        <h5 class="reveal-blur" onclick="this.classList.add('revealed')">$720 + ($100 × 0.8)</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 16: Scenario 2 -->
    <div class="slide">
        <h2>Scenario 2: Net Non-Op Income Case</h2>
        <div class="grid-2">
            <div class="card">
                <h3>Data: Cash Co.</h3>
                <ul class="mt-4">
                    <li>NOPBT: $1,000</li>
                    <li>Interest <em>Income</em>: $100</li>
                    <li>Tax Rate: 20%</li>
                    <li>Net Income: $880</li>
                    <li>Reported Tax: $220</li>
                </ul>
            </div>
            <div class="card-dark">
                <h3 class="text-white">Calculated Result</h3>
                <div style="margin: 20px 0;">
                    <h1 class="text-success" style="font-size: 4rem;">NOPAT = $800</h1>
                    <p class="text-white" style="opacity: 0.8;">Non-op income is successfully removed:</p>
                </div>
                <div class="scenario-footer">
                    <div>
                        <p>Top Down Formula</p>
                        <h5 class="reveal-blur" onclick="this.classList.add('revealed')">$1,000 - ($220 - $20 ExtraTax)</h5>
                    </div>
                    <div>
                        <p>Bottom Up Formula</p>
                        <h5 class="reveal-blur" onclick="this.classList.add('revealed')">$880 - ($100 × 0.8)</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 17: Pfizer NOPAT Study -->
    <div class="slide">
        <h2>Case Study: Pfizer's NOPAT (2022)</h2>
        <div class="card">
            <table class="is-table">
                <tr><td>Operating Profit (NOPBT)</td><td class="text-right">$34,719</td></tr>
                <tr><td>Reported Tax Expense</td><td class="text-right">$3,328</td></tr>
                <tr><td class="text-accent">Tax Shield Adjustment (from NNE)</td><td class="text-right click-box" onclick="revealNum(this, '($2)')">?</td></tr>
                <tr class="is-total"><td>= Taxes on Operating Income</td><td class="text-right">$3,326</td></tr>
                <tr style="background: var(--dark-gradient); color: white; font-weight: bold; font-size: 1.4rem;">
                    <td class="text-white">NOPAT (Net Operating Profit After Tax)</td><td class="text-right text-white">$31,393</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Slide 18: RNOA Reveal -->
    <div class="slide">
        <h2>The Result: RNOA</h2>
        <p>Combining NOPAT and NOA gives us the "Truth Teller" of performance.</p>
        <div class="eq-box" style="text-align: center; font-size: 2.2rem; border-color: var(--primary);">
            <span class="text-primary">R</span><span class="text-accent">N</span><span class="text-primary">OA</span> = NOPAT / Average NOA
        </div>
        <div class="grid-2 mt-4">
            <div class="card-dark text-center" style="border: 2px solid var(--accent); cursor: pointer;" onclick="this.querySelector('.content').style.opacity = 1; this.querySelector('.overlay').style.opacity = 0;">
                <div class="overlay" style="position: absolute; top:0; left:0; width:100%; height:100%; background: #1e1b4b; display:flex; justify-content:center; align-items:center; z-index:5; transition:0.5s;">
                    <h3 class="text-white">Reveal Traditional ROA</h3>
                </div>
                <div class="content" style="opacity:0; transition:0.5s;">
                    <h3 class="text-white">Traditional <span class="text-white">ROA</span></h3>
                    <h1 style="font-size: 4.5rem;" class="text-white">16.6%</h1>
                    <p class="text-white">Diluted by excess cash and debt.</p>
                </div>
            </div>
            <div class="card-dark text-center" style="border: 2px solid var(--success); cursor: pointer;" onclick="this.querySelector('.content').style.opacity = 1; this.querySelector('.overlay').style.opacity = 0;">
                <div class="overlay" style="position: absolute; top:0; left:0; width:100%; height:100%; background: #1e1b4b; display:flex; justify-content:center; align-items:center; z-index:5; transition:0.5s;">
                    <h3 class="text-success">Reveal RNOA</h3>
                </div>
                <div class="content" style="opacity:0; transition:0.5s;">
                    <h3 class="text-white">Operational <span class="text-primary">R</span><span class="text-accent">N</span><span class="text-primary">OA</span></h3>
                    <h1 class="text-success" style="-webkit-text-fill-color: var(--success); font-size: 4.5rem;">32.1%</h1>
                    <p class="text-white">Pure Operating Efficiency.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 19: Drivers (NOPM & NOAT) -->
    <div class="slide">
        <h2>Decomposing RNOA</h2>
        <div class="grid-2" style="margin-bottom: 20px;">
            <div class="card-dark" style="border-left: 10px solid var(--primary); padding: 1.5rem;">
                <h3 class="text-white"><span class="text-accent">NO</span><span class="text-secondary">PM</span></h3>
                <p class="text-white">Net Operating Profit Margin</p>
                <div class="eq-box" style="margin: 10px 0; font-size: 1rem;">NOPAT / Sales</div>
            </div>
            <div class="card-dark" style="border-left: 10px solid var(--secondary); padding: 1.5rem;">
                <h3 class="text-white"><span class="text-accent">NO</span><span class="text-secondary">AT</span></h3>
                <p class="text-white">Net Operating Asset Turnover</p>
                <div class="eq-box" style="margin: 10px 0; font-size: 1rem;">Sales / Avg NOA</div>
            </div>
        </div>
        
        <!-- SVG Strategy Chart -->
        <div class="strategy-chart">
            <svg width="100%" height="100%" viewBox="0 0 800 400" preserveAspectRatio="none">
                <!-- Axes -->
                <line x1="50" y1="350" x2="750" y2="350" stroke="#334155" stroke-width="2" /> <!-- X -->
                <line x1="50" y1="350" x2="50" y2="50" stroke="#334155" stroke-width="2" /> <!-- Y -->
                
                <!-- Labels -->
                <text x="400" y="390" text-anchor="middle" font-weight="bold" fill="#334155">Net Operating Profit Margin</text>
                <text x="20" y="200" transform="rotate(-90 20,200)" text-anchor="middle" font-weight="bold" fill="#334155">Net Operating Asset Turnover</text>

                <!-- Iso-RNOA Curve (approximate hyperbola) -->
                <path d="M 120 50 Q 150 250 750 330" fill="none" stroke="#f97316" stroke-width="4" />
                
                <!-- Points -->
                <!-- Consumer Staples: High Turn (Top), Low Margin (Left) -->
                <g class="chart-point" style="cursor: pointer;">
                    <circle cx="120" cy="50" r="8" fill="#3b82f6" stroke="white" stroke-width="2">
                        <animate attributeName="r" values="8;10;8" dur="2s" repeatCount="indefinite" />
                    </circle>
                    <text x="135" y="55" font-size="12" font-weight="bold" fill="#334155">Consumer Staples</text>
                </g>

                <!-- Semiconductors: Low Turn (Bottom), High Margin (Right) -->
                <g class="chart-point" style="cursor: pointer;">
                    <circle cx="700" cy="310" r="8" fill="#3b82f6" stroke="white" stroke-width="2" />
                    <text x="680" y="315" font-size="12" font-weight="bold" fill="#334155" text-anchor="end">Semiconductors</text>
                </g>

                <!-- Pfizer: Low Turn (Bottom), High Margin (Right) -->
                <!-- 31% Margin, 0.89 Turn (moved higher to avoid X axis overlap) -->
                <g class="chart-point" style="cursor: pointer;">
                    <circle cx="740" cy="300" r="8" fill="#6366f1" stroke="white" stroke-width="3" />
                    <text x="740" y="290" font-size="12" font-weight="bold" fill="#6366f1" text-anchor="middle">Pfizer (31%, 0.89)</text>
                </g>
                
                <!-- Other Dots to simulate scatter -->
                <circle cx="200" cy="200" r="6" fill="#64748b" opacity="0.6" />
                <circle cx="300" cy="280" r="6" fill="#64748b" opacity="0.6" />
                <circle cx="450" cy="310" r="6" fill="#64748b" opacity="0.6" />
                <circle cx="550" cy="320" r="6" fill="#64748b" opacity="0.6" />
            </svg>
        </div>
    </div>

    <!-- Checkpoint 3 -->
    <div class="slide">
        <h2>Checkpoint 3: Drivers</h2>
        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <p style="font-size: 1.3rem; margin-bottom: 2rem;">If a company wants to increase RNOA without changing its product margins (NOPM), what must it do?</p>
            <div class="quiz-option" onclick="checkInterQuiz(this, true)">
                <div class="quiz-circle">A</div>
                <div>Increase Asset Turnover (Generate more sales per dollar of assets)</div>
            </div>
            <div class="quiz-option" onclick="checkInterQuiz(this, false)">
                <div class="quiz-circle">B</div>
                <div>Increase Leverage (Borrow more money)</div>
            </div>
            <div class="quiz-option" onclick="checkInterQuiz(this, false)">
                <div class="quiz-circle">C</div>
                <div>Decrease Tax Rate</div>
            </div>
            <p class="inter-quiz-fb font-bold mt-4"></p>
        </div>
    </div>

    <!-- Slide 21: ANALYSIS DECISION -->
    <div class="slide">
        <h2>ANALYSIS DECISION: You Are the CEO</h2>
        <div class="card card-highlight">
            <p style="font-size: 1.4rem; margin-bottom: 2rem;">
                You are analyzing the performance of your company. Your analysis of RNOA reveals the following (industry benchmarks in parentheses): 
                <strong>RNOA is 16% (10%)</strong>, <strong>NOPM is 18% (17%)</strong>, and <strong>NOAT is 0.89 (0.59)</strong>. 
                <br><br>
                What interpretations do you draw that are useful for managing your company?
            </p>
            <button class="btn btn-success" onclick="toggleCEOAnswer()">Reveal Strategy Analysis</button>
            <div id="ceo-answer" style="display: none; margin-top: 2rem; padding: 2rem; background: #f0fdf4; border-radius: 12px; border: 1px solid #bcf0da;">
                <ul style="font-size: 1.2rem; padding-left: 20px;">
                    <li style="margin-bottom: 1.2rem;">
                        <strong>Analysis:</strong> You beat competitors (16% vs 10% RNOA) purely on speed (0.89 vs 0.59 Turnover). Margins are identical (~18%).
                    </li>
                    <li>
                        <strong>Upshot:</strong> Your efficiency is maxed out. Stop chasing turnover. Pivot strategy to <strong>improving Margins</strong> to unlock next-level growth.
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Slide 22: ROE Decomposition Definitions -->
    <div class="slide">
        <h2>ROE = Operating Return + Non-operating Return</h2>
        <p>A surgical breakdown of exactly how returns are created.</p>
        <div class="card-dark" style="padding: 2.5rem 2rem; min-height: 520px; height: auto;">
            <div style="display:flex; justify-content:center; align-items:flex-end; gap:10px; margin-bottom:1.5rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px;">
                <h3 class="text-white" style="margin:0;">ROE = </h3>
                <div style="text-align:center;">
                    <span style="font-size:0.8rem; color:#94a3b8; display:block; margin-bottom:5px;">Operating Return</span>
                    <h3 style="margin:0;"><span class="text-primary">R</span><span class="text-accent">N</span><span class="text-primary">OA</span></h3>
                </div>
                <h3 class="text-white" style="margin:0;"> + </h3>
                <div style="text-align:center;">
                    <span style="font-size:0.8rem; color:#f43f5e; display:block; margin-bottom:5px;">Non-operating Return <span style="background:#ffe4e6; color:#be123c; font-size:0.6rem; padding:2px 6px; border-radius:10px; vertical-align:middle; font-weight:bold;">BONUS</span></span>
                    <h3 class="text-white" style="margin:0;">(FLEV &times; Spread)</h3>
                </div>
            </div>

            <table class="def-table">
                <tr>
                    <td class="label">NNO</td>
                    <td class="name">Net nonoperating obligations</td>
                    <td class="formula">Nonoperating liabilities – Nonoperating assets</td>
                </tr>
                <tr>
                    <td class="label">FLEV</td>
                    <td class="name">Financial leverage</td>
                    <td class="formula">Average NNO / Average total stockholders’ equity</td>
                </tr>
                <tr>
                    <td class="label">NNE</td>
                    <td class="name">Net nonoperating expense after tax</td>
                    <td class="formula">NOPAT – Total net income; or [Nonoperating expenses &times; (1 – Statutory Tax Rate)]</td>
                </tr>
                <tr>
                    <td class="label">NNEP</td>
                    <td class="name">Net nonoperating expense %</td>
                    <td class="formula">NNE / Average NNO</td>
                </tr>
                <tr>
                    <td class="label">Spread</td>
                    <td class="name">Operational Spread</td>
                    <td class="formula">RNOA – NNEP</td>
                </tr>
            </table>
            <div class="grid-2 mt-4">
                <div style="font-size: 1rem; color: #a5b4fc; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                    <strong>FLEV Interpretation:</strong> Net debt (debt net of cash and investments) relative to shareholders' investment.
                </div>
                <div style="font-size: 1rem; color: #fb7185; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                    <strong>Spread Interpretation:</strong> Difference between what net operating assets earn and what net debt costs.
                </div>
            </div>
        </div>
        
        <div class="grid-2 mt-4">
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner" style="height:100%">
                    <div class="flip-front" style="background: var(--primary-gradient);">
                        <h4 class="text-white">Strategy 1: Increase FLEV</h4>
                        <p class="text-white" style="font-size: 1rem; opacity: 0.8;">Borrowing more proportionately.</p>
                        <p style="margin-top:10px; font-size:0.8rem; color:white;">(Click to Flip)</p>
                    </div>
                    <div class="flip-back">
                        <p>Increase FLEV by borrowing more, which increases NNO relative to equity. This multiplies the Operational Spread for shareholders.</p>
                    </div>
                </div>
            </div>
            <div class="flip-container" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner" style="height:100%">
                    <div class="flip-front" style="background: var(--accent-gradient);">
                        <h4 class="text-white">Strategy 2: Increase Spread</h4>
                        <p class="text-white" style="font-size: 1rem; opacity: 0.8;">Borrowing at a lower cost.</p>
                        <p style="margin-top:10px; font-size:0.8rem; color:white;">(Click to Flip)</p>
                    </div>
                    <div class="flip-back">
                        <p>Lower interest costs decrease NNEP and increase the Operational Spread, allowing stockholders to enjoy higher returns for every dollar borrowed.</p>
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-top: 2rem; padding: 1.5rem; border-radius: 12px; background: #eff6ff; border: 1px solid #dbeafe;">
            <p style="font-size: 1.1rem; margin: 0; color: #1e40af; text-align: center;">
                <strong>Upshot:</strong> If a company can borrow more funds at the same rate or borrow at a lower rate, stockholders enjoy a higher ROE.
            </p>
        </div>
    </div>

    <!-- Slide 23: Leverage Simulator -->
    <div class="slide">
        <h2>Leverage Simulator (Pfizer Case Study)</h2>
        <p>See how Pfizer's massive positive spread turns small leverage into an ROE powerhouse.</p>
        
        <div class="formula-card-styled" style="margin-bottom: 2rem; position: relative; padding: 35px;">
            <div style="display: flex; justify-content: center; align-items: center; font-size: 1.3rem; gap: 10px; font-weight: 700;">
                <span style="flex-shrink:0;">Nonoperating return =</span>
                <!-- FLEV Column -->
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div style="display: flex; flex-direction: column; align-items: center; min-width: 140px;">
                        <div style="border-bottom: 2px solid #333; padding: 0 10px;">Average NNO</div>
                        <div>Average EQ</div>
                    </div>
                    <div style="color: #f43f5e; margin-top: 8px; font-size: 1rem; font-weight: 800;">
                        <i class="fas fa-long-arrow-alt-up"></i><br>FLEV
                    </div>
                </div>
                <span style="padding-bottom: 50px;">&times;</span>
                <!-- Spread Column -->
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div style="padding: 10px 0;">(RNOA - NNEP)</div>
                    <div style="color: #f43f5e; margin-top: 8px; font-size: 1rem; font-weight: 800;">
                        <i class="fas fa-long-arrow-alt-up"></i><br>Spread
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem; background: #f8fafc; padding: 1.5rem;">
            <div class="grid-3">
                <div class="text-center">
                    <p style="font-size: 1rem; color: var(--text-light); margin-bottom: 5px;">RNOA</p>
                    <h3 class="text-primary" style="margin: 0; font-size: 1.8rem;">32.1%</h3>
                </div>
                <div class="text-center" style="border-left: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                     <p style="font-size: 1rem; color: var(--text-light); margin-bottom: 5px;">NNEP</p>
                    <h3 style="margin: 0; font-size: 1.8rem;">~0%</h3>
                </div>
                <div class="text-center">
                     <p style="font-size: 1rem; color: var(--text-light); margin-bottom: 5px;">Spread</p>
                    <h3 class="text-success" style="margin: 0; font-size: 1.8rem;">~32%</h3>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; align-items:center; gap:25px; margin-bottom: 20px;">
                <label class="font-bold" style="font-size: 1.1rem;">Adjust FLEV (Net Debt / Equity):</label>
                <input type="range" id="flev-slider" min="0" max="1.5" step="0.05" value="0.13" oninput="updateSim()" style="flex:1;">
                <span id="flev-val" class="font-bold text-primary" style="font-size: 1.2rem;">0.13</span>
            </div>
            <div class="lever-viz">
                <div style="text-align:center;">
                    <div class="lever-bar" style="height: 120px; background: var(--primary-gradient); width: 80px;">
                        <span style="position:absolute; top:-30px; left:0; width:100%; color: var(--primary); font-weight:bold; font-size:1rem;">32.1%</span>
                    </div>
                    <p style="margin-top:10px; font-weight:bold; font-size:1rem;">RNOA</p>
                </div>
                <div style="font-size: 2rem; padding-bottom: 40px;">+</div>
                <div style="text-align:center;">
                    <div id="sim-boost-bar" class="lever-bar" style="height: 20px; background: var(--accent-gradient); width: 80px;">
                        <span id="sim-boost-text" style="position:absolute; top:-35px; left:0; width:100%; color: var(--accent); font-weight:bold; font-size:1rem;">4.2%</span>
                    </div>
                    <p style="margin-top:10px; font-weight:bold; font-size:1rem;">Boost</p>
                </div>
                <div style="font-size: 2rem; padding-bottom: 40px;">=</div>
                <div style="text-align:center;">
                    <div id="sim-roe-bar" class="lever-bar" style="height: 140px; background: var(--success-gradient); width: 100px;">
                        <span id="sim-roe-text" style="position:absolute; top:-35px; left:0; width:100%; color: var(--success); font-size:1.4rem; font-weight:bold;">36.3%</span>
                    </div>
                    <p style="margin-top:10px; font-weight:bold; font-size:1rem;">ROE</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 24: Apple Case Study (Flip Card) -->
    <div class="slide">
        <h2>Case Study: Apple (Cash Drag)</h2>
        <div class="flex-center" style="height: 450px; display:flex; justify-content:center; align-items:center;">
            <div class="flip-container" onclick="this.classList.toggle('flipped')" style="width: 700px; height: 350px;">
                <div class="flip-inner" style="height:100%">
                    <div class="flip-front">
                        <i class="fab fa-apple fa-4x mb-4 text-white"></i>
                        <h3 class="text-white">Apple 2022</h3>
                        <div class="grid-2 mt-4" style="width: 100%;">
                            <div style="text-align:center;">
                                <h1 class="text-white" style="font-size: 4rem;">865%</h1>
                                <p class="text-white" style="font-size: 1rem;">RNOA</p>
                            </div>
                            <div style="text-align:center;">
                                <h1 class="text-white" style="font-size: 4rem;">176%</h1>
                                <p class="text-white" style="font-size: 1rem;">ROE</p>
                            </div>
                        </div>
                        <p class="mt-4 text-white" style="opacity: 0.8;">(Click to see why ROE is lower than RNOA)</p>
                    </div>
                    <div class="flip-back" style="padding: 2.5rem; display:flex; flex-direction:column; justify-content:center;">
                        <h3 class="text-error">The Cash Drag</h3>
                        <div style="width: 100%; box-sizing: border-box; background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 12px; margin: 15px 0;">
                            <p style="font-family: 'Fira Code', monospace; font-size: 0.85rem; color: var(--error); white-space: nowrap; overflow-x: auto;">
                                ROE (175.5%) = RNOA (864.9%) + [FLEV (-0.80) &times; Spread (865.5%)]
                            </p>
                        </div>
                        <p style="font-size: 1rem; margin-bottom: 10px;">
                            <strong>Why is FLEV negative?</strong> Apple holds massive cash reserves (~$100B+), meaning its Net Non-Operating Obligations are negative (it is a net lender).
                        </p>
                        <p style="font-size: 1rem;">This negative leverage drags the stellar 865% RNOA down to a 176% ROE.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 25: Strategic Summary -->
    <div class="slide">
        <h2>Strategic Management Summary</h2>
        <div class="card-dark" style="min-height: 600px;">
            <ul style="padding: 0;">
                <li class="bullet-point text-white">
                    <strong>The Operational Truth:</strong> Disaggregation forces you to check if high returns are driven by raw performance (RNOA) or just a low-cost debt multiplier.
                </li>
                <li class="bullet-point text-white">
                    <strong>Efficiency vs. Engineering:</strong> Superior managers generate ROE through NOPM and NOAT, rather than relying on financial engineering through FLEV.
                </li>
                <li class="bullet-point text-white">
                    <strong>The Leverage Trap:</strong> Debt only creates value when Operational Spread is positive. If RNOA falls below interest rates, leverage destroys value faster than it built it.
                </li>
                <li class="bullet-point text-white">
                    <strong>Safety's Opportunity Cost:</strong> Cash Drag (ROE < RNOA) reveals the hidden cost of liquidity. Managers must choose between the safety of cash and the high returns of reinvestment.
                </li>
                <li class="bullet-point text-white">
                    <strong>Diagnostic Benchmarking:</strong> Use RNOA disaggregation to find specifically where competitors are beating you—is it pricing power (NOPM) or speed of sales (NOAT)?
                </li>
            </ul>
        </div>
        <div class="text-center mt-4">
            <button class="btn" style="background: white; color: var(--primary);" onclick="revealSummary()">Reveal Strategic Insights</button>
        </div>
    </div>

    <!-- Slide 26: CONSOLIDATED FINAL QUIZ -->
    <div class="slide">
        <h2>Final Knowledge Check</h2>
        <div class="card">
            
            <!-- Q1: NOA Calc -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 1:</strong> Calculate NOA: Op Assets = 500, Op Liab = 200, Excess Cash = 100.</p>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="q4-input" class="fib-input" style="padding: 15px; font-size: 1.2rem; width: 200px; border: 2px solid #e2e8f0; border-radius: 12px;" placeholder="Enter value">
                    <button class="btn" onclick="checkQ4()">Submit</button>
                </div>
                <p id="q4-fb" class="mt-2 font-bold"></p>
            </div>

            <hr style="margin: 20px 0; border:0; border-top:1px solid #eee;">

            <!-- Q2: Business Models -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 2:</strong> A high-end luxury brand usually has:</p>
                <div class="grid-2 mt-4">
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">High Margin, Low Turnover</button>
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Low Margin, High Turnover</button>
                </div>
                <p class="quiz-feedback mt-4 text-center font-bold"></p>
            </div>

            <hr style="margin: 20px 0; border:0; border-top:1px solid #eee;">

            <!-- Q3: Spread -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 3:</strong> If Spread is 0, ROE will be:</p>
                <div class="grid-2 mt-4">
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Equal to RNOA</button>
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Zero</button>
                </div>
                <p class="quiz-feedback mt-4 text-center font-bold"></p>
            </div>

            <hr style="margin: 20px 0; border:0; border-top:1px solid #eee;">

            <!-- Q4: Apple Logic -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 4:</strong> Holding $100B in cash at 2% returns while Ops earn 30% is:</p>
                <div class="grid-2 mt-4">
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Value Enhancing</button>
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Return Dilutive (Cash Drag)</button>
                </div>
                <p class="quiz-feedback mt-4 text-center font-bold"></p>
            </div>

            <hr style="margin: 20px 0; border:0; border-top:1px solid #eee;">

            <!-- Q5: Pure NOPAT -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 5:</strong> If a company has Zero NNO (Debt = Cash), NOPAT is:</p>
                <div class="grid-2 mt-4">
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Equal to Net Income</button>
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Zero</button>
                </div>
                <p class="quiz-feedback mt-4 text-center font-bold"></p>
            </div>

            <hr style="margin: 20px 0; border:0; border-top:1px solid #eee;">

            <!-- Q6: RNOA Calc -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 6:</strong> If NOPAT is $100 and Average NOA is $500, what is RNOA?</p>
                <div class="grid-2 mt-4">
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">5%</button>
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">20%</button>
                </div>
                <p class="quiz-feedback mt-4 text-center font-bold"></p>
            </div>

            <hr style="margin: 20px 0; border:0; border-top:1px solid #eee;">

            <!-- Q7: RNOA Impact -->
            <div style="margin-bottom: 40px;">
                <p style="font-size: 1.3rem;"><strong>Question 7:</strong> Which action reduces RNOA?</p>
                <div class="grid-2 mt-4">
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, true)">Increasing Operating Assets (without sales growth)</button>
                    <button class="btn" style="background: white; border: 2px solid #ccc; color: black;" onclick="quizCheck(this, false)">Increasing Profit Margins</button>
                </div>
                <p class="quiz-feedback mt-4 text-center font-bold"></p>
            </div>

        </div>
    </div>

    <!-- Final Slide -->
    <div class="slide">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
            <div class="card-dark text-center" style="padding: 6rem; border-radius: 40px;">
                <i class="fas fa-trophy fa-5x text-warning mb-4"></i>
                <h1 class="text-white">Masterclass Complete</h1>
                <p class="text-white mt-4" style="font-size: 1.4rem;">You've mastered Advanced DuPont Analysis.</p>
                <button class="btn mt-4" style="background: white; color: var(--primary);" onclick="location.reload()">Restart Course</button>
            </div>
        </div>
    </div>

    <!-- Nav Bar -->
    <div id="nav-bar">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="font-weight: 800; color: var(--primary); font-size: 1rem;">ADVANCED ROE</div>
            <button class="btn" style="padding: 8px 14px; font-size: 0.8rem; border-radius: 6px;" onclick="toggleCurriculum()"><i class="fas fa-list mr-1"></i> Curriculum</button>
        </div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div>
            <button class="btn" style="padding: 10px 20px; background: white; color: black; border: 1px solid #ccc;" onclick="prevSlide()">Back</button>
            <button class="btn" style="padding: 10px 20px;" onclick="nextSlide()">Next</button>
        </div>
    </div>

</div>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;

    function updateNav() {
        slides.forEach((s, i) => s.classList.toggle('active', i === currentSlide));
        const progress = ((currentSlide + 1) / totalSlides) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        window.scrollTo(0, 0);
    }

    function nextSlide() { if(currentSlide < totalSlides - 1) { currentSlide++; updateNav(); } }
    function prevSlide() { if(currentSlide > 0) { currentSlide--; updateNav(); } }
    function jumpToSlide(i) { currentSlide = i; if(document.getElementById('curriculum-overlay').style.display === 'block') toggleCurriculum(); updateNav(); }

    function toggleCurriculum() {
        const overlay = document.getElementById('curriculum-overlay');
        overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';
    }

    function toggleCEOAnswer() {
        const ans = document.getElementById('ceo-answer');
        ans.style.display = ans.style.display === 'none' ? 'block' : 'none';
    }

    function toggleBS(el, type) { el.classList.toggle('selected'); }

    function checkBS() {
        const items = document.querySelectorAll('.bs-item');
        let allCorrect = true;
        items.forEach(item => {
            const isOp = item.getAttribute('onclick').includes("'op'");
            const isSelected = item.classList.contains('selected');
            item.classList.remove('correct', 'wrong');
            if (isOp) {
                if (isSelected) item.classList.add('correct');
                else { item.classList.add('wrong'); allCorrect = false; }
            } else {
                if (!isSelected) item.classList.add('correct');
                else { item.classList.add('wrong'); allCorrect = false; }
            }
        });
        const fb = document.getElementById('bs-feedback');
        fb.innerText = allCorrect ? "Excellent Classification!" : "Re-evaluate financing vs operations (Debt, Lease Obligations, and Cash are non-operating).";
        fb.className = allCorrect ? "text-success mt-2 font-bold" : "text-error mt-2 font-bold";
    }

    function updateSim() {
        const flev = parseFloat(document.getElementById('flev-slider').value);
        document.getElementById('flev-val').innerText = flev.toFixed(2);
        const rnoa = 32.1, spread = 32.2;
        const impact = flev * spread;
        const roe = rnoa + impact;
        document.getElementById('sim-boost-text').innerText = impact.toFixed(1) + "%";
        document.getElementById('sim-roe-text').innerText = roe.toFixed(1) + "%";
        
        const scale = 3.5;
        document.getElementById('sim-boost-bar').style.height = (impact * scale) + "px";
        document.getElementById('sim-roe-bar').style.height = (roe * scale) + "px";
    }

    function revealSummary() {
        const bullets = document.querySelectorAll('.bullet-point');
        bullets.forEach((b, i) => {
            b.classList.remove('bullet-visible');
            setTimeout(() => b.classList.add('bullet-visible'), i * 350);
        });
    }

    function checkInterQuiz(btn, isCorrect) {
        const fb = btn.parentElement.querySelector('.inter-quiz-fb');
        btn.parentElement.querySelectorAll('.btn').forEach(b => {
            b.style.pointerEvents = 'none';
            if(b.onclick.toString().includes('true')) {
                b.style.background = "#d1fae5"; b.style.color = "#065f46"; b.style.borderColor = "#10b981";
            } else if(b === btn) {
                b.style.background = "#ffe4e6"; b.style.color = "#9f1239"; b.style.borderColor = "#f43f5e";
            }
        });

        if (isCorrect) {
            fb.innerText = "Correct! Well done.";
            fb.className = "inter-quiz-fb text-success mt-2 font-bold";
        } else {
            fb.innerText = "Incorrect. Review the answer above.";
            fb.className = "inter-quiz-fb text-error mt-2 font-bold";
        }
    }

    function quizCheck(btn, isCorrect) {
        const fb = btn.parentElement.nextElementSibling;
        btn.parentElement.querySelectorAll('button').forEach(b => b.disabled = true);
        if (isCorrect) {
            btn.style.background = "var(--success)"; btn.style.color = "white";
            fb.innerText = "Correct!"; fb.className = "text-success mt-4 font-bold";
        } else {
            btn.style.background = "var(--error)"; btn.style.color = "white";
            fb.innerText = "Incorrect."; fb.className = "text-error mt-4 font-bold";
        }
    }

    function checkQ4() {
        const val = document.getElementById('q4-input').value;
        const fb = document.getElementById('q4-fb');
        if (val == 300) {
            fb.innerText = "Correct! (500 Assets - 200 Liabilities). Excess cash is excluded from NOA.";
            fb.className = "text-success mt-4 font-bold";
        } else {
            fb.innerText = "Try again. NOA = Op Assets - Op Liab (Ignore Cash).";
            fb.className = "text-error mt-4 font-bold";
        }
    }

    function generateTOC() {
        const container = document.getElementById('toc-grid');
        // Clear previous toc
        container.innerHTML = '';
        slides.forEach((slide, i) => {
            const h2 = slide.querySelector('h2') || slide.querySelector('h1');
            if (h2) {
                const item = document.createElement('div');
                item.className = "toc-btn"; item.onclick = () => jumpToSlide(i);
                item.innerHTML = `<div class="toc-num">${i + 1}</div><span>${h2.innerText}</span>`;
                container.appendChild(item);
            }
        });
    }

    // New Interactive Logic
    function revealQuadrant(el) {
        el.classList.add('active');
        el.querySelector('.q-content').classList.add('revealed');
    }

    function revealNum(el, val) {
        el.innerText = val;
        el.classList.add('revealed');
    }

    // NOPAT Viz Logic (Updated)
    function updateTaxViz(mode) {
        const opBar = document.getElementById('bar-op');
        const taxableBar = document.getElementById('bar-taxable');
        const overlayOp = document.getElementById('overlay-op');
        const overlayTaxable = document.getElementById('overlay-taxable');
        
        const valTaxable = document.getElementById('val-taxable');
        
        const insight = document.getElementById('viz-insight');
        const btnDebt = document.getElementById('btn-debt');
        const btnCash = document.getElementById('btn-cash');
        const shieldBadge = document.getElementById('shield-badge');

        if (mode === 'debt') {
            // Debt Scenario (Interest Expense)
            // Op Inc = 100, Tax on Op = 20
            // Taxable Inc = 80, Reported Tax = 16
            
            // Bar heights (scale factor approx 2.5)
            opBar.style.height = '250px'; 
            taxableBar.style.height = '200px'; 
            
            overlayOp.innerHTML = "Tax Owed on Op Inc ($20)";
            overlayOp.style.height = '50px'; 
            
            valTaxable.innerHTML = "Taxable Inc $80";
            overlayTaxable.innerHTML = "Reported Tax ($16)";
            overlayTaxable.style.height = '40px';

            shieldBadge.innerHTML = "Tax Shield: +$4";
            shieldBadge.style.background = "var(--success)";

            btnDebt.style.background = 'var(--primary)'; btnDebt.style.color='white';
            btnCash.style.background = 'transparent'; btnCash.style.color='var(--primary)';

            insight.innerHTML = "<strong>Insight:</strong> Because of interest expense, your Taxable Income ($80) is lower than Operating Income ($100). Thus, you paid <strong>less tax</strong> ($16) than the tax owed on operating income ($20). <br><br>The difference ($4) is the <strong>Tax Shield</strong> provided by debt.";
            insight.style.borderLeftColor = "var(--success)";
        } else {
            // Cash Scenario (Interest Income)
            // Op Inc = 100, Tax on Op = 20
            // Taxable Inc = 120, Reported Tax = 24
            
            opBar.style.height = '250px'; 
            taxableBar.style.height = '300px'; // 120 * 2.5
            
            overlayOp.innerHTML = "Tax Owed on Op Inc ($20)";
            overlayOp.style.height = '50px';
            
            valTaxable.innerHTML = "Taxable Inc $120";
            overlayTaxable.innerHTML = "Reported Tax ($24)";
            overlayTaxable.style.height = '60px'; // 24 * 2.5

            shieldBadge.innerHTML = "Tax Shield: -$4";
            shieldBadge.style.background = "var(--error)";

            btnDebt.style.background = 'transparent'; btnDebt.style.color='var(--primary)';
            btnCash.style.background = 'var(--primary)'; btnCash.style.color='white';

            insight.innerHTML = "<strong>Insight:</strong> Because of interest income, your Taxable Income ($120) is higher than Operating Income ($100). You paid <strong>more tax</strong> ($24) than the tax owed on operating income ($20). <br><br>The difference (-$4) is the tax drag from holding excess cash.";
            insight.style.borderLeftColor = "var(--error)";
        }
    }

    window.onload = () => { generateTOC(); updateNav(); updateSim(); updateTaxViz('debt'); };
</script>
</body>
</html>
