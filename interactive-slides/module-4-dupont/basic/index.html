<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond the Bottom Line: DuPont Analysis Masterclass</title>
    <!-- Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Vibrant Theme */
            --primary: #4f46e5;       /* Indigo 600 */
            --primary-dark: #3730a3;  /* Indigo 800 */
            --accent: #f43f5e;        /* Rose 500 */
            --accent-hover: #e11d48;  /* Rose 600 */
            --success: #10b981;       /* Emerald 500 */
            --warning: #f59e0b;       /* Amber 500 */
            --bg-color: #f3f4f6;      /* Gray 100 */
            --card-bg: #ffffff;
            --text-main: #1f2937;     /* Gray 800 */
            --text-light: #6b7280;    /* Gray 500 */
            --accent-blue: #4f46e5;   
            
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --header-font: 'Outfit', sans-serif;
            --body-font: 'Outfit', sans-serif;
            --mono-font: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--body-font);
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            /* Base font size increase */
            font-size: 18px; 
        }

        /* --- Layout --- */
        #app-container {
            width: 100%;
            max-width: 1400px;
            height: 95vh;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: relative;
            box-shadow: var(--shadow-lg);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .slide {
            display: none;
            flex: 1;
            padding: 2rem 4rem;
            /* Critical for scrolling to work when content expands */
            overflow-y: auto; 
            flex-direction: column;
            animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            box-sizing: border-box; 
            scrollbar-gutter: stable;
        }

        /* Custom Scrollbar Styling */
        .slide::-webkit-scrollbar {
            width: 10px;
        }
        .slide::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 5px;
        }
        .slide::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        .slide::-webkit-scrollbar-thumb:hover {
            background-color: rgba(0,0,0,0.4);
        }

        .slide.active { display: flex; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- Typography (UPDATED SIZES) --- */
        h1, h2, h3 { font-family: var(--header-font); color: var(--text-main); margin-bottom: 1rem; font-weight: 800; }
        h1 { font-size: 4.5rem; letter-spacing: -2px; background: -webkit-linear-gradient(0deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 3rem; position: relative; display: inline-block; margin-bottom: 1.5rem; }
        h2::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 60px; height: 5px; background: var(--accent); border-radius: 2px; }
        h3 { font-size: 2rem; }
        
        p, li { font-size: 1.35rem; line-height: 1.6; color: #4b5563; margin-bottom: 1.2rem; font-weight: 400; }
        
        .text-accent { color: var(--primary); font-weight: 700; }
        .text-accent-blue { color: var(--primary); font-weight: 700; } 
        .text-rose { color: var(--accent); font-weight: 700; }
        .text-success { color: var(--success); font-weight: 700; }
        .text-white { color: white !important; }
        .text-center { text-align: center; }
        .flex-center { display: flex; justify-content: center; align-items: center; height: 100%; }
        
        /* --- Math Formatting (UPDATED SIZES) --- */
        .formula-box { 
            font-size: 1.8rem; 
            margin: 30px 0; 
            text-align: center; 
            font-family: var(--header-font); 
            font-weight: 600;
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid #e5e7eb;
        }
        .fraction { display: inline-block; text-align: center; vertical-align: middle; margin: 0 10px; }
        .fraction > span { display: block; padding: 5px 10px; }
        .fraction span.numerator { border-bottom: 2px solid var(--text-main); }
        .fraction span.denominator { padding-top: 5px; }

        .step-hidden { display: none; opacity: 0; }
        .step-visible { display: block; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- Components --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; align-items: start; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }

        .card {
            background: var(--card-bg);
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid #f3f4f6;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: auto;
            overflow: visible; 
            position: relative;
        }
        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        
        /* Decorative gradients for cards */
        .card-highlight::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 8px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-top-left-radius: 16px; border-top-right-radius: 16px;
        }
        .card-data::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 8px;
            background: linear-gradient(90deg, var(--warning), #fcd34d);
            border-top-left-radius: 16px; border-top-right-radius: 16px;
        }

        .btn-action {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
        }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(79, 70, 229, 0.4); }
        .btn-action.secondary { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%); box-shadow: 0 4px 6px rgba(244, 63, 94, 0.3); }

        /* --- Images --- */
        .img-hero {
            width: 100%; height: 350px; object-fit: cover; border-radius: 16px; margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        .icon-large {
            font-size: 3.5rem;
            background: -webkit-linear-gradient(var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.2rem;
        }

        /* --- Flip Cards (Legacy support) --- */
        .flip-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; perspective: 1000px; }
        .flip-card { background-color: transparent; height: 280px; perspective: 1000px; cursor: pointer; }
        .flip-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); transform-style: preserve-3d; box-shadow: var(--shadow); border-radius: 16px; }
        .flip-card.flipped .flip-inner { transform: rotateY(180deg); }
        .flip-front, .flip-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2.5rem; border-radius: 16px; }
        .flip-front { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .flip-back { background: white; color: var(--text-main); transform: rotateY(180deg); border: 2px solid var(--primary); }
        .flip-front h3, .flip-back h3 { color: inherit; }

        /* --- New Interactive Quiz Section --- */
        .iq-container { display: flex; flex-direction: column; gap: 1.8rem; }
        .iq-card { background: white; border-radius: 12px; padding: 2rem; border: 1px solid #e5e7eb; box-shadow: var(--shadow); cursor: pointer; transition: all 0.2s;}
        .iq-card:hover { transform: translateY(-2px); border-color: var(--primary); }
        .iq-question { font-weight: 700; font-size: 1.4rem; margin-bottom: 1.2rem; color: var(--primary-dark); }
        .iq-options { display: flex; gap: 15px; flex-wrap: wrap; }
        .iq-btn { background: #f3f4f6; border: 1px solid #d1d5db; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1.1rem; transition: all 0.2s; }
        .iq-btn:hover { background: #e5e7eb; }
        .iq-btn.selected-correct { background: #d1fae5; border-color: #10b981; color: #065f46; }
        .iq-btn.selected-wrong { background: #ffe4e6; border-color: #f43f5e; color: #9f1239; }
        .iq-feedback { margin-top: 1.2rem; padding: 12px; border-radius: 6px; font-size: 1.1rem; display: none; }
        .iq-feedback.visible { display: block; animation: slideIn 0.3s; }
        
        /* --- DuPont Map --- */
        .map-container { display: flex; flex-direction: column; align-items: center; gap: 20px; zoom: 1; }
        .map-level { display: flex; gap: 40px; justify-content: center; }
        .map-node {
            background: white; border: 2px solid var(--primary); border-radius: 12px; padding: 20px;
            text-align: center; width: 250px; position: relative; box-shadow: var(--shadow);
            transition: all 0.3s;
        }
        .map-node:hover { transform: scale(1.05); background: #fdf2f8; }
        .map-node strong { font-size: 1.3rem; }
        .map-node small { display: block; color: var(--text-light); font-family: var(--mono-font); font-size: 0.95rem; margin-top: 8px; }
        .map-connector-v { width: 3px; height: 25px; background: var(--text-light); margin: 0 auto; }
        .map-connector-h { height: 3px; background: var(--text-light); width: 100%; margin: 0 auto; }

        /* --- Lever Animation --- */
        .lever-container { position: relative; height: 200px; margin-top: 30px; width:100%; }
        .lever-beam { width: 80%; height: 12px; background: #374151; position: absolute; top: 100px; left: 10%; transform-origin: 30% 50%; transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 6px; }
        .lever-fulcrum { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 50px solid var(--accent); position: absolute; top: 110px; left: 30%; transform: translateX(-50%); filter: drop-shadow(0 4px 3px rgba(0,0,0,0.1)); }
        .lever-weight { width: 80px; height: 80px; background: var(--accent); position: absolute; bottom: 12px; right: 0; display:flex; align-items:center; justify-content:center; color:white; font-weight:800; border-radius:8px; box-shadow: var(--shadow); font-size: 1.2rem; }
        .lever-effort { width: 90px; height: 90px; background: var(--success); position: absolute; bottom: 12px; left: -10px; display:flex; align-items:center; justify-content:center; color:white; font-weight:800; border-radius:50%; box-shadow: var(--shadow-lg); z-index: 2; font-size: 1.2rem;}

        /* --- Buyback Simulator --- */
        .sim-container { background: white; padding: 40px; border-radius: 16px; box-shadow: var(--shadow); margin-top: 20px; }
        .bar-chart-area { height: 220px; display: flex; align-items: flex-end; justify-content: center; gap: 80px; border-bottom: 2px solid #e5e7eb; padding-bottom: 5px; }
        .bar { width: 100px; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: flex-end; justify-content: center; color: white; padding-bottom: 10px; border-radius: 8px 8px 0 0; font-weight:bold; font-size: 1.3rem; }
        input[type=range] { width: 100%; margin: 25px 0; accent-color: var(--accent); height: 8px; cursor: pointer; }

        /* --- CCC Visualizer --- */
        .ccc-wrapper { 
            margin-top: 40px; 
            position: relative; 
            height: 280px; /* Increased height to accommodate overlap fix */
            overflow: visible;
        }
        
        /* Track background */
        .ccc-track {
            position: absolute;
            top: 100px;
            left: 0;
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
        }

        .ccc-bar {
            height: 50px; position: absolute; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; border-radius: 6px; transition: all 1.5s ease-in-out;
            top: 15px; font-size: 1rem; white-space: nowrap; overflow: hidden; width: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ccc-tick { position: absolute; top: 90px; width: 3px; height: 28px; background: #9ca3af; z-index: 5; }
        .ccc-label { 
            position: absolute; top: 125px; font-size: 1.1rem; transform: translateX(-50%); 
            font-weight: 700; color: var(--text-main); 
        }
        
        .ccc-bracket {
            position: absolute; top: 220px; /* Moved down to avoid overlap */
            height: 20px; border: 3px solid var(--text-main);
            border-top: none; transition: all 1.5s ease-in-out; opacity: 0;
        }
        .ccc-bracket-text {
            position: absolute; bottom: -35px; width: 100%; text-align: center;
            font-weight: bold; color: var(--accent); white-space: nowrap; font-size: 1.2rem;
        }

        /* --- Confetti --- */
        .confetti {
            position: fixed; width: 12px; height: 12px;
            background-color: #f00; animation: fall linear forwards; z-index: 9999;
            pointer-events: none;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* --- Navigation --- */
        #nav-bar {
            background: white; border-top: 1px solid #e5e7eb; padding: 1.2rem 2.5rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .progress-bar-container { flex: 1; height: 10px; background: #e5e7eb; margin: 0 25px; border-radius: 5px; overflow:hidden;}
        #progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; border-radius: 5px; transition: width 0.3s; }

        /* Table of Contents Modal */
        #toc-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 1000;
            justify-content: center; align-items: center;
        }
        .toc-content {
            background: white; width: 80%; max-width: 900px; max-height: 80vh; overflow-y: auto;
            border-radius: 16px; padding: 2.5rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;
        }
        .toc-item {
            padding: 18px; border: 1px solid #eee; border-radius: 8px; cursor: pointer; transition: all 0.2s;
            font-weight: 600; color: var(--text-main); font-size: 1.2rem;
        }
        .toc-item:hover { background: var(--bg-color); border-color: var(--primary); color: var(--primary); }
        .toc-item.active { background: var(--primary); color: white; border-color: var(--primary); }

    </style>
</head>
<body>

<div id="app-container">

    <!-- SLIDE 1: INTRO -->
    <div class="slide active" data-title="Introduction">
        <div class="flex-center" style="flex-direction: column; text-align: center;">
            <img src="https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80&w=1000" class="img-hero" alt="Skyscrapers">
            <h1>Beyond the Bottom Line</h1>
            <h3 style="color: var(--text-light); font-weight: 400; font-size: 2rem;">A Masterclass in DuPont Analysis</h3>
            <p class="mt-4">Deconstruct Shareholder Value | Analyze Pfizer & Apple | Master ROE</p>
            <button class="btn-action secondary mt-4" onclick="nextSlide()">Start Analysis <i class="fas fa-arrow-right ml-2"></i></button>
        </div>
    </div>

    <!-- SLIDE 2: HOOK -->
    <div class="slide" data-title="The Investor's Dilemma">
        <h2>The Investor's Dilemma</h2>
        <div class="grid-2">
            <div>
                <p>Two CEOs present their results. Both companies made <strong>$10 Million</strong> in profit this year.</p>
                <div class="card card-highlight mt-4">
                    <i class="fas fa-building icon-large"></i>
                    <h4>Company A</h4>
                    <p>Shareholders invested: $100 Million</p>
                    <p class="text-accent">Return: 10%</p>
                </div>
                <div class="card card-highlight mt-4">
                    <i class="fas fa-rocket icon-large"></i>
                    <h4>Company B</h4>
                    <p>Shareholders invested: $20 Million</p>
                    <p class="text-success">Return: 50%</p>
                </div>
            </div>
            <div class="flex-center" style="flex-direction:column;">
                <h3 class="mt-4">Which CEO did a better job?</h3>
                <p>Company B generated the same profit with far less capital. This is why <strong>ROE</strong> is the "Gold Standard" metric.</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 3: ROE INTRO -->
    <div class="slide" data-title="ROE Formula">
        <h2>The Headline Metric: ROE</h2>
        <div class="grid-2">
            <div>
                <p><strong>Return on Equity (ROE)</strong> is the definitive measure of performance from a stockholder's perspective.</p>
                <div class="card card-highlight text-center">
                    <div class="formula-box">
                        ROE = 
                        <div class="fraction">
                            <span class="numerator">Net Income</span>
                            <span class="denominator text-accent">Average Equity</span>
                        </div>
                    </div>
                </div>
                <p class="mt-4">It tells us: For every dollar invested by owners, how much profit did the company generate?</p>
                <small class="text-rose" style="font-size: 1.1rem;"><i class="fas fa-exclamation-circle"></i> Note: We use "Average" Equity (Beginning + Ending / 2) because Net Income happens <em>over</em> a year, while Equity is a snapshot.</small>
            </div>
            <div class="card">
                <h3 class="text-center">ROE Calculator</h3>
                <div style="display:flex; flex-direction:column; gap:15px;">
                    <label style="font-size:1.2rem;">Net Income ($M)</label>
                    <input type="number" id="roe-ni" placeholder="e.g. 31372" style="padding:15px; border:1px solid #ddd; border-radius:8px; font-size:1.1rem;">
                    <label style="font-size:1.2rem;">Average Equity ($M)</label>
                    <input type="number" id="roe-eq" placeholder="e.g. 86431" style="padding:15px; border:1px solid #ddd; border-radius:8px; font-size:1.1rem;">
                    <button class="btn-action" onclick="calcROE()">Calculate</button>
                    <div id="roe-result" style="text-align:center; font-size:2.5rem; font-weight:bold; color:var(--primary); margin-top:15px;">--%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 4: COMPLETE MAP -->
    <div class="slide" data-title="DuPont Map">
        <h2>The DuPont Diagnostic Map</h2>
        <p>Before we dive deep, visualize the hierarchy. Everything flows into ROE.</p>
        
        <div class="map-container">
            <!-- Level 1 -->
            <div class="map-node" style="background: var(--primary-dark); color: white; border:none;">
                <strong>ROE</strong>
                <small>NI / Avg Equity</small>
            </div>
            <div class="map-connector-v"></div>
            
            <!-- NCIR Split (3 ways) -->
            <div style="width: 70%; border-top: 3px solid var(--text-light); display: flex; justify-content: space-between;">
                <div style="width: 3px; height: 25px; background: var(--text-light);"></div>
                <div style="width: 3px; height: 25px; background: var(--text-light);"></div>
                <div style="width: 3px; height: 25px; background: var(--text-light);"></div>
            </div>
            
            <!-- Level 2 -->
            <div class="map-level" style="gap: 50px;">
                <div class="map-node">
                    <strong>Return on Assets (ROA)</strong>
                    <small>NI / Avg Assets</small>
                </div>
                <div class="map-node">
                    <strong>Financial Leverage</strong>
                    <small>Avg Assets / Avg Equity</small>
                </div>
                <div class="map-node" style="background: #fdf2f8; border-color: var(--accent);">
                    <strong>NCIR</strong>
                    <small>Refinement</small>
                </div>
            </div>
            
            <!-- Split under ROA -->
            <div style="width: 25%; border-top: 3px solid var(--text-light); display: flex; justify-content: space-between; margin-right: 640px;">
                <div style="width: 3px; height: 25px; background: var(--text-light);"></div>
                <div style="width: 3px; height: 25px; background: var(--text-light);"></div>
            </div>
            
            <!-- Level 3 -->
            <div class="map-level" style="justify-content: flex-start; margin-right: 590px;">
                <div class="map-node" style="background: #eef2ff;">
                    <strong>Profit Margin</strong>
                    <small>NI / Sales</small>
                </div>
                <div class="map-node" style="background: #eef2ff;">
                    <strong>Asset Turnover</strong>
                    <small>Sales / Avg Assets</small>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 5: LEVEL 1 BREAKDOWN (UPDATED) -->
    <div class="slide" data-title="Ops vs Finance">
        <h2>Level 1: Operations vs. Finance</h2>
        <p>Let's deconstruct ROE into its two primary engines: Operational efficiency and Financial structure.</p>

        <div class="card card-highlight text-center" style="font-size: 1.2rem; padding: 2rem;">
            <!-- Step 0 -->
            <div id="roe-step-0">
                <div class="formula-box">
                    ROE = <div class="fraction"><span class="numerator">Net Income</span><span class="denominator">Avg Equity</span></div>
                </div>
                <button class="btn-action" onclick="showStep('roe-step-1', this)">Step 1: Expand</button>
            </div>

            <!-- Step 1 -->
            <div id="roe-step-1" class="step-hidden mt-4">
                <p>Multiply by (Avg Assets / Avg Assets), which equals 1. This introduces the concept of assets into the equation.</p>
                <div class="formula-box">
                    <div class="fraction"><span class="numerator">Net Income</span><span class="denominator">Avg Equity</span></div>
                    &times; 
                    <div class="fraction"><span class="numerator text-accent">Avg Assets</span><span class="denominator text-accent">Avg Assets</span></div>
                </div>
                <button class="btn-action" onclick="showStep('roe-step-2', this)">Step 2: Rearrange</button>
            </div>

            <!-- Step 2 -->
            <div id="roe-step-2" class="step-hidden mt-4">
                <p>Rearrange the denominators to group operational performance separate from financing decisions.</p>
                <div class="formula-box">
                    <div class="fraction"><span class="numerator">Net Income</span><span class="denominator text-accent">Avg Assets</span></div>
                    &times; 
                    <div class="fraction"><span class="numerator text-accent">Avg Assets</span><span class="denominator">Avg Equity</span></div>
                </div>
                <button class="btn-action" onclick="showStep('roe-step-3', this)">Step 3: Define</button>
            </div>

            <!-- Step 3 -->
            <div id="roe-step-3" class="step-hidden mt-4">
                <div class="formula-box" style="font-weight: bold; color: var(--accent-blue);">
                    = ROA &times; Financial Leverage (Equity Multiplier)
                </div>
                <p class="mt-4">Now we can see if ROE is driven by how well the machine runs (ROA) or how the machine was paid for (Leverage).</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 6: NCIR -->
    <div class="slide" data-title="NCIR">
        <h2>The Missing Piece: NCIR</h2>
        <p>For companies that own less than 100% of their subsidiaries, we need a refinement.</p>
        
        <div class="grid-2">
            <div class="card card-highlight">
                <h3>Noncontrolling Interest Ratio</h3>
                <p>Measures the proportion of income/equity attributable specifically to the parent company's stockholders.</p>
                <div class="formula-box" style="font-size:1.1rem; border:none; box-shadow:none;">
                    <div class="fraction">
                        <span class="numerator">NI<sub>Controlling</sub> / Total NI</span>
                        <span class="denominator">Avg Eq<sub>Controlling</sub> / Avg Total Eq</span>
                    </div>
                </div>
            </div>
            
            <div class="card card-data">
                <h3>Pfizer Example (2022)</h3>
                <p><strong>Income %:</strong> $31,372 / $31,407 = 0.998</p>
                <p><strong>Equity %:</strong> $86,431 / $86,689 = 0.997</p>
                <hr style="margin: 15px 0;">
                <p class="text-accent" style="font-weight:bold; font-size:1.4rem;">NCIR = 0.998 / 0.997 = 1.00188</p>
                <div class="mt-4 p-3 bg-white rounded border border-gray-200">
                    <small style="font-size: 1.1rem;"><strong>The Shortcut:</strong> We often approximate ROE &approx; ROA &times; Leverage because NCIR is usually very close to 1.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 7: PFIZER CASE STUDY -->
    <div class="slide" data-title="Pfizer Case">
        <h2>Case Study: Pfizer (2022)</h2>
        <div class="grid-2">
            <div class="card" style="background: #fff1f2;">
                <div style="display:flex; align-items:center; gap:15px;">
                     <i class="fas fa-flask icon-large"></i>
                     <h3>Pfizer Data</h3>
                </div>
                <ul style="list-style:none; padding:0;">
                    <li style="border-bottom:1px solid #ddd; padding:15px 0;"><strong>Net Income:</strong> $31,372 M</li>
                    <li style="border-bottom:1px solid #ddd; padding:15px 0;"><strong>Avg Assets:</strong> $189,341 M</li>
                    <li style="border-bottom:1px solid #ddd; padding:15px 0;"><strong>Avg Equity:</strong> $86,431 M</li>
                </ul>
                <div class="mt-4 p-3 bg-white rounded shadow-sm text-center">
                    <p style="margin:0; font-size:1.5rem;"><strong>ROE:</strong> 36.3%</p>
                </div>
            </div>
            <div>
                <h3>Deconstruction</h3>
                <div class="card">
                    <p><strong>Step 1: Calculate ROA</strong> <span class="fraction" style="font-size:0.8em; vertical-align:middle;"><span class="numerator">NI</span><span class="denominator">Avg Assets</span></span></p>
                    <p class="text-accent" style="font-size:1.5rem;">31,372 / 189,341 = <strong>16.6%</strong></p>
                    <hr style="border-top:1px dashed #ccc; margin:20px 0;">
                    <p><strong>Step 2: Calculate Multiplier</strong> <span class="fraction" style="font-size:0.8em; vertical-align:middle;"><span class="numerator">Avg Assets</span><span class="denominator">Avg Equity</span></span></p>
                    <p class="text-accent" style="font-size:1.5rem;">189,341 / 86,431 = <strong>2.19</strong></p>
                    <hr style="border-top:1px dashed #ccc; margin:20px 0;">
                    <p><strong>Check:</strong> 16.6% * 2.19 = 36.3%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 8: PFIZER CONTEXT -->
    <div class="slide" data-title="Context">
        <h2>Is Pfizer's Performance Good?</h2>
        <p>Numbers need context. Compare Pfizer to the S&P 500 Benchmarks.</p>
        
        <div class="grid-2">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front">
                        <h3 class="text-white">ROA Comparison</h3>
                        <div class="mt-2" style="background:rgba(255,255,255,0.2); padding:15px; border-radius:8px; width:80%;">
                            <p class="text-white" style="font-size:1.3rem; margin-bottom:5px;">S&P 500 Avg: <strong>6.1%</strong></p>
                            <p class="text-white" style="font-size:1.3rem;">Pfizer: <strong>16.6%</strong></p>
                        </div>
                        <p class="text-white mt-4"><i class="fas fa-hand-pointer"></i> Reveal Verdict</p>
                    </div>
                    <div class="flip-back">
                        <i class="fas fa-medal icon-large text-success"></i>
                        <h3>Exceptionally Strong</h3>
                        <p>Pfizer far exceeds the S&P 500 median of 6.1%. This indicates superior operational efficiency.</p>
                    </div>
                </div>
            </div>
            
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-inner">
                    <div class="flip-front" style="background: linear-gradient(135deg, var(--accent), var(--accent-hover));">
                        <h3 class="text-white">Leverage Comparison</h3>
                        <div class="mt-2" style="background:rgba(255,255,255,0.2); padding:15px; border-radius:8px; width:80%;">
                            <p class="text-white" style="font-size:1.3rem; margin-bottom:5px;">S&P 500 Avg: <strong>2.51</strong></p>
                            <p class="text-white" style="font-size:1.3rem;">Pfizer: <strong>2.19</strong></p>
                        </div>
                        <p class="text-white mt-4"><i class="fas fa-hand-pointer"></i> Reveal Verdict</p>
                    </div>
                    <div class="flip-back">
                        <i class="fas fa-shield-alt icon-large text-primary"></i>
                        <h3>Conservative</h3>
                        <p>Pfizer uses less debt than the average S&P 500 company. Their high ROE is NOT driven by risky financial engineering.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 9: DEEP DIVE ROA -->
    <div class="slide" data-title="ROA Deconstruction">
        <h2>Level 2: Inside the Engine (ROA)</h2>
        <p>A high ROA comes from two places: Profitability or Speed. Let's derive it.</p>
        <div class="card card-highlight text-center" style="font-size: 1.2rem; padding: 2rem;">
            <!-- Step 0 -->
            <div id="roa-step-0">
                <div class="formula-box">
                    ROA = <div class="fraction"><span class="numerator">Net Income</span><span class="denominator">Avg Assets</span></div>
                </div>
                <button class="btn-action" onclick="showStep('roa-step-1', this)">Step 1: Expand</button>
            </div>

            <!-- Step 1 -->
            <div id="roa-step-1" class="step-hidden mt-4">
                <p>Multiply by (Sales / Sales), which equals 1:</p>
                <div class="formula-box">
                    <div class="fraction"><span class="numerator">Net Income</span><span class="denominator">Avg Assets</span></div>
                    &times; 
                    <div class="fraction"><span class="numerator text-accent">Sales</span><span class="denominator text-accent">Sales</span></div>
                </div>
                <button class="btn-action" onclick="showStep('roa-step-2', this)">Step 2: Rearrange</button>
            </div>

            <!-- Step 2 -->
            <div id="roa-step-2" class="step-hidden mt-4">
                <p>Rearrange the denominators:</p>
                <div class="formula-box">
                    <div class="fraction"><span class="numerator">Net Income</span><span class="denominator text-accent">Sales</span></div>
                    &times; 
                    <div class="fraction"><span class="numerator text-accent">Sales</span><span class="denominator">Avg Assets</span></div>
                </div>
                <button class="btn-action" onclick="showStep('roa-step-3', this)">Step 3: Define</button>
            </div>

            <!-- Step 3 -->
            <div id="roa-step-3" class="step-hidden mt-4">
                <div class="formula-box" style="font-weight: bold; color: var(--accent-blue);">
                    = Profit Margin &times; Asset Turnover
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 10: MARGINS (UPDATED SPACING) -->
    <div class="slide" data-title="Profit Margins">
        <h2>Driver 1: Profitability (Margins)</h2>
        <div class="grid-2">
            <div class="card">
                <h3>Gross Profit Margin</h3>
                <div class="formula-box" style="font-size: 1.3rem; border:none; box-shadow:none;">
                    <div class="fraction"><span class="numerator">Sales - COGS</span><span class="denominator">Sales</span></div>
                </div>
                <p>Indicates pricing power and production efficiency.</p>
            </div>
            <div class="card">
                <h3>Operating Expense Margin</h3>
                <div class="formula-box" style="font-size: 1.3rem; border:none; box-shadow:none;">
                    <div class="fraction"><span class="numerator">SG&A</span><span class="denominator">Sales</span></div>
                </div>
                <p>Measures overhead efficiency. Lower is usually better.</p>
            </div>
        </div>
        <!-- UPDATED: Increased margin-top -->
        <div class="mt-4 text-center" style="margin-top: 5rem !important;">
            <div class="flip-card" onclick="this.classList.toggle('flipped')" style="height: 180px; width: 600px; margin: 0 auto;">
                <div class="flip-inner">
                    <div class="flip-front" style="background:var(--accent);">
                        <h3 class="text-white">Check-in: Why would Gross Margin fall?</h3>
                        <small class="text-white" style="font-size: 1rem;">(Click for Answer)</small>
                    </div>
                    <div class="flip-back">
                        <h3 class="text-rose">Competition or Cost</h3>
                        <p>It signals you are losing pricing power or input costs are rising faster than prices.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 11: ASSET TURNOVER (UPDATED) -->
    <div class="slide" data-title="Asset Turnover">
        <h2>Driver 2: Productivity (Turnover)</h2>
        <p>How efficiently are assets used to generate sales?</p>
        <div class="card card-highlight text-center" style="height: auto; padding: 2rem; margin-bottom: 2rem;">
            <div class="formula-box" style="margin:0;">
                Asset Turnover = <div class="fraction"><span class="numerator">Sales</span><span class="denominator">Avg Assets</span></div>
            </div>
        </div>
        
        <div class="flip-card mt-2" onclick="this.classList.toggle('flipped')" style="height: 500px;">
            <div class="flip-inner">
                <div class="flip-front" style="background: var(--primary);">
                    <h3 class="text-white">Guess the Turnover</h3>
                    <p class="text-white"><strong>Company A:</strong> High Revenue / Few Assets (e.g. Software)</p>
                    <p class="text-white"><strong>Company B:</strong> Capital Intensive (e.g. Utilities)</p>
                    <p class="mt-4 text-white" style="font-size: 1.4rem;"><em>Which has High Turnover?</em></p>
                </div>
                <div class="flip-back">
                    <h3>Company A (Software)</h3>
                    <p>Software companies can scale revenue massively without adding heavy assets like factories.</p>
                    <p>Utilities must build expensive power plants to sell electricity, resulting in low turnover.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 12: CASH CONVERSION CYCLE -->
    <div class="slide" data-title="Cash Conversion Cycle">
        <h2>The Pulse of Operations: Cash Conversion Cycle</h2>
        <p>The CCC measures how fast a company converts inventory into cash. Lower is better.</p>
        
        <div class="card" style="background:#f8fafc;">
            <h3>Formula Builder</h3>
            <p>Select the correct sign for each component to build the CCC formula.</p>
            <div id="ccc-equation" style="font-family: var(--mono-font); font-size:2rem; min-height:60px; border-bottom:3px solid var(--text-main); margin-bottom:20px; display:flex; align-items:center; gap:10px; color: var(--primary);"></div>
            
            <div class="grid-3">
                <div class="text-center">
                    <p><strong>DIO</strong><br>(Days Inventory)</p>
                    <button class="btn-action" style="padding:8px 20px; font-size:1rem;" onclick="addToCCC('+ DIO')">(+) Add</button>
                    <button class="btn-action secondary" style="padding:8px 20px; font-size:1rem;" onclick="addToCCC('- DIO')">(-) Subtract</button>
                </div>
                <div class="text-center">
                    <p><strong>DSO</strong><br>(Days Sales)</p>
                    <button class="btn-action" style="padding:8px 20px; font-size:1rem;" onclick="addToCCC('+ DSO')">(+) Add</button>
                    <button class="btn-action secondary" style="padding:8px 20px; font-size:1rem;" onclick="addToCCC('- DSO')">(-) Subtract</button>
                </div>
                <div class="text-center">
                    <p><strong>DPO</strong><br>(Days Payables)</p>
                    <button class="btn-action" style="padding:8px 20px; font-size:1rem;" onclick="addToCCC('+ DPO')">(+) Add</button>
                    <button class="btn-action secondary" style="padding:8px 20px; font-size:1rem;" onclick="addToCCC('- DPO')">(-) Subtract</button>
                </div>
            </div>
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:30px;">
                <button style="background:none; border:none; text-decoration:underline; cursor:pointer; font-size: 1.2rem;" onclick="resetCCC()">Reset</button>
                <p id="ccc-feedback" style="font-size: 1.4rem;"></p>
            </div>
        </div>
    </div>

    <!-- SLIDE 13: APPLE CCC -->
    <div class="slide" data-title="Apple Simulation">
        <h2>Apple's CCC: The Negative Cycle</h2>
        <p class="text-center font-weight-bold" style="font-size:1.5rem;">CCC = DIO + DSO - DPO</p>
        <p>Apple has a <strong>Negative</strong> CCC (-63 days). Customers pay Apple before Apple pays suppliers.</p>
        
        <div class="card text-center" style="padding: 20px;">
            <h3>Interactive CCC Timeline</h3>
            <p>Click "Simulate Cycle" to see the timeline.</p>
            
            <div class="ccc-wrapper">
                <!-- Track Background for Visibility -->
                <div class="ccc-track"></div>
                
                <!-- Axis Elements -->
                <div class="ccc-tick" style="left:50%; top:90px;"></div> <!-- Zero Tick -->
                <div class="ccc-label" style="left:50%;">Day 0 (Sale)</div>
                <div class="ccc-label" style="left:90%;">+ (Cash In)</div>
                <div class="ccc-label" style="left:10%;">- (Cash Out)</div>
                
                <!-- Bars (Top half: Positive Components) -->
                <!-- Inventory (Blue) -->
                <div id="bar-dio" class="ccc-bar" style="width: 0px; background: #3498db; left: 50%; top: 20px; justify-content: flex-start; padding-left: 10px;"></div>
                <!-- Receivables (Green) -->
                <div id="bar-dso" class="ccc-bar" style="width: 0px; background: #2ecc71; left: 50%; top: 20px; justify-content: flex-start; padding-left: 10px;"></div>
                
                <!-- Bars (Bottom half: Negative Component) -->
                <!-- Payables (Red) -->
                <!-- IMPORTANT: Anchored at right (End of DSO), grows left -->
                <div id="bar-dpo" class="ccc-bar" style="width: 0px; background: #e74c3c; top: 150px; justify-content: flex-end; padding-right: 10px;"></div>
                
                <!-- CCC Bracket -->
                <div id="ccc-bracket" class="ccc-bracket">
                    <div class="ccc-bracket-text">CCC (-63d)</div>
                </div>
            </div>
            
            <button class="btn-action" style="display:inline-block; margin: 30px auto;" onclick="animateAppleCCC()">Simulate Cycle</button>
            <p id="apple-ccc-text" class="mt-4" style="font-weight:bold; font-size: 1.4rem;"></p>
        </div>

        <div class="card card-highlight mt-4">
            <p><strong>Strategic Advantage:</strong> Apple operates with <strong>Supplier Financing</strong>. Suppliers essentially lend Apple money interest-free for ~100 days.</p>
        </div>
    </div>

    <!-- SLIDE 14: LEVERAGE VISUALIZATION -->
    <div class="slide" data-title="Leverage Visual">
        <h2>Visualizing Financial Leverage</h2>
        <div class="grid-2">
            <div>
                <p>Think of financial leverage as using a literal lever to lift a heavy object.</p>
                <div class="card" style="margin-top:20px;">
                    <h3>The Mechanics</h3>
                    <p><strong>Longer Lever (More Debt):</strong> Allows you to lift heavier Assets with less Equity effort.</p>
                    <p class="text-rose"><strong>Risk:</strong> A longer lever is more unstable. If it snaps (default), the structure collapses.</p>
                </div>
            </div>
            <div class="card text-center" style="background: #f8fafc;">
                <h3>The Leverage Effect</h3>
                <div class="lever-container">
                    <div class="lever-fulcrum"></div>
                    <div class="lever-beam" id="lever-beam">
                        <div class="lever-effort">Equity</div>
                        <div class="lever-weight">Assets</div>
                    </div>
                </div>
                <button class="btn-action" onclick="animateLever()">Apply Leverage</button>
                <p class="mt-4 text-primary font-weight-bold" id="lever-text" style="display:none; opacity:0; transition:opacity 0.5s; font-size: 1.5rem;">Small Equity lifts Big Assets!</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 15: BUYBACK SIMULATOR -->
    <div class="slide" data-title="Buyback Simulator">
        <h2>Simulator: The Buyback Distortion</h2>
        <p>See what happens to ROE when a company buys back stock (reducing Average Equity) while Net Income stays flat.</p>
        
        <div class="sim-container">
            <div class="grid-2">
                <div>
                    <label style="font-weight:bold; color:var(--text-main); font-size: 1.4rem;">Stock Buyback Amount ($B)</label>
                    <input type="range" id="buyback-slider" min="0" max="80" value="0" oninput="updateSimulator()">
                    <div style="background:#f3f4f6; padding:20px; border-radius:8px; margin-top:15px;">
                        <p>Remaining Equity: <span id="sim-equity" class="text-primary" style="font-weight:bold;">100</span>B</p>
                        <p>Net Income: <strong>$50B (Constant)</strong></p>
                    </div>
                </div>
                <div class="bar-chart-area">
                    <div style="text-align:center">
                        <div class="bar" id="bar-equity" style="height: 100px; background:#9ca3af;"></div>
                        <small style="font-size: 1.1rem;">Avg Equity</small>
                    </div>
                    <div style="text-align:center">
                        <div class="bar" id="bar-roe" style="height: 50px; background:var(--accent);">50%</div>
                        <small style="font-size: 1.1rem;">ROE</small>
                    </div>
                </div>
            </div>
            <p class="text-center mt-4 text-rose"><strong>As Equity shrinks, ROE explodes mathematically!</strong></p>
        </div>
    </div>

    <!-- SLIDE 16: ADJUSTED ROA -->
    <div class="slide" data-title="Adjusted ROA">
        <h2>Adjustments: Isolate the Engine</h2>
        <p>Standard ROA uses Net Income (after interest). To measure pure asset efficiency, we must add interest back.</p>
        
        <div class="card card-highlight text-center">
            <div class="formula-box" style="font-size:1.8rem;">
                Adj. ROA = <div class="fraction"><span class="numerator">Net Income + [Interest &times; (1 - Tax Rate)]</span><span class="denominator">Avg Assets</span></div>
            </div>
        </div>
        
        <div class="grid-2 mt-4">
            <div class="card card-data">
                <h3>Pfizer Data</h3>
                <ul>
                    <li>Net Income: <strong>$31,372</strong></li>
                    <li>Interest Expense: <strong>$1,500</strong></li>
                    <li>Tax Rate: <strong>15%</strong> (0.15)</li>
                    <li>Avg Assets: <strong>$189,341</strong></li>
                </ul>
            </div>
            <div class="card">
                <h3>Comparison</h3>
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <span>Unadjusted ROA:</span>
                    <strong>16.6%</strong>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:15px;">
                    <span class="text-accent">Adjusted ROA:</span>
                    <span id="calc-res">--%</span>
                </div>
                <button class="btn-action" style="width:100%" onclick="revealAdjROA()">Calculate & Compare</button>
                <div id="adj-flip" style="display:none; margin-top:20px; color:var(--success); font-size: 1.3rem;">
                    Adding interest back increases ROA slightly (16.6% -> 17.2%), removing the effect of debt financing.
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 17: CEO PLAYBOOK -->
    <div class="slide" data-title="CEO Playbook">
        <h2>The CEO's Playbook: Increasing ROE</h2>
        <p>Managers have three levers to pull. Click the cards to explore.</p>
        <div class="grid-3">
            <div class="flip-card" onclick="this.classList.toggle('flipped')" style="height: 300px;">
                <div class="flip-inner">
                    <div class="flip-front" style="background: #10b981;">
                        <h3 class="text-white">Option 1: Operationally</h3>
                        <small class="text-white" style="font-size: 1rem;">(Click)</small>
                    </div>
                    <div class="flip-back">
                        <h3>Improve Margins</h3>
                        <p>Increase prices, reduce COGS, or cut SG&A overhead. Boosts Profit Margin.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')" style="height: 300px;">
                <div class="flip-inner">
                    <div class="flip-front" style="background: #3b82f6;">
                        <h3 class="text-white">Option 2: Efficiency</h3>
                        <small class="text-white" style="font-size: 1rem;">(Click)</small>
                    </div>
                    <div class="flip-back">
                        <h3>Improve Turnover</h3>
                        <p>Sell inventory faster (lower DIO), collect cash sooner (lower DSO), or use fewer assets.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')" style="height: 300px;">
                <div class="flip-inner">
                    <div class="flip-front" style="background: #f43f5e;">
                        <h3 class="text-white">Option 3: Financially</h3>
                        <small class="text-white" style="font-size: 1rem;">(Click)</small>
                    </div>
                    <div class="flip-back">
                        <h3>Increase Leverage</h3>
                        <p>Borrow money to buy back stock. Shrinks equity and amplifies returns (and risk).</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 18: LIMITS OF ROE (Expanded questions) -->
    <div class="slide" data-title="Limits of ROE">
        <h2><i class="fas fa-search"></i> The Limits of ROE</h2>
        <p>ROE is a powerful metric, but it can be a "fuzzy" lens. Test your ability to spot its blind spots.</p>

        <div class="iq-container">
            <div class="iq-card">
                <div class="iq-question">Q1: Company A has an ROE of 25%, but employees are quitting en masse. Does ROE capture this?</div>
                <div class="iq-options">
                    <button class="iq-btn" onclick="checkIQ(this, false, 'q1-fb')">Yes</button>
                    <button class="iq-btn" onclick="checkIQ(this, true, 'q1-fb')">No</button>
                </div>
                <div id="q1-fb" class="iq-feedback"><strong>Correct!</strong> ROE is a lagging financial metric.</div>
            </div>

            <div class="iq-card">
                <div class="iq-question">Q2: Why is "Average Equity" misleading for software companies?</div>
                <div class="iq-options">
                    <button class="iq-btn" onclick="checkIQ(this, true, 'q2-fb')">Excludes Intangibles</button>
                    <button class="iq-btn" onclick="checkIQ(this, false, 'q2-fb')">Includes Debt</button>
                </div>
                <div id="q2-fb" class="iq-feedback"><strong>Correct!</strong> GAAP often ignores internally generated code/brand value.</div>
            </div>

            <div class="iq-card">
                <div class="iq-question">Q3: If a company takes on massive debt to boost ROE, is it "healthier"?</div>
                <div class="iq-options">
                    <button class="iq-btn" onclick="checkIQ(this, false, 'q3-fb')">Yes</button>
                    <button class="iq-btn" onclick="checkIQ(this, true, 'q3-fb')">No</button>
                </div>
                <div id="q3-fb" class="iq-feedback"><strong>Correct!</strong> Higher ROE from debt increases bankruptcy risk, which ROE alone doesn't show.</div>
            </div>
        </div>
    </div>

    <!-- SLIDE 19: SUMMARY -->
    <div class="slide" data-title="Summary">
        <h2>Executive Summary</h2>
        <div class="grid-2">
            <div class="card card-highlight">
                <ul style="list-style:none; padding:0;">
                    <li class="mb-4"><i class="fas fa-layer-group text-primary mr-2"></i> <strong>DuPont Framework:</strong> Deconstructs ROE into Profit Margin, Asset Turnover, and Financial Leverage.</li>
                    <li class="mb-4"><i class="fas fa-sync text-primary mr-2"></i> <strong>Cash Conversion Cycle:</strong> Negative CCC (like Apple) is a massive competitive advantage.</li>
                    <li class="mb-4"><i class="fas fa-sliders-h text-primary mr-2"></i> <strong>Adjustments:</strong> Always use <strong>Average</strong> Assets/Equity.</li>
                    <li class="mb-4"><i class="fas fa-exclamation-triangle text-rose mr-2"></i> <strong>Limitations:</strong> ROE ignores non-financial risks.</li>
                </ul>
            </div>
            <div class="flex-center" style="flex-direction:column;">
                <h3 class="text-center">Ready to test your mastery?</h3>
                <button class="btn-action" onclick="startExam()">Start Final Exam</button>
            </div>
        </div>
    </div>

    <!-- FINAL QUIZ CONTAINER -->
    <div id="exam-container"></div>

    <!-- NAVIGATION BAR -->
    <div id="nav-bar">
        <button class="btn-action secondary" onclick="toggleTOC()" style="padding: 10px 20px; margin:0;"><i class="fas fa-bars"></i> Contents</button>
        <div class="progress-bar-container">
            <div id="progress-fill"></div>
        </div>
        <div>
            <button class="btn-action secondary" onclick="prevSlide()" style="width: auto; padding: 10px 20px; margin:0;"><i class="fas fa-chevron-left"></i></button>
            <span id="slide-indicator" style="margin: 0 20px; font-weight:600; font-family:var(--mono-font); font-size: 1.2rem;">1 / 19</span>
            <button class="btn-action" onclick="nextSlide()" style="width: auto; padding: 10px 20px; margin:0;"><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <!-- TOC MODAL -->
    <div id="toc-modal" onclick="toggleTOC()">
        <div class="toc-content" id="toc-list" onclick="event.stopPropagation()">
            <!-- Generated by JS -->
        </div>
    </div>

</div>

<script>
    // --- STATE ---
    let currentSlide = 0;
    
    // --- EXAM DATA (Expanded to 15 questions) ---
    const examQuestions = [
        { q: "What is the precise formula for ROE using DuPont components?", options: ["Net Income / Assets", "Net Income / Average Equity", "Sales / Equity"], a: 1 },
        { q: "Which component represents Operational Efficiency regarding resources?", options: ["Financial Leverage", "Asset Turnover", "Profit Margin"], a: 1 },
        { q: "If Net Income = $100 and Average Equity = $500, what is ROE?", options: ["5%", "20%", "50%"], a: 1 },
        { q: "Why do we use 'Average' Assets in the ROA formula?", options: ["Because assets are liquid", "To match a flow metric (Income) with a stock metric (Assets)", "To inflate the number"], a: 1 },
        { q: "A negative Cash Conversion Cycle means:", options: ["The company is losing money", "Suppliers are effectively financing the company", "Inventory is stuck"], a: 1 },
        { q: "If a company aggressively buys back stock, what happens to ROE mathematically?", options: ["Decreases", "Increases (because Equity shrinks)", "Stays the same"], a: 1 },
        { q: "What is the formula for Equity Multiplier?", options: ["Avg Assets / Avg Equity", "Total Liabilities / Equity", "Net Income / Sales"], a: 0 },
        { q: "If Asset Turnover is 2.0 and Profit Margin is 10%, what is ROA?", options: ["12%", "20%", "5%"], a: 1 },
        { q: "Which of these increases Financial Leverage?", options: ["Issuing more stock", "Paying off debt", "Buying back stock with debt"], a: 2 },
        { q: "Does ROE capture the risk of employee turnover?", options: ["Yes", "No", "Yes, if turnover is high"], a: 1 },
        { q: "Why adjust ROA by adding back interest?", options: ["To isolate operating performance from financing decisions", "To lower taxes", "To make the number smaller"], a: 0 },
        { q: "Apple's negative CCC is primarily driven by:", options: ["High inventory levels", "High Days Payable Outstanding (DPO)", "Low sales volume"], a: 1 },
        { q: "If Net Income is $50 and Sales are $500, what is Profit Margin?", options: ["50%", "10%", "5%"], a: 1 },
        { q: "A conglomerate ROE can hide:", options: ["Poor performing business units", "Total Revenue", "Tax rates"], a: 0 },
        { q: "Which industry typically has low Asset Turnover?", options: ["Software", "Utilities (heavy infrastructure)", "Retail"], a: 1 }
    ];

    let examScore = 0;

    // --- NAVIGATION LOGIC ---
    function init() {
        generateExamSlides();
        generateTOC();
        updateNav();
    }

    function showSlide(n) {
        const slides = document.querySelectorAll('.slide');
        if (n >= slides.length) n = slides.length - 1;
        if (n < 0) n = 0;
        
        slides.forEach(s => s.classList.remove('active'));
        slides[n].classList.add('active');
        currentSlide = n;
        updateNav();
        updateTOCActive();
    }

    function nextSlide() { showSlide(currentSlide + 1); }
    function prevSlide() { showSlide(currentSlide - 1); }

    function updateNav() {
        const slides = document.querySelectorAll('.slide');
        document.getElementById('slide-indicator').textContent = `${currentSlide + 1} / ${slides.length}`;
        const pct = ((currentSlide + 1) / slides.length) * 100;
        document.getElementById('progress-fill').style.width = `${pct}%`;
    }

    // --- TOC LOGIC ---
    function toggleTOC() {
        const modal = document.getElementById('toc-modal');
        modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
    }

    function generateTOC() {
        const slides = document.querySelectorAll('.slide');
        const tocList = document.getElementById('toc-list');
        tocList.innerHTML = '';
        
        slides.forEach((slide, index) => {
            const title = slide.getAttribute('data-title') || `Slide ${index + 1}`;
            const item = document.createElement('div');
            item.className = 'toc-item';
            item.innerText = `${index + 1}. ${title}`;
            item.onclick = () => {
                showSlide(index);
                toggleTOC();
            };
            tocList.appendChild(item);
        });
    }

    function updateTOCActive() {
        const items = document.querySelectorAll('.toc-item');
        items.forEach((item, index) => {
            if(index === currentSlide) item.classList.add('active');
            else item.classList.remove('active');
        });
    }

    // --- INTERACTIVE FUNCTIONS ---

    // Slide 3: ROE Calc
    function calcROE() {
        const ni = parseFloat(document.getElementById('roe-ni').value);
        const eq = parseFloat(document.getElementById('roe-eq').value);
        if(ni && eq) {
            const roe = ((ni / eq) * 100).toFixed(1);
            document.getElementById('roe-result').innerText = roe + "%";
        }
    }

    // Generic Step Reveal (Used for ROA and ROE Deconstruction)
    function showStep(stepId, btn) {
        document.getElementById(stepId).classList.remove('step-hidden');
        document.getElementById(stepId).classList.add('step-visible');
        btn.style.display = 'none'; // Hide button after clicking
    }

    // Slide 11: Company Selection & Confetti
    function selectCompanyA(card) {
        alert('Correct! Software companies generate sales with very few assets, resulting in high turnover ratios.');
        fireConfetti();
    }

    function fireConfetti() {
        const colors = ['#4f46e5', '#f43f5e', '#10b981', '#f59e0b'];
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = -10 + 'px';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }
    }

    // Slide 12: CCC Builder
    let cccFormula = [];
    function addToCCC(val) {
        cccFormula.push(val);
        document.getElementById('ccc-equation').innerText = cccFormula.join(" "); 
        checkCCCFormula();
    }
    
    function resetCCC() {
        cccFormula = [];
        document.getElementById('ccc-equation').innerText = "";
        document.getElementById('ccc-feedback').innerText = "";
    }

    function checkCCCFormula() {
        const hasDIO = cccFormula.includes('+ DIO');
        const hasDSO = cccFormula.includes('+ DSO');
        const hasDPO = cccFormula.includes('- DPO');
        
        if(cccFormula.length === 3) {
            if(hasDIO && hasDSO && hasDPO) {
                 document.getElementById('ccc-feedback').innerHTML = "<span class='text-success'><i class='fas fa-check-circle'></i> Correct! Formula: DIO + DSO - DPO</span>";
            } else {
                 document.getElementById('ccc-feedback').innerHTML = "<span class='text-rose'><i class='fas fa-times-circle'></i> Incorrect signs.</span>";
            }
        }
    }

    // Slide 13: Apple Animation - Updated Logic for Negative CCC
    function animateAppleCCC() {
        const barDPO = document.getElementById('bar-dpo');
        const barDIO = document.getElementById('bar-dio');
        const barDSO = document.getElementById('bar-dso');
        const text = document.getElementById('apple-ccc-text');
        const bracket = document.getElementById('ccc-bracket');
        
        // Reset state
        barDIO.style.width = "0"; barDSO.style.width = "0"; barDPO.style.width = "0";
        // Reset positioning logic
        barDSO.style.left = "50%"; 
        // Reset DPO logic
        barDPO.style.right = "auto";
        barDPO.style.left = "auto"; 
        
        bracket.style.opacity = "0";
        text.innerText = "";
        
        // Revised Scale: 1 day = 5px
        // DIO (9d) = 60px (Wider per user request)
        // DSO (25d) = 125px
        // DPO (97d) = 485px
        // CCC (-63d) = 300px

        setTimeout(() => {
            // 1. DIO (9 days) -> Extends Right from 50%
            barDIO.style.width = "60px"; 
            barDIO.innerText = "DIO (9d)";
            
            setTimeout(() => {
                // 2. DSO (25 days) -> Extends Right from end of DIO (50% + 60px)
                barDSO.style.left = "calc(50% + 60px)"; 
                barDSO.style.width = "125px"; 
                barDSO.innerText = "DSO (25d)";
                
                setTimeout(() => {
                    // 3. DPO (97 days) -> Extends LEFT from End of DSO
                    // End of DSO is at 50% + 60px + 125px = 50% + 185px from LEFT.
                    // This means it is 50% - 185px from RIGHT.
                    // We anchor the Right edge of the DPO bar to this point.
                    
                    barDPO.style.left = "auto";
                    barDPO.style.right = "calc(50% - 185px)";
                    barDPO.style.width = "485px";
                    barDPO.innerText = "DPO (97d)";
                    
                    setTimeout(() => {
                        // Bracket: Covers the gap from DPO Start (leftmost point) to Cash Zero (center)
                        // Leftmost point is Day -63 (-300px from center).
                        // Width = 300px.
                        // Anchored at Center (50%).
                        bracket.style.left = "auto";
                        bracket.style.right = "50%";
                        bracket.style.width = "300px";
                        bracket.style.opacity = "1";
                        
                        text.innerHTML = "Result: Cash Cycle is NEGATIVE 63 Days.<br><span class='text-success'>Apple holds cash for 2 months before paying bills.</span>";
                    }, 1500); // Wait for DPO animation
                }, 1500); // Wait for DSO animation
            }, 1500); // Wait for DIO animation
        }, 100);
    }

    // Slide 14: Lever Animation
    function animateLever() {
        const beam = document.getElementById('lever-beam');
        const text = document.getElementById('lever-text');
        beam.style.transform = "rotate(0deg)";
        text.style.opacity = "0"; text.style.display = "none";
        setTimeout(() => {
            beam.style.transform = "rotate(-15deg)"; // Tilt
            text.style.display = "block";
            setTimeout(() => { text.style.opacity = "1"; }, 100);
        }, 100);
    }

    // Slide 15: Buyback Simulator
    function updateSimulator() {
        const buyback = parseFloat(document.getElementById('buyback-slider').value);
        const currentEquity = 100 - buyback;
        document.getElementById('sim-equity').innerText = currentEquity;
        const roe = (50 / currentEquity) * 100;
        document.getElementById('bar-equity').style.height = currentEquity + "px";
        document.getElementById('bar-roe').style.height = Math.min(roe, 200) + "px"; 
        document.getElementById('bar-roe').innerText = roe.toFixed(0) + "%";
        if(roe > 100) document.getElementById('bar-roe').style.background = "var(--accent)"; 
        else document.getElementById('bar-roe').style.background = "var(--primary)";
    }

    // Slide 16: Adj ROA Reveal
    function revealAdjROA() {
        // 1500 * (1 - 0.15) = 1275. (31372 + 1275) / 189341 = 17.2%
        document.getElementById('calc-res').innerText = "17.2%";
        document.getElementById('calc-res').style.fontWeight = "bold";
        document.getElementById('calc-res').style.color = "var(--success)";
        document.getElementById('adj-flip').style.display = "block";
    }

    // Interactive Quiz Logic
    function checkIQ(btn, isCorrect, feedbackId) {
        const parent = btn.parentElement;
        const buttons = parent.querySelectorAll('.iq-btn');
        const feedback = document.getElementById(feedbackId);
        buttons.forEach(b => {
            b.classList.remove('selected-correct', 'selected-wrong');
            b.style.pointerEvents = 'none';
        });

        if (isCorrect) {
            btn.classList.add('selected-correct');
            feedback.innerHTML = `<span class='text-success'><i class='fas fa-check'></i></span> ` + feedback.innerHTML;
            feedback.style.background = "#ecfdf5"; feedback.style.color = "#065f46";
        } else {
            btn.classList.add('selected-wrong');
            feedback.innerHTML = `<span class='text-rose'><i class='fas fa-times'></i></span> ` + feedback.innerHTML;
            feedback.style.background = "#fff1f2"; feedback.style.color = "#9f1239";
        }
        feedback.classList.add('visible');
    }

    // --- EXAM GENERATION ---
    function generateExamSlides() {
        const container = document.getElementById('app-container');
        examQuestions.forEach((q, index) => {
            const slideDiv = document.createElement('div');
            slideDiv.className = 'slide';
            slideDiv.setAttribute('data-title', `Exam Q${index+1}`);
            if (index === 0) slideDiv.id = 'first-exam-slide';
            
            slideDiv.innerHTML = `
                <h2>Final Exam: Question ${index + 1}</h2>
                <div class="card" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <p style="font-size:2rem; font-weight:600; margin-bottom:2.5rem;">${q.q}</p>
                    <div id="opts-${index}" style="width:100%; display:flex; flex-direction:column; gap:20px; max-width:700px;">
                        ${q.options.map((opt, i) => `
                            <button class="btn-action secondary" style="width:100%; text-align:left; font-size:1.4rem;" onclick="checkAnswer(${index}, ${i}, this)">${opt}</button>
                        `).join('')}
                    </div>
                    <p id="feedback-${index}" class="mt-4 font-weight-bold" style="font-size:1.6rem;"></p>
                </div>
            `;
            container.insertBefore(slideDiv, document.getElementById('nav-bar'));
        });

        const scoreSlide = document.createElement('div');
        scoreSlide.className = 'slide';
        scoreSlide.setAttribute('data-title', 'Completion');
        scoreSlide.innerHTML = `
            <div class="flex-center" style="flex-direction:column; text-align:center;">
                <i class="fas fa-trophy fa-4x text-warning mb-4"></i>
                <h1>Course Completed</h1>
                <h2 id="final-score-display"></h2>
                <button class="btn-action" onclick="location.reload()">Restart Course</button>
            </div>
        `;
        container.insertBefore(scoreSlide, document.getElementById('nav-bar'));
    }

    function startExam() {
        const q1 = document.getElementById('first-exam-slide');
        if (q1) {
            const allSlides = Array.from(document.querySelectorAll('.slide'));
            const q1Index = allSlides.indexOf(q1);
            showSlide(q1Index);
        }
    }

    function checkAnswer(qIndex, ansIndex, btn) {
        const parent = document.getElementById(`opts-${qIndex}`);
        const opts = parent.querySelectorAll('button');
        opts.forEach(o => o.style.pointerEvents = 'none');
        const correctIndex = examQuestions[qIndex].a;
        
        if(ansIndex === correctIndex) {
            btn.style.background = "var(--success)";
            examScore++;
            document.getElementById(`feedback-${qIndex}`).innerHTML = "<span class='text-success'>Correct!</span>";
        } else {
            btn.style.background = "var(--accent)";
            opts[correctIndex].style.background = "var(--success)";
            document.getElementById(`feedback-${qIndex}`).innerHTML = "<span class='text-rose'>Incorrect.</span>";
        }
        document.getElementById('final-score-display').innerText = `Score: ${examScore} / ${examQuestions.length}`;
    }

    // Init
    init();

</script>
</body>
</html>
