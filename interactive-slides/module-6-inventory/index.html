<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventories & Accounts Payable Module - Watershed Style</title>
    <!-- Google Fonts: Inter & JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. Watershed Design System --- */
        :root {
            /* Palette */
            --color-background: #ffffff;
            --color-newday: #fffbf3; /* Cream Background */
            --color-cobalt-core: #265cff; /* Bright Blue Accent */
            --color-cobalt-deep: #1e4bd6;
            --color-cobalt-20: rgba(38, 92, 255, 0.2);
            --color-cobalt-10: rgba(38, 92, 255, 0.1);
            --color-midnight: #041330; /* Text Color */
            --color-success: #27ae60; 
            --color-error: #e74c3c;   
            --color-warning: #f1c40f; 

            /* Inventory Layers */
            --layer-old: #cc5de8; /* Purple */
            --layer-mid: #265cff; /* Cobalt */
            --layer-new: #00d2d3; /* Cyan */

            /* Layout */
            --grid-size: 60px;
            --slide-width: 1280px;
            --slide-height: 720px;
            --border-style: 1px solid var(--color-cobalt-20);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--color-newday);
            font-family: 'Inter', sans-serif;
            color: var(--color-midnight);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;

            /* Signature Grid Background */
            background-size: var(--grid-size) var(--grid-size);
            background-image: 
                linear-gradient(to right, var(--color-cobalt-20) 1px, transparent 1px),
                linear-gradient(to bottom, var(--color-cobalt-20) 1px, transparent 1px);
        }

        #app-container {
            width: var(--slide-width);
            height: var(--slide-height);
            background-color: var(--color-background);
            border: var(--border-style);
            box-shadow: 0 20px 60px rgba(4, 19, 48, 0.1); /* Midnight shadow */
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Slide Layout */
        .slide {
            flex: 1;
            padding: 50px 80px;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.4s ease;
            overflow-y: auto;
            position: relative;
        }
        .slide.active { display: flex; }

        /* Typography UPDATED (Larger Sizes) */
        h1 { 
            font-size: 3.8rem; /* Increased from 3.5 */
            font-weight: 600; 
            color: var(--color-midnight); 
            margin-bottom: 15px; 
            letter-spacing: -0.03em;
            line-height: 1.1;
        }
        h2 { 
            font-family: 'Inter', sans-serif;
            font-size: 2.4rem; /* Increased from 2rem */
            font-weight: 500;
            border-bottom: 2px solid var(--color-cobalt-core); 
            padding-bottom: 15px; 
            margin-bottom: 25px; 
            color: var(--color-midnight); 
            display: inline-block; 
            letter-spacing: -0.02em;
        }
        h3 { 
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.4rem; /* Increased from 1.2 */
            color: var(--color-cobalt-core); 
            margin-top: 20px; 
            margin-bottom: 10px; 
            font-weight: 500; 
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        p, li { 
            font-size: 1.35rem; /* Increased from 1.15 */
            line-height: 1.6; 
            margin-bottom: 15px; 
            color: var(--color-midnight); 
            font-weight: 400;
        }
        .mono-data { 
            font-family: 'JetBrains Mono', monospace; 
            font-weight: 700; 
            color: var(--color-cobalt-core); 
        }
        .highlight { color: var(--color-cobalt-core); font-weight: 600; }
        .warning { color: var(--color-error); font-weight: 600; }
        
        .math-box {
            background: var(--color-newday);
            border: 1px solid var(--color-cobalt-core);
            padding: 20px;
            margin: 15px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.4rem; /* Increased */
            color: var(--color-midnight);
        }

        /* Tables - Clean Style */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 1.15rem; /* Increased */
            border: var(--border-style);
        }
        .data-table th, .data-table td { 
            padding: 18px 22px; 
            border-bottom: var(--border-style); 
            text-align: left; 
        }
        .data-table th { 
            background-color: var(--color-newday); 
            color: var(--color-midnight); 
            text-transform: uppercase; 
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem; 
            letter-spacing: 0.05em;
            font-weight: 500;
            border-bottom: 2px solid var(--color-cobalt-core);
        }
        .data-table .num-col { text-align: right; font-family: 'JetBrains Mono', monospace; }
        .data-table tr:hover { background-color: var(--color-newday); }
        .data-table tr.highlight-row { background-color: var(--color-cobalt-10); font-weight: 600; }

        /* --- FSE Dark Template --- */
        .fse-dark {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.05rem; /* Increased */
            margin-top: 25px;
            text-align: center;
            background: var(--color-midnight); 
            color: #ffffff;
            border: none;
            box-shadow: 0 10px 30px rgba(4, 19, 48, 0.2);
        }
        .fse-dark thead tr:first-child th {
            background-color: #0a1f45;
            color: #8da2ce;
            text-transform: uppercase;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            padding: 10px;
            letter-spacing: 0.05em;
        }
        .fse-dark thead .fse-header-orange th {
            background-color: var(--color-cobalt-core); 
            color: white;
            padding: 15px;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        .fse-dark tbody td {
            padding: 18px;
            border-top: 1px solid #1e3a6e;
            border-right: 1px solid #1e3a6e;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
        }
        .fse-dark tbody td:last-child, .fse-dark thead th:last-child { border-right: none; }
        .fse-border-left { border-left: 2px solid #5c7cfa !important; }
        .val-plus { color: #4ade80; font-weight: bold; }
        .val-minus { color: #f87171; font-weight: bold; }
        .val-neutral { color: #64748b; }

        /* Slide 47 Elimination Slash */
        .eliminated { position: relative; color: #64748b !important; }
        .eliminated::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top right, transparent calc(50% - 1px), var(--color-warning) calc(50% - 1px), var(--color-warning) calc(50% + 1px), transparent calc(50% + 1px));
            pointer-events: none;
        }

        /* Flip Cards - Flat Design */
        .card-container { display: flex; gap: 30px; margin-top: 30px; perspective: 1000px; justify-content: center; flex-wrap: wrap; }
        .flip-card { background-color: transparent; width: 320px; height: 400px; perspective: 1000px; cursor: pointer; }
        .flip-card-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s; transform-style: preserve-3d;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
        }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 25px;
            border: 1px solid var(--color-cobalt-core);
            background: white;
        }
        .flip-card-front { 
            background: var(--color-cobalt-core); 
            color: white; 
            border: none;
        }
        .flip-card-front h3 { color: white; font-size: 2rem; border: none; font-family: 'Inter', sans-serif; }
        .flip-card-back {
            background-color: white; 
            color: var(--color-midnight);
            transform: rotateY(180deg); 
            font-size: 1.15rem;
        }
        .flip-card-back h3 { color: var(--color-cobalt-core); border-bottom: 2px solid var(--color-cobalt-20); padding-bottom: 10px; }

        /* Simulations */
        .sim-wrapper { display: flex; height: 400px; gap: 30px; margin-top: 20px; }
        .sim-column { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .sim-box {
            flex: 1; background: #ffffff; 
            border: 1px dashed var(--color-cobalt-core); 
            padding: 15px; display: flex; flex-direction: column; overflow-y: auto;
        }
        .inv-block {
            padding: 14px; margin: 5px 0; cursor: grab;
            font-family: 'JetBrains Mono', monospace; font-weight: 500; display: flex;
            justify-content: space-between; align-items: center; 
            border: 1px solid rgba(0,0,0,0.1);
            color: white; transition: transform 0.2s; font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .cost-old { background-color: var(--layer-old); color: white; }
        .cost-mid { background-color: var(--layer-mid); color: white; }
        .cost-new { background-color: var(--layer-new); color: var(--color-midnight); }
        .cost-avg { background-color: var(--color-midnight); color: white; }

        /* Timeline / CCC Visualization */
        .timeline-container {
            position: relative; width: 100%; height: 300px; margin-top: 20px; 
            background: var(--color-newday); 
            border: var(--border-style); 
            padding: 20px;
        }
        .tl-bar {
            position: absolute; height: 40px; color: white;
            display: flex; align-items: center; justify-content: center; font-weight: 600; font-family: 'JetBrains Mono';
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: all 0.5s ease;
            font-size: 1.1rem;
        }
        .tl-dio { background: var(--color-cobalt-core); top: 60px; }
        .tl-dso { background: var(--color-success); top: 60px; }
        .tl-dpo { background: var(--color-error); top: 130px; left: 20px; }
        .tl-ccc-line { 
            position: absolute; top: 200px; height: 2px; background: var(--color-midnight); transition: all 0.5s ease;
        }
        .tl-ccc-line::before, .tl-ccc-line::after { content: ''; position: absolute; top: -5px; width: 2px; height: 12px; background: var(--color-midnight); }
        .tl-ccc-line::before { left: 0; } .tl-ccc-line::after { right: 0; }
        .tl-label { position: absolute; font-size: 1.1rem; color: var(--color-midnight); font-family: 'JetBrains Mono'; }
        
        .slider-container { display: flex; gap: 20px; margin-bottom: 20px; justify-content: center; background: white; padding: 20px; border: var(--border-style); }
        .slider-group { display: flex; flex-direction: column; width: 150px; }
        .slider-group label { font-family: 'JetBrains Mono'; font-size: 0.9rem; font-weight: bold; margin-bottom: 8px; color: var(--color-cobalt-core); }
        input[type=range] { accent-color: var(--color-cobalt-core); }

        /* Summary */
        .summary-item { 
            opacity: 0; transform: translateX(-20px); transition: all 0.5s ease; 
            background: white; padding: 25px; margin: 10px 0; border: 1px solid var(--color-cobalt-20);
            border-left: 4px solid var(--color-cobalt-core);
            pointer-events: none;
            font-size: 1.2rem;
        }
        .summary-item.visible { opacity: 1; transform: translateX(0); pointer-events: auto; }

        /* Quiz */
        .quiz-container { max-width: 900px; margin: 0 auto; height: 450px; overflow-y: auto; }
        .quiz-option {
            background: white; border: 1px solid var(--color-cobalt-20); padding: 20px; margin: 12px 0;
            cursor: pointer; transition: 0.2s; font-size: 1.25rem;
        }
        .quiz-option:hover { background: var(--color-newday); border-color: var(--color-cobalt-core); }
        .quiz-option.correct { background: #dcfce7; color: var(--color-midnight); border-color: var(--color-success); }
        .quiz-option.wrong { background: #fee2e2; color: var(--color-midnight); border-color: var(--color-error); }

        /* Controls */
        #controls {
            height: 80px; background-color: var(--color-background); display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; border-top: var(--border-style); z-index: 100;
        }
        .nav-btn {
            background: var(--color-cobalt-core); color: white; border: none; padding: 14px 36px; 
            cursor: pointer; font-size: 1.1rem; font-weight: 500; transition: all 0.2s; font-family: 'Inter', sans-serif;
            border-radius: 2px; /* Slight rounding for Watershed feel */
        }
        .nav-btn:hover { background: var(--color-cobalt-deep); }
        
        .action-btn { 
            background: white; color: var(--color-cobalt-core); border: 1px solid var(--color-cobalt-core); 
            padding: 12px 28px; cursor: pointer; font-size: 1.1rem; font-family: 'Inter'; font-weight: 500;
            transition: all 0.2s;
        }
        .action-btn:hover { background: var(--color-newday); }
        .action-btn.danger { border-color: var(--color-error); color: var(--color-error); }
        .action-btn.danger:hover { background: #fee2e2; }
        .action-btn.success { background: var(--color-success); color: white; border-color: var(--color-success); }
        .action-btn.success:hover { background: #1e8449; }

        #progress-bar { position: absolute; bottom: 80px; left: 0; height: 4px; background: var(--color-cobalt-core); width: 0%; transition: width 0.3s; }
        
        .center-slide { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; height: 100%; }
        .callout { 
            background: var(--color-newday); 
            border: 1px solid var(--color-cobalt-20);
            border-left: 4px solid var(--color-cobalt-core); 
            padding: 35px; margin: 30px 0; 
        }
        .flex-row { display: flex; gap: 40px; }
        .flex-col { flex: 1; }
        .step-box { background: white; padding: 15px; border: var(--border-style); margin-bottom: 10px; display: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .poll-question { font-size: 1.8rem; font-weight: 600; color: var(--color-midnight); margin-bottom: 25px; }
        .poll-option { background: white; border: 1px solid var(--color-cobalt-20); padding: 20px; margin: 12px 0; cursor: pointer; transition: 0.2s; font-size: 1.2rem;}
        .poll-option:hover { border-color: var(--color-cobalt-core); background: var(--color-newday); }
        .poll-reveal { display: none; margin-top: 20px; padding: 20px; background: #e8f6f3; border: 1px solid var(--color-success); color: var(--color-midnight); font-size: 1.1rem;}

        /* Small Grid for Formulas */
        .formula-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
        .formula-card { background: white; padding: 30px; border: var(--border-style); box-shadow: 0 5px 15px rgba(0,0,0,0.03); }

        /* Interactive Table Slide 25 */
        .compare-row { transition: background 0.3s; }
        .active-col { background-color: var(--color-newday); font-weight: bold; border: 1px solid var(--color-cobalt-core); }
        .dim-col { opacity: 0.4; }
        
        /* SVG Transition */
        svg line, svg circle, svg text { transition: all 0.8s ease; }
        
        /* Financial Statement Styles for Slide 27 */
        .fs-container { 
            background: white; border: var(--border-style); padding: 25px; 
            font-family: 'JetBrains Mono', monospace; font-size: 0.95rem; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            border-top: 4px solid var(--color-midnight); 
        }
        .fs-header { font-weight: 700; border-bottom: 2px solid var(--color-midnight); margin-bottom: 12px; padding-bottom: 5px; font-size: 1.1rem; color: var(--color-midnight); text-transform: uppercase; }
        .fs-subheader { font-weight: 600; font-size: 0.9rem; margin-bottom: 10px; text-transform: uppercase; color: #64748b; }
        .fs-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .fs-note { font-size: 0.9rem; font-style: italic; margin-top: 15px; color: #64748b; background: var(--color-newday); padding: 12px; border-left: 2px solid #cbd5e1; }

        /* --- NEW MENU STYLES --- */
        #menu-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            z-index: 200;
            background: white;
            border: 1px solid var(--color-cobalt-core);
            color: var(--color-cobalt-core);
            padding: 10px 15px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        #menu-btn:hover { background: var(--color-cobalt-core); color: white; }
        
        #toc-sidebar {
            position: absolute;
            top: 0;
            right: -400px;
            width: 350px;
            height: 100%;
            background: white;
            border-left: 1px solid var(--color-cobalt-20);
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            z-index: 300;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        #toc-sidebar.open { right: 0; }
        
        .toc-header {
            padding: 20px;
            background: var(--color-midnight);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toc-header h3 { color: white; margin: 0; font-size: 1.2rem; border: none; }
        .close-toc { cursor: pointer; color: white; font-size: 1.5rem; }
        
        .toc-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        .toc-item {
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background 0.2s;
            color: var(--color-midnight);
        }
        .toc-item:hover { background: var(--color-newday); color: var(--color-cobalt-core); }
        .toc-item.active { background: var(--color-cobalt-10); font-weight: 600; border-left: 4px solid var(--color-cobalt-core); }
        .toc-section-header {
            padding: 15px 20px 5px 20px;
            font-family: 'JetBrains Mono';
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="app-container">

    <!-- Menu Button -->
    <button id="menu-btn" onclick="toggleMenu()">
        <i class="fas fa-bars"></i> Menu
    </button>

    <!-- Table of Contents Sidebar -->
    <div id="toc-sidebar">
        <div class="toc-header">
            <h3>Table of Contents</h3>
            <span class="close-toc" onclick="toggleMenu()">&times;</span>
        </div>
        <div class="toc-content" id="toc-list">
            <!-- Items injected via JS -->
        </div>
    </div>

    <!-- 1. Cover -->
    <div class="slide active" id="slide-1">
        <div class="center-slide">
            <div style="margin-bottom: 30px; font-family: 'JetBrains Mono'; color: var(--color-cobalt-core); letter-spacing: 0.1em; font-size: 1.2rem;">FINANCIAL ACCOUNTING</div>
            <h1 style="font-size: 5rem;">Inventories & Accounts Payable</h1>
            <h2 style="border-bottom: none; margin-bottom: 10px; color: var(--color-cobalt-core);">Comprehensive Module</h2>
            <p style="font-family: 'JetBrains Mono'; color: #64748b; margin-top: 20px;">CLASS 6 CONTENT / 2026</p>
            <div style="margin-top: 60px;">
                <button class="nav-btn" onclick="nextSlide()">Start Module</button>
            </div>
        </div>
    </div>

    <!-- 2. Objectives -->
    <div class="slide" id="slide-2">
        <div style="border-bottom: var(--border-style); padding-bottom: 20px; margin-bottom: 30px;">
            <span style="font-family: 'JetBrains Mono'; color: var(--color-cobalt-core); font-size: 1.1rem;">SECTION 1</span>
            <h1 style="font-size: 3rem; margin-top: 10px;">Learning Objectives</h1>
        </div>
        <ul style="list-style: none;">
            <li style="margin-bottom: 25px;"><i class="fas fa-check" style="color: var(--color-cobalt-core); margin-right: 15px;"></i>Evaluate inventory costing methods (FIFO, LIFO, Weighted Average).</li>
            <li style="margin-bottom: 25px;"><i class="fas fa-check" style="color: var(--color-cobalt-core); margin-right: 15px;"></i>Examine inventory disclosures in financial statements.</li>
            <li style="margin-bottom: 25px;"><i class="fas fa-check" style="color: var(--color-cobalt-core); margin-right: 15px;"></i>Analyze inventories and the related accounts payable.</li>
            <li style="margin-bottom: 25px;"><i class="fas fa-check" style="color: var(--color-cobalt-core); margin-right: 15px;"></i>Understand the Cash Conversion Cycle (CCC).</li>
            <li style="margin-bottom: 25px;"><i class="fas fa-check" style="color: var(--color-cobalt-core); margin-right: 15px;"></i>Case Studies: Caterpillar, Pfizer, First Brands.</li>
        </ul>
    </div>

    <!-- 3. Flow of Costs -->
    <div class="slide" id="slide-3">
        <h2>The Flow of Costs</h2>
        <div class="flex-row" style="align-items: center; margin-top: 60px;">
            <div class="flex-col" style="background:white; padding:40px; border: var(--border-style); text-align:center;">
                <i class="fas fa-warehouse" style="font-size: 4rem; color: var(--color-midnight); margin-bottom: 20px;"></i>
                <h3>Buy / Make</h3>
                <p>Costs are <strong>Capitalized</strong> (Asset).</p>
            </div>
            <div style="font-size:3rem; color:var(--color-cobalt-20);"><i class="fas fa-arrow-right"></i></div>
            <div class="flex-col" style="background:white; padding:40px; border: var(--border-style); text-align:center;">
                <i class="fas fa-cash-register" style="font-size: 4rem; color: var(--color-cobalt-core); margin-bottom: 20px;"></i>
                <h3>Sell</h3>
                <p>Costs are <strong>Expensed</strong> (COGS).</p>
            </div>
        </div>
    </div>

    <!-- 4. Capitalization -->
    <div class="slide" id="slide-4">
        <h2>Capitalization of Inventory Cost</h2>
        <div class="callout">
            <h3>Components:</h3>
            <ol style="padding-left:40px; margin-top: 15px;">
                <li style="margin-bottom: 15px;"><strong>Direct Materials</strong>: Raw inputs used in the product.</li>
                <li style="margin-bottom: 15px;"><strong>Direct Labor</strong>: Wages of workers manufacturing the product.</li>
                <li style="margin-bottom: 15px;"><strong>Manufacturing Overhead</strong>: Factory rent, utilities, depreciation.</li>
            </ol>
        </div>
    </div>

    <!-- 5. Classification -->
    <div class="slide" id="slide-5">
        <h2>Classification of Inventory</h2>
        <div class="flex-row" style="margin-top: 30px;">
            <div class="flex-col" style="background: white; padding: 30px; border: var(--border-style);">
                <h3>Merchandising</h3>
                <p>e.g., Target, Walmart.</p>
                <div class="math-box" style="text-align: center;">One Account: Merchandise Inventory</div>
            </div>
            <div class="flex-col" style="background: white; padding: 30px; border: var(--border-style);">
                <h3>Manufacturing</h3>
                <p>e.g., Ford, 3M.</p>
                <div class="math-box" style="text-align: center;">Three Accounts: Raw Materials, WIP, Finished Goods</div>
            </div>
        </div>
    </div>

    <!-- 6. 3M Data -->
    <div class="slide" id="slide-6">
        <h2>3M (Manufacturer) Inventory</h2>
        <table class="data-table">
            <thead><tr><th>($ Millions)</th><th class="num-col">2023</th><th class="num-col">2022</th></tr></thead>
            <tbody>
                <tr><td>Finished Goods</td><td class="num-col">2,293</td><td class="num-col">2,497</td></tr>
                <tr><td>Work in Process</td><td class="num-col">1,424</td><td class="num-col">1,606</td></tr>
                <tr><td>Raw Materials</td><td class="num-col">1,105</td><td class="num-col">1,269</td></tr>
                <tr class="highlight-row"><td><strong>Total</strong></td><td class="num-col"><strong>4,822</strong></td><td class="num-col"><strong>5,372</strong></td></tr>
            </tbody>
        </table>
    </div>

    <!-- 7. Target Data -->
    <div class="slide" id="slide-7">
        <h2>Target (Merchandiser) Inventory</h2>
        <table class="data-table">
            <thead><tr><th>($ Millions)</th><th class="num-col">2024</th><th class="num-col">2023</th></tr></thead>
            <tbody><tr class="highlight-row"><td><strong>Inventory</strong></td><td class="num-col"><strong>11,886</strong></td><td class="num-col"><strong>13,499</strong></td></tr></tbody>
        </table>
    </div>

    <!-- 8. COGS Equation -->
    <div class="slide" id="slide-8">
        <h2>The Cost of Goods Sold Equation</h2>
        <div class="callout" style="text-align:center; font-size:1.6rem; border-color: var(--color-cobalt-core);">
            Beg. Inventory + Purchases = <strong>Goods Available</strong><br><br>
            Goods Available - Ending Inventory = <strong>COGS</strong>
        </div>
    </div>

    <!-- 9. Assumptions (Flip) -->
    <div class="slide" id="slide-9">
        <h2>Cost Flow Assumptions</h2>
        <div class="card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front"><h3>FIFO</h3></div>
                    <div class="flip-card-back"><p>First-In, First-Out</p><p>Oldest costs sold first.</p></div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--color-midnight);"><h3>LIFO</h3></div>
                    <div class="flip-card-back"><p>Last-In, First-Out</p><p>Newest costs sold first.</p></div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--layer-new); color: var(--color-midnight);"><h3>W. Avg</h3></div>
                    <div class="flip-card-back"><p>Weighted Average</p><p>Blended Cost per unit.</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 10. Combined Concepts (Flip) -->
    <div class="slide" id="slide-10">
        <h2>Inventory Costing Concepts</h2>
        <div class="card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front"><h3>FIFO Concept</h3></div>
                    <div class="flip-card-back">
                        <h3>First-In, First-Out</h3>
                        <p>Oldest units sold first.</p>
                        <hr style="width:50%; margin:10px 0; border-top: 1px solid var(--color-cobalt-20);">
                        <p><strong>Ending Inv:</strong> Matches current replacement cost.</p>
                        <p><strong>COGS:</strong> Matches older costs.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--color-midnight);"><h3>LIFO Concept</h3></div>
                    <div class="flip-card-back">
                        <h3>Last-In, First-Out</h3>
                        <p>Newest units sold first.</p>
                        <hr style="width:50%; margin:10px 0; border-top: 1px solid var(--color-cobalt-20);">
                        <p><strong>Ending Inv:</strong> Old, historical costs.</p>
                        <p><strong>COGS:</strong> Current market costs.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--layer-new); color: var(--color-midnight);"><h3>W. Avg Concept</h3></div>
                    <div class="flip-card-back">
                        <h3>Weighted Average</h3>
                        <p>Smoothes price fluctuations.</p>
                        <hr style="width:50%; margin:10px 0; border-top: 1px solid var(--color-cobalt-20);">
                        <p>Cost of Goods Available / Total Units.</p>
                        <p>All units assigned same value.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 11. FIFO Sim -->
    <div class="slide" id="slide-11">
        <h2>FIFO Simulation</h2>
        <div class="callout" style="padding:15px; font-size:1.1rem;">Scenario: 3 Old ($10), 3 Mid ($20), 3 New ($30). Order: 6 Units.</div>
        <div class="sim-wrapper">
            <div class="sim-column"><h3>Source</h3><div class="sim-box" id="fifo-source" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
            <div class="sim-column"><h3>COGS (Oldest)</h3><div class="sim-box" id="fifo-cogs" ondrop="drop(event)" ondragover="allowDrop(event)"></div><div id="fifo-cogs-total" class="mono-data"></div></div>
            <div class="sim-column"><h3>End Inv</h3><div class="sim-box" id="fifo-end"></div><div id="fifo-end-total" class="mono-data"></div></div>
        </div>
        <button class="action-btn" onclick="initSim('fifo')" style="margin-top:10px;">Reset Simulation</button>
    </div>

    <!-- 12. LIFO Sim -->
    <div class="slide" id="slide-12">
        <h2>LIFO Simulation</h2>
        <div class="callout" style="padding:15px; font-size:1.1rem;">Scenario: 3 Old ($10), 3 Mid ($20), 3 New ($30). Order: 6 Units.</div>
        <div class="sim-wrapper">
            <div class="sim-column"><h3>Source</h3><div class="sim-box" id="lifo-source" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
            <div class="sim-column"><h3>COGS (Newest)</h3><div class="sim-box" id="lifo-cogs" ondrop="drop(event)" ondragover="allowDrop(event)"></div><div id="lifo-cogs-total" class="mono-data"></div></div>
            <div class="sim-column"><h3>End Inv</h3><div class="sim-box" id="lifo-end"></div><div id="lifo-end-total" class="mono-data"></div></div>
        </div>
        <button class="action-btn" onclick="initSim('lifo')" style="margin-top:10px;">Reset Simulation</button>
    </div>

    <!-- 13. W-Avg Sim -->
    <div class="slide" id="slide-13">
        <h2>Weighted Avg Simulation</h2>
        <div class="callout" style="padding:15px; font-size:1.1rem;">Scenario: 3 Old ($10), 3 Mid ($20), 3 New ($30). Order: 6 Units.</div>
        <button class="action-btn" onclick="calcWAvg()">Calculate Average</button>
        <div id="wavg-explainer" style="display:none; margin:10px 0; background:#fff; border:1px solid var(--color-cobalt-core); padding:10px; font-family:'JetBrains Mono'; color: var(--color-cobalt-core); font-size: 1.1rem;">
            (3×$10 + 3×$20 + 3×$30) / 9 Units = $180 / 9 = <strong>$20 per Unit</strong>
        </div>
        <div class="sim-wrapper">
            <div class="sim-column"><h3>Source</h3><div class="sim-box" id="wavg-source" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
            <div class="sim-column"><h3>COGS</h3><div class="sim-box" id="wavg-cogs" ondrop="drop(event)" ondragover="allowDrop(event)"></div><div id="wavg-cogs-total" class="mono-data"></div></div>
            <div class="sim-column"><h3>End Inv</h3><div class="sim-box" id="wavg-end"></div><div id="wavg-end-total" class="mono-data"></div></div>
        </div>
        <button class="action-btn" onclick="initSim('wavg')" style="margin-top:10px;">Reset Simulation</button>
    </div>

    <!-- 14. Income Statement Effects -->
    <div class="slide" id="slide-14">
        <h2>Income Statement Effects (Example)</h2>
        <p>Assume Sales = $150. Inflationary Environment.</p>
        <table class="data-table">
            <thead><tr><th>Method</th><th>Sales</th><th>COGS</th><th>Gross Profit</th></tr></thead>
            <tbody>
                <tr><td>FIFO</td><td>$150</td><td>$30 (Low)</td><td>$120 (High)</td></tr>
                <tr><td>LIFO</td><td>$150</td><td>$90 (High)</td><td>$60 (Low)</td></tr>
                <tr><td>W. Avg</td><td>$150</td><td>$60 (Mid)</td><td>$90 (Mid)</td></tr>
            </tbody>
        </table>
    </div>

    <!-- 15. Balance Sheet Effects -->
    <div class="slide" id="slide-15">
        <h2>Balance Sheet Effects</h2>
        <table class="data-table">
            <thead><tr><th>Method</th><th>Ending Inventory Balance</th></tr></thead>
            <tbody>
                <tr><td>FIFO</td><td>$150 (Current Cost)</td></tr>
                <tr><td>LIFO</td><td>$90 (Old Cost)</td></tr>
                <tr><td>W. Avg</td><td>$120 (Blended Cost)</td></tr>
            </tbody>
        </table>
        <p class="warning" style="margin-top: 20px;">LIFO balance sheets do not represent replacement cost.</p>
    </div>

    <!-- 16. Inflation/Deflation Effects (Interactive SVG) -->
    <div class="slide" id="slide-16">
        <h2>Impact of Price Changes</h2>
        <div style="display:flex; justify-content:center; align-items:center; flex-direction:column; background:white; border: var(--border-style); padding:30px;">
            <div style="margin-bottom:15px;">
                <button class="action-btn" onclick="togglePriceTrend()">Switch Scenario (Currently: <span id="trend-label">Inflation</span>)</button>
            </div>
            <svg id="price-graph" width="600" height="350" viewBox="0 0 600 350">
                <!-- Axes -->
                <line x1="50" y1="300" x2="550" y2="300" stroke="#041330" stroke-width="2" />
                <line x1="50" y1="300" x2="50" y2="50" stroke="#041330" stroke-width="2" />
                <text x="560" y="305" font-family="Inter" font-size="14">Time</text>
                <text x="20" y="40" font-family="Inter" font-size="14">Cost ($)</text>

                <!-- Line (Dynamic) -->
                <line id="trend-line" x1="50" y1="300" x2="550" y2="50" stroke="#265cff" stroke-width="4" />

                <!-- FIFO Circle (Dynamic) -->
                <circle id="fifo-circle" cx="100" cy="275" r="45" stroke="#cc5de8" stroke-width="3" stroke-dasharray="5,5" fill="rgba(204, 93, 232, 0.1)" />
                <text id="fifo-label" x="100" y="275" text-anchor="middle" dominant-baseline="middle" font-family="Inter" font-size="12" font-weight="bold">FIFO (COGS)</text>
                <text id="fifo-sub" x="100" y="290" text-anchor="middle" dominant-baseline="middle" font-family="Inter" font-size="10">(Older Cost)</text>

                <!-- LIFO Circle (Dynamic) -->
                <circle id="lifo-circle" cx="500" cy="75" r="45" stroke="#27ae60" stroke-width="3" stroke-dasharray="5,5" fill="rgba(39,174,96,0.1)" />
                <text id="lifo-label" x="500" y="75" text-anchor="middle" dominant-baseline="middle" font-family="Inter" font-size="12" font-weight="bold">LIFO (COGS)</text>
                <text id="lifo-sub" x="500" y="90" text-anchor="middle" dominant-baseline="middle" font-family="Inter" font-size="10">(Newer Cost)</text>
            </svg>
        </div>
        <p id="trend-desc" style="text-align:center; margin-top:15px; font-family: 'JetBrains Mono';"><strong>Inflation:</strong> FIFO uses older (lower) costs. LIFO uses newer (higher) costs.</p>
    </div>

    <!-- 17-19 Polls -->
    <div class="slide" id="slide-17">
        <h2>Poll Q1</h2>
        <div class="poll-question">In inflation, highest Ending Inventory?</div>
        <div class="poll-option" onclick="revealPoll(this, 'Correct! FIFO.')">FIFO</div>
        <div class="poll-option" onclick="revealPoll(this, 'Incorrect.')">LIFO</div>
        <div class="poll-reveal"></div>
    </div>
    <div class="slide" id="slide-18">
        <h2>Poll Q2</h2>
        <div class="poll-question">Under FIFO, ending inventory is...</div>
        <div class="poll-option" onclick="revealPoll(this, 'Correct!')">Recent purchases</div>
        <div class="poll-option" onclick="revealPoll(this, 'Incorrect.')">Oldest purchases</div>
        <div class="poll-reveal"></div>
    </div>
    <div class="slide" id="slide-19">
        <h2>Poll Q3</h2>
        <div class="poll-question">In inflation, highest COGS?</div>
        <div class="poll-option" onclick="revealPoll(this, 'Incorrect.')">FIFO</div>
        <div class="poll-option" onclick="revealPoll(this, 'Correct!')">LIFO</div>
        <div class="poll-reveal"></div>
    </div>

    <!-- 20. LCM Rule -->
    <div class="slide" id="slide-20">
        <h2>Lower of Cost or Market (LCM)</h2>
        <div class="card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front"><h3>What is LCM?</h3></div>
                    <div class="flip-card-back">
                        <h3>Rule</h3>
                        <p>Inventory reported at lower of:</p>
                        <ul style="text-align:left;"><li>Historical Cost</li><li>Market Value</li></ul>
                        <p>Standard: U.S. GAAP</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background:var(--color-midnight);"><h3>Why?</h3></div>
                    <div class="flip-card-back">
                        <h3>Conservatism</h3>
                        <p>Do not overstate assets.</p>
                        <p>Do not overstate income.</p>
                        <p>Recognize losses immediately when value drops.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background:var(--color-error); border:none;"><h3>"Market" Def.</h3></div>
                    <div class="flip-card-back">
                        <p><strong>Market = Replacement Cost</strong></p>
                        <hr style="width: 50%; border-top: 1px solid var(--color-cobalt-20); margin: 10px 0;">
                        <p style="font-size:1rem;">Subject to Ceiling/Floor:</p>
                        <p style="font-size:1rem;">Ceiling = NRV</p>
                        <p style="font-size:1rem;">Floor = NRV - Profit</p>
                        <p style="font-size:0.9rem;">NRV = Selling Price - Costs</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 21. LCM Example (FSET) -->
    <div class="slide" id="slide-21">
        <h2>LCM Example Effect</h2>
        <p>Cost $100, NRV $97. Write-down $3.</p>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-minus">Inv -3</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-minus">-3</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+3</span></td>
                    <td><span class="val-minus">-3</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 22. LIFO Reserve -->
    <div class="slide" id="slide-22">
        <h2>The LIFO Reserve</h2>
        <div class="flex-row">
            <div class="flex-col">
                <div class="callout"><p class="mono-data">FIFO Inv = LIFO Inv + LIFO Reserve</p></div>
                <p><strong>Answers:</strong> "How much higher would inventory be if the company used FIFO?"</p>
            </div>
            <div class="flex-col" style="background:white; padding:30px; border: var(--border-style);">
                <h3>Where is it?</h3>
                <p>Footnotes (Inventory Note).</p>
                <h3>Aliases:</h3>
                <ul class="custom-list"><li>LIFO Allowance</li><li>LIFO Adjustment</li></ul>
                <p class="warning" style="margin-top: 20px;">Disclosure only. Not a separate Balance Sheet line item.</p>
            </div>
        </div>
    </div>

    <!-- 23. Tax Savings -->
    <div class="slide" id="slide-23">
        <h2>Tax Savings Calculation</h2>
        <p><strong>Why?</strong> LIFO reports higher COGS in inflation → Lower Taxable Income.</p>
        <div class="callout">
            <h3>Formula:</h3>
            <p class="mono-data" style="font-size:1.8rem;">Cumulative Tax Savings = LIFO Reserve × Tax Rate</p>
        </div>
        <p>This represents <strong>real cash</strong> the company has retained rather than paying to the IRS.</p>
    </div>

    <!-- 24. LIFO Liquidation Concept (Flip Card) -->
    <div class="slide" id="slide-24">
        <h2>LIFO Liquidation</h2>
        <div class="card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')" style="width:550px; height:350px;">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background:var(--color-error); border:none;">
                        <h3>Consequence of LIFO Liquidation?</h3>
                        <p style="color:white; font-size:1.1rem;">(Click to Reveal)</p>
                    </div>
                    <div class="flip-card-back">
                        <p>Selling older, cheaper inventory layers...</p>
                        <h3 class="warning">Result: Artificially High Income & High Taxes</h3>
                        <p>Distorts financial statements by matching old costs with current revenues.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 25. LIFO Liquidation Sim (Persistent Table) -->
    <div class="slide" id="slide-25">
        <h2>LIFO Liquidation Scenario</h2>
        <div class="flex-row">
            <div class="flex-col" style="flex:0.4;">
                <div class="callout">
                    <h3>Scenario:</h3>
                    <p><strong>Order:</strong> 3 Units.</p>
                    <p><strong>Price:</strong> $20/unit.</p>
                    <p><strong>Current Cost:</strong> $10.</p>
                    <p><strong>Old Cost:</strong> $1.</p>
                    <p><strong>Tax:</strong> 21%.</p>
                </div>
            </div>
            <div class="flex-col">
                <div class="sim-wrapper" style="height:250px; margin-top:0;">
                    <div class="sim-column"><h3>Warehouse</h3><div class="sim-box" id="liq-source" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
                    <div class="sim-column"><h3>COGS</h3><div class="sim-box" id="liq-cogs" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
                </div>
                <div style="margin:10px 0; display:flex; gap:10px; justify-content:center;">
                    <button class="action-btn" onclick="liqRestock()">A: Restock ($10)</button>
                    <button class="action-btn danger" onclick="liqNoStock()">B: Liquidate ($1)</button>
                    <button class="action-btn" onclick="resetDraggables()" style="border-color:#ccc; color:#666;">Reset</button>
                </div>
                
                <!-- Interactive Comparison Table -->
                <table class="data-table" style="font-size:1rem; margin-top:0;">
                    <thead><tr><th>Metric</th><th id="col-a">Scenario A</th><th id="col-b">Scenario B</th></tr></thead>
                    <tbody>
                        <tr class="compare-row"><td>COGS</td><td id="res-a-cogs">-</td><td id="res-b-cogs">-</td></tr>
                        <tr class="compare-row"><td>Gross Profit</td><td id="res-a-gp">-</td><td id="res-b-gp">-</td></tr>
                        <tr class="compare-row"><td>Tax Bill</td><td id="res-a-tax">-</td><td id="res-b-tax">-</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 26. Poll Q4 -->
    <div class="slide" id="slide-26">
        <h2>Poll Q4</h2>
        <div class="poll-question">LIFO Liquidation results in:</div>
        <div class="poll-option" onclick="revealPoll(this, 'Correct! Old costs = High Profit.')">Higher Net Income</div>
        <div class="poll-option" onclick="revealPoll(this, 'Incorrect.')">Lower Taxes</div>
        <div class="poll-reveal"></div>
    </div>

    <!-- 27. Comparability (Financial Statement Snippets) -->
    <div class="slide" id="slide-27">
        <h2>Comparability: CAT vs Kubota</h2>
        <div class="flex-row">
            <div class="flex-col">
                <div class="fs-container">
                    <div class="fs-header">Caterpillar Inc. (US GAAP)</div>
                    <div class="fs-subheader">Consolidated Statement of Financial Position</div>
                    <div class="fs-row"><span>Assets</span></div>
                    <div class="fs-row"><span>...</span></div>
                    <div class="fs-row"><span>Inventories</span><strong>$16,270</strong></div>
                    <div class="fs-row"><span>...</span></div>
                    <div class="fs-note">
                        Note 1: Inventories are stated at the lower of cost or market. Cost is principally determined using the <strong>LIFO</strong> method.
                    </div>
                    <div style="margin-top:10px; color:var(--color-error); font-weight:bold; font-family:'JetBrains Mono';">
                        LIFO Reserve: $3,321
                    </div>
                </div>
            </div>
            <div class="flex-col">
                <div class="fs-container">
                    <div class="fs-header">Kubota Corp. (IFRS/GAAP)</div>
                    <div class="fs-subheader">Consolidated Statement of Financial Position</div>
                    <div class="fs-row"><span>Assets</span></div>
                    <div class="fs-row"><span>...</span></div>
                    <div class="fs-row"><span>Inventories</span><strong>¥644,471</strong></div>
                    <div class="fs-row"><span>...</span></div>
                    <div class="fs-note">
                        Note: Inventories are stated at the lower of cost or net realizable value. Cost is determined using the <strong>weighted-average</strong> method.
                    </div>
                </div>
            </div>
        </div>
        <p style="margin-top:20px; text-align:center;" class="highlight">To compare these companies, we must adjust Caterpillar's LIFO inventory to FIFO.</p>
    </div>

    <!-- 28. BS Step 1 -->
    <div class="slide" id="slide-28">
        <h2>BS Adjustment Step 1: Inventory</h2>
        <p>For example, to adjust CAT’s 2022 balance sheet from LIFO to FIFO:</p>
        <p>Increase Inventory by <strong>$3,321 M</strong> (add the LIFO reserve).</p>
        <div class="callout">
            <p class="mono-data">16,270 (LIFO Inventory) + 3,321 (LIFO Reserve) = 19,591 (FIFO Inventory)</p>
        </div>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+3,321</span></td>
                    <td><span class="val-neutral">?</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">?</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 29. BS Step 2 -->
    <div class="slide" id="slide-29">
        <h2>BS Adjustment Step 2: Taxes</h2>
        <p>Increase tax liabilities (Deferred Tax Liability) by the tax effect on the reserve.</p>
        <div class="callout">
            <p class="mono-data">$3,321 M × 21% = $697.41 M</p>
        </div>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+3,321</span></td>
                    <td><span class="val-plus">+697.41</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">?</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 30. BS Step 3 -->
    <div class="slide" id="slide-30">
        <h2>BS Adjustment Step 3: Equity</h2>
        <p>Increase Retained Earnings by the difference (Net of Tax).</p>
        <div class="callout">
            <p class="mono-data">$3,321 M − $697.41 M = $2,623.59 M</p>
        </div>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+3,321</span></td>
                    <td><span class="val-plus">+697.41</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+2,623.59</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 31. CAT Data Summary -->
    <div class="slide" id="slide-31">
        <h2>Caterpillar LIFO Data Summary</h2>
        <table class="data-table">
            <tr><td>Inventories (LIFO)</td><td class="num-col">$16,270 M</td></tr>
            <tr><td>LIFO Reserve</td><td class="num-col">3,321 M</td></tr>
            <tr class="highlight-row"><td><strong>FIFO Value</strong></td><td class="num-col"><strong>$19,591 M</strong></td></tr>
        </table>
    </div>

    <!-- 32. IS Adjustment Step 1 -->
    <div class="slide" id="slide-32">
        <h2>IS Adjustment Step 1: COGS</h2>
        <p>Goal: Adjust Net Income from LIFO to FIFO.</p>
        <p>Reduce COGS by the <strong>Change</strong> in LIFO Reserve ($722 M).</p>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+722</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">?</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-minus">COGS -722</span></td>
                    <td><span class="val-plus">+722</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 33. IS Adjustment Step 2 -->
    <div class="slide" id="slide-33">
        <h2>IS Adjustment Step 2: Taxes</h2>
        <p>Increase Tax Expense by Tax Rate ($722 * 21% = $151.6 M).</p>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+722</span></td>
                    <td><span class="val-plus">+151.6</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-neutral">?</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-minus">COGS -722</span><br><span class="val-plus">Tax +151.6</span></td>
                    <td><span class="val-plus">Pre-Tax +722</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 34. IS Adjustment Step 3 -->
    <div class="slide" id="slide-34">
        <h2>IS Adjustment Step 3: Net Income</h2>
        <p>Final Adjustment to Retained Earnings / Net Income.</p>
        <p>$722 - $151.6 = <strong>$570.4 M Increase</strong></p>
        <table class="fse-dark">
            <thead>
                <tr><th colspan="5">Balance Sheet</th><th colspan="3" class="fse-border-left">Income Statement</th></tr>
                <tr class="fse-header-orange">
                    <th>Cash Asset</th><th>Noncash Assets</th><th>Liabilities</th><th>Contrib. Cap.</th><th>Earned Cap.</th>
                    <th class="fse-border-left">Revenue</th><th>Expenses</th><th>Net Income</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+722</span></td>
                    <td><span class="val-plus">+151.6</span></td>
                    <td><span class="val-neutral">-</span></td>
                    <td><span class="val-plus">+570.4</span></td>
                    <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    <td><span class="val-minus">Total Exp -570.4</span></td>
                    <td><span class="val-plus">+570.4</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 35. Ratios with Interpretation -->
    <div class="slide" id="slide-35">
        <h2>Inventory Ratios Calculator</h2>
        <div class="flex-row">
            <div class="flex-col">
                <div class="formula-card">
                    <h3>Calculator</h3>
                    <div style="margin:10px 0;">
                        <label>COGS ($): </label><input type="number" id="inp-cogs" value="600000" style="width:100%; padding:8px; border:1px solid #ccc;">
                    </div>
                    <div style="margin:10px 0;">
                        <label>Avg Inv ($): </label><input type="number" id="inp-inv" value="100000" style="width:100%; padding:8px; border:1px solid #ccc;">
                    </div>
                    <button class="action-btn" onclick="calcRatios()">Calculate</button>
                    <div id="ratio-results" style="margin-top:20px; font-family:'JetBrains Mono'; font-weight:bold; color:var(--color-cobalt-core);"></div>
                    <div id="ratio-interpret" style="margin-top:10px; font-size:1.1rem; color:#64748b; background:var(--color-newday); padding:10px; display:none; border-left:2px solid var(--color-cobalt-core);"></div>
                </div>
            </div>
            <div class="flex-col">
                <div class="formula-card">
                    <h3>Formulas</h3>
                    <p><strong>Turnover</strong> = COGS / Avg Inv</p>
                    <p><strong>DIO</strong> = 365 / Turnover</p>
                    <p class="highlight">Lower DIO = Faster Sales</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 36. Pfizer DIO (Flip Card) -->
    <div class="slide" id="slide-36">
        <h2>Pfizer Analysis: High DIO</h2>
        <div class="card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background:var(--color-midnight);">
                        <h1 style="font-size:5rem; color:white; margin:0;">95.8</h1>
                        <p style="color:white; font-family:'JetBrains Mono';">Days Inventory Outstanding</p>
                        <p style="color:#64748b; font-size:1rem;">(Click to see why)</p>
                    </div>
                    <div class="flip-card-back">
                        <h3>Why so high?</h3>
                        <ul style="text-align:left; padding-left: 20px;">
                            <li><strong>Complexity:</strong> Biological batches take months.</li>
                            <li><strong>QA:</strong> Mandatory quarantine periods.</li>
                            <li><strong>Safety:</strong> Critical meds cannot run out.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 37. Cash Flow Impact (Fixed Text) -->
    <div class="slide" id="slide-37">
        <h2>How much cash savings by reducing days in inventory outstanding by 1 day.</h2>
        <div class="formula-card" style="text-align: center;">
            <h3>Calculator</h3>
            <div style="margin:20px 0;">
                <label>Annual COGS ($ Millions): </label>
                <input type="number" id="inp-cf-cogs" value="36500" style="width:100%; max-width: 300px; padding:10px; font-size:1.4rem; border: 1px solid #ccc; text-align: center;">
            </div>
            <button class="action-btn success" onclick="calcCashFlow()">Calculate Impact</button>
            <div id="cf-result" class="callout" style="margin-top:20px; font-size:1.8rem; font-weight:bold; font-family: 'JetBrains Mono';">
                Value of 1 Day = $100.00 Million
            </div>
        </div>
        <p style="font-size:1.1rem; text-align:center; margin-top: 15px;">Formula: Annual COGS / 365</p>
    </div>

    <!-- 38-39 Polls -->
    <div class="slide" id="slide-38">
        <h2>Poll Q5</h2>
        <div class="poll-question">Lower DIO generally means more cash available for R&D?</div>
        <div class="poll-option" onclick="revealPoll(this, 'Correct!')">True</div>
        <div class="poll-option" onclick="revealPoll(this, 'Incorrect.')">False</div>
        <div class="poll-reveal"></div>
    </div>
    <div class="slide" id="slide-39">
        <h2>Poll Q6</h2>
        <div class="poll-question">Why might DIO increase legitimately?</div>
        <div class="poll-option" onclick="revealPoll(this, 'Correct! Strategic stockpiling.')">Expecting supply chain shortage</div>
        <div class="poll-option" onclick="revealPoll(this, 'Incorrect.')">Sales are booming</div>
        <div class="poll-reveal"></div>
    </div>

    <!-- 40. DPO -->
    <div class="slide" id="slide-40">
        <h2>Days Payable Outstanding (DPO)</h2>
        <div class="callout">
            <h3>DPO Formula</h3>
            <div class="math-box">DPO = 365 / (COGS / Avg Accounts Payable)</div>
        </div>
        <p>This measures how long a company takes to pay its suppliers.</p>
        <p><strong>Strategy:</strong> Companies want to <em>extend</em> DPO (hold cash longer) without angering suppliers.</p>
    </div>

    <!-- 41. CCC Formula -->
    <div class="slide" id="slide-41">
        <h2>Cash Conversion Cycle (CCC)</h2>
        <div class="callout" style="text-align: center;">
            <h3>DIO + DSO - DPO = CCC</h3>
        </div>
        <ul>
            <li><strong>DIO:</strong> Days Inventory Outstanding (How long stock sits).</li>
            <li><strong>DSO:</strong> Days Sales Outstanding (How long to collect cash from customers).</li>
            <li><strong>DPO:</strong> Days Payable Outstanding (How long to pay suppliers).</li>
        </ul>
        <p>The number of days a company's cash is tied up in operations.</p>
    </div>

    <!-- 42. CCC Visualization (INTERACTIVE) -->
    <div class="slide" id="slide-42">
        <h2>Interactive CCC Visualizer</h2>
        <div class="slider-container">
            <div class="slider-group"><label>DIO: <span id="val-dio">60</span></label><input type="range" min="10" max="150" value="60" oninput="updateCCC()"></div>
            <div class="slider-group"><label>DSO: <span id="val-dso">40</span></label><input type="range" min="10" max="100" value="40" oninput="updateCCC()"></div>
            <div class="slider-group"><label>DPO: <span id="val-dpo">50</span></label><input type="range" min="10" max="150" value="50" oninput="updateCCC()"></div>
        </div>
        <div class="timeline-container">
            <div class="tl-bar tl-dio" id="bar-dio" style="width: 120px; left: 20px;">DIO</div>
            <div class="tl-bar tl-dso" id="bar-dso" style="width: 80px; left: 140px;">DSO</div>
            <div class="tl-bar tl-dpo" id="bar-dpo" style="width: 100px; left: 20px;">DPO</div>
            <div class="tl-ccc-line" id="line-ccc"></div>
            <div class="tl-label" id="label-ccc" style="top:220px; font-weight:bold; color:var(--color-cobalt-core);">CCC = 50 Days</div>
        </div>
    </div>

    <!-- 43. Poll Q7 -->
    <div class="slide" id="slide-43">
        <h2>Poll Q7</h2>
        <div class="poll-question">Calculate CCC given:</div>
        <ul style="list-style: none; margin-bottom: 20px;">
            <li>Days Inventory Outstanding = 60</li>
            <li>Days Sales Outstanding = 35</li>
            <li>Days Payable Outstanding = 40</li>
        </ul>
        <div style="background: white; border: 1px solid var(--color-cobalt-20); padding: 15px; margin: 10px 0; cursor: pointer; font-size: 1.2rem;" onclick="revealPoll(this, 'Correct! 60 + 35 - 40 = 55.')">Click to Reveal Answer</div>
        <div class="poll-reveal"></div>
    </div>

    <!-- 44. Case Study -->
    <div class="slide" id="slide-44">
        <h2>Case Study: First Brands</h2>
        <div class="callout" style="border-left-color: var(--color-error);">
            <h3 style="color:var(--color-error);">The Discrepancy</h3>
            <p><strong>Public Claim:</strong> First Brands told lenders it had <strong>$5.9 Billion</strong> in debt.</p>
            <p><strong>The Reality:</strong> The bankruptcy filing revealed <strong>over $8 Billion</strong> in secured obligations.</p>
        </div>
        <p>How did they hide over $2 Billion? They used <strong>Inventory Factoring</strong> via Special Purpose Entities (SPEs).</p>
    </div>

    <!-- 45. Factoring -->
    <div class="slide" id="slide-45">
        <h2>What is Inventory Factoring?</h2>
        <p>A mechanism to raise cash by selling or pledging inventory to a financier.</p>
        <div class="flex-row" style="margin-top: 30px;">
            <div class="flex-col" style="background:white; padding:30px; border: var(--border-style);">
                <h3>The Mechanism</h3>
                <ul class="custom-list">
                    <li>Financier advances cash (e.g., 70–90% of inventory value).</li>
                    <li>Often done through off-balance sheet <strong>SPEs</strong>.</li>
                </ul>
            </div>
            <div class="flex-col" style="background:white; padding:30px; border: var(--border-style);">
                <h3>Two Structures</h3>
                <ol style="padding-left: 20px;">
                    <li style="margin-bottom: 10px;"><strong>True Sale:</strong> Inventory removed from books. (Off Balance Sheet)</li>
                    <li><strong>Financing:</strong> Loan secured by inventory. (On Balance Sheet)</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- 46. Recorded Gimmick (Note Added) -->
    <div class="slide" id="slide-46">
        <h2>What They RECORDED (The Gimmick)</h2>
        <p style="text-align:center; color:var(--color-error); font-weight:bold; font-family:'JetBrains Mono';">Note: Debt sits only at SPE, which isn’t consolidated.</p>
        <div style="transform:scale(0.9); transform-origin: top center;">
            <h3>For First Brands ("Sale")</h3>
            <table class="fse-dark" style="margin-top:5px;">
                <thead>
                    <tr class="fse-header-orange"><th>Cash</th><th>Inv</th><th>Liab</th><th>Equity</th><th class="fse-border-left">Inc</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="val-plus">+9k</span></td>
                        <td><span class="val-minus">-10k</span></td>
                        <td><span class="val-neutral">0</span></td>
                        <td><span class="val-minus">-1k (Loss)</span></td>
                        <td class="fse-border-left"><span class="val-minus">-1k</span></td>
                    </tr>
                </tbody>
            </table>
            
            <h3 style="margin-top:20px;">For SPE ("Purchase")</h3>
            <table class="fse-dark" style="margin-top:5px;">
                <thead>
                    <tr class="fse-header-orange"><th>Cash</th><th>Inv</th><th>Liab</th><th>Equity</th><th class="fse-border-left">Inc</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="val-neutral">-</span></td>
                        <td><span class="val-plus">+10k</span></td>
                        <td><span class="val-plus">+9k</span></td>
                        <td><span class="val-plus">+1k (Plug)</span></td>
                        <td class="fse-border-left"><span class="val-neutral">-</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 47. Correct Way (Elimination Slash) -->
    <div class="slide" id="slide-47">
        <h2>The CORRECT Way (Secured Borrowing)</h2>
        <button class="action-btn" onclick="performConsolidation()" style="margin-bottom:10px;">Perform Consolidation</button>
        <div style="transform:scale(0.9); transform-origin: top center;">
            <h3>For First Brands ("Borrowing")</h3>
            <table class="fse-dark" style="margin-top:5px;">
                <thead>
                    <tr class="fse-header-orange"><th>Cash</th><th>Inv</th><th>Liab (Loan)</th><th>Equity</th><th class="fse-border-left">Inc</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="val-plus">+9k</span></td>
                        <td><span class="val-neutral">0</span></td>
                        <td id="elim-fb-lia"><span class="val-plus">+9k</span></td>
                        <td><span class="val-neutral">0</span></td>
                        <td class="fse-border-left"><span class="val-neutral">0</span></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top:20px;">For SPE ("Lending")</h3>
            <table class="fse-dark" style="margin-top:5px;">
                <thead>
                    <tr class="fse-header-orange"><th>Cash</th><th>Due from FB</th><th>Liab</th><th>Equity</th><th class="fse-border-left">Inc</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="val-neutral">-</span></td>
                        <td id="elim-spe-asset"><span class="val-plus">+9k</span></td>
                        <td><span class="val-plus">+9k</span></td>
                        <td><span class="val-neutral">0</span></td>
                        <td class="fse-border-left"><span class="val-neutral">0</span></td>
                    </tr>
                </tbody>
            </table>
            <p style="text-align:center; font-size:1.1rem; margin-top:10px; font-family:'JetBrains Mono'; color:#64748b;">Consolidated: Eliminate "Due from FB" ↔ "Loan Due to SPE". Inventory remains on FB books.</p>
        </div>
    </div>

    <!-- 48. Summary -->
    <div class="slide" id="slide-48">
        <h2>Module Summary</h2>
        <p style="text-align:center; color:var(--color-cobalt-core);">Click the box below to reveal key takeaways.</p>
        <div id="summary-container" style="cursor:pointer; min-height:400px; border: 1px dashed var(--color-cobalt-core); padding: 20px; background: white;" onclick="revealNextSummary()">
            <div class="summary-item"><strong>FIFO vs LIFO:</strong> LIFO reduces taxes in inflation but distorts the Balance Sheet.</div>
            <div class="summary-item"><strong>LIFO Reserve:</strong> The key to comparing LIFO companies to FIFO companies.</div>
            <div class="summary-item"><strong>Inventory Ratios:</strong> High Turnover / Low DIO is usually good, but context (Industry) is king.</div>
            <div class="summary-item"><strong>Cash Conversion Cycle:</strong> The "Cash Gap". DIO + DSO - DPO.</div>
            <div class="summary-item"><strong>Red Flags:</strong> Hidden debt (Factoring), Rising DIO without sales growth.</div>
            <div class="summary-item"><strong>LCM:</strong> Conservative write-downs protect against overstating assets.</div>
            <div style="text-align:center; color:#ccc; margin-top:20px; font-family:'JetBrains Mono';">(End of Summary)</div>
        </div>
    </div>

    <!-- 49. Quiz -->
    <div class="slide" id="slide-49">
        <h2>Final Quiz (10 Questions)</h2>
        <div class="quiz-container">
            <div id="quiz-question" class="poll-question"></div>
            <div id="quiz-options"></div>
            <div id="quiz-feedback" class="poll-reveal"></div>
            <div style="display:flex; justify-content:space-between; margin-top:20px;">
                <span id="quiz-progress" style="font-weight:bold; padding-top:10px; font-family:'JetBrains Mono';">1 / 10</span>
                <button class="nav-btn" onclick="nextQuestion()">Next</button>
            </div>
        </div>
    </div>

    <div id="controls">
        <div id="progress-bar"></div>
        <div>
            <button class="nav-btn" onclick="prevSlide()">Prev</button>
            <span id="slide-counter" style="margin: 0 20px; font-weight:600; font-family:'JetBrains Mono';">1 / 49</span>
            <button class="nav-btn" onclick="nextSlide()">Next</button>
        </div>
    </div>

</div>

<script>
    let currentSlideIndex = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;
    
    /* --- NEW MENU LOGIC --- */
    function toggleMenu() {
        const sidebar = document.getElementById('toc-sidebar');
        sidebar.classList.toggle('open');
        
        // Scroll to active item when opening
        if (sidebar.classList.contains('open')) {
            const activeToc = document.getElementById(`toc-item-${currentSlideIndex}`);
            if(activeToc) {
                setTimeout(() => {
                    activeToc.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 300); // Wait for transition
            }
        }
    }

    function generateTOC() {
        const tocList = document.getElementById('toc-list');
        const sections = [
            { start: 0, title: "Module Start" },
            { start: 2, title: "Fundamentals" },
            { start: 10, title: "Simulations" },
            { start: 16, title: "Analysis & Metrics" },
            { start: 26, title: "Adjustments (LIFO/FIFO)" },
            { start: 35, title: "Ratios & CCC" },
            { start: 44, title: "Case Studies" },
            { start: 48, title: "Summary & Quiz" }
        ];

        slides.forEach((slide, index) => {
            // Find header for title
            let title = slide.querySelector('h1, h2')?.innerText || `Slide ${index + 1}`;
            // Cleanup title if too long
            if(title.length > 35) title = title.substring(0, 35) + "...";
            
            // Check for section headers
            const section = sections.find(s => s.start === index);
            if(section) {
                const secHeader = document.createElement('div');
                secHeader.className = 'toc-section-header';
                secHeader.innerText = section.title;
                tocList.appendChild(secHeader);
            }

            const item = document.createElement('div');
            item.className = 'toc-item';
            item.innerText = `${index + 1}. ${title}`;
            item.onclick = () => {
                currentSlideIndex = index;
                updateUI();
                toggleMenu();
            };
            item.id = `toc-item-${index}`;
            tocList.appendChild(item);
        });
    }

    /* --- Existing Logic --- */
    function updateUI() {
        slides.forEach(s => s.classList.remove('active'));
        slides[currentSlideIndex].classList.add('active');
        document.getElementById('slide-counter').innerText = `${currentSlideIndex + 1} / ${totalSlides}`;
        document.getElementById('progress-bar').style.width = `${((currentSlideIndex + 1) / totalSlides) * 100}%`;
        
        // Highlight active TOC item
        document.querySelectorAll('.toc-item').forEach(el => el.classList.remove('active'));
        const activeToc = document.getElementById(`toc-item-${currentSlideIndex}`);
        if(activeToc) {
            activeToc.classList.add('active');
            
            // FIX: Only scroll sidebar if it is open to prevent forcing the container to scroll
            const sidebar = document.getElementById('toc-sidebar');
            if(sidebar.classList.contains('open')) {
                activeToc.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Triggers
        const id = slides[currentSlideIndex].id;
        if(id === 'slide-11') initSim('fifo');
        if(id === 'slide-12') initSim('lifo');
        if(id === 'slide-13') initSim('wavg');
        if(id === 'slide-25') { 
            // Only init if empty (preserve state on navigation return)
            if(document.getElementById('col-a').innerText === 'Scenario A') {
               // Initial state logic if needed
            } 
            initLiqSim(false); // false = don't clear table
        }
        if(id === 'slide-42') updateCCC();
        if(id === 'slide-49' && quizIdx === 0) loadQuestion();
    }

    function nextSlide() { if(currentSlideIndex < totalSlides - 1) { currentSlideIndex++; updateUI(); } }
    function prevSlide() { if(currentSlideIndex > 0) { currentSlideIndex--; updateUI(); } }
    document.addEventListener('keydown', (e) => { if(e.key === 'ArrowRight') nextSlide(); if(e.key === 'ArrowLeft') prevSlide(); });

    /* Simulation Engine */
    const rawBatches = [{id:1,c:10,t:'old'},{id:2,c:10,t:'old'},{id:3,c:10,t:'old'},{id:4,c:20,t:'mid'},{id:5,c:20,t:'mid'},{id:6,c:20,t:'mid'},{id:7,c:30,t:'new'},{id:8,c:30,t:'new'},{id:9,c:30,t:'new'}];
    function initSim(m) {
        const s = document.getElementById(m+'-source'), c = document.getElementById(m+'-cogs'), e = document.getElementById(m+'-end');
        if(!s) return; s.innerHTML=''; c.innerHTML=''; e.innerHTML='';
        rawBatches.forEach(b => {
            const d = document.createElement('div'); d.className=`inv-block cost-${b.t}`; d.draggable=true;
            d.innerHTML=`#${b.id} $${b.c}`; d.id=`${m}-${b.id}`; d.dataset.c=b.c;
            d.ondragstart=ev=>{ev.dataTransfer.setData("id",ev.target.id);ev.dataTransfer.setData("c",b.c);};
            s.appendChild(d);
        });
        updateT(m);
        if(m==='wavg') document.getElementById('wavg-explainer').style.display='none';
    }
    function allowDrop(ev){ev.preventDefault();}
    function drop(ev){
        ev.preventDefault();
        const id=ev.dataTransfer.getData("id"); const el=document.getElementById(id);
        if(el && ev.target.closest('.sim-box')) {
            ev.target.closest('.sim-box').appendChild(el);
            const m = id.split('-')[0];
            if(m !== 'liq') {
                const cogs = document.getElementById(m+'-cogs');
                if(cogs.children.length===6) {
                    const s = document.getElementById(m+'-source'), e = document.getElementById(m+'-end');
                    while(s.children.length>0) e.appendChild(s.children[0]);
                }
                updateT(m);
            } else {
                checkLiqResult();
            }
        }
    }
    function updateT(m){
        let tc=0; document.querySelectorAll(`#${m}-cogs .inv-block`).forEach(d=>tc+=parseFloat(d.dataset.c));
        document.getElementById(m+'-cogs-total').innerText = `$${tc}`;
        let te=0; document.querySelectorAll(`#${m}-end .inv-block`).forEach(d=>te+=parseFloat(d.dataset.c));
        document.getElementById(m+'-end-total').innerText = `$${te}`;
    }
    function calcWAvg() {
        document.querySelectorAll('#wavg-source .inv-block').forEach(d=>{d.dataset.c=20; d.innerText+=' (Avg)'; d.className='inv-block cost-avg';});
        document.getElementById('wavg-explainer').style.display = 'block';
    }

    /* Inflation / Deflation Toggle */
    let isInflation = true;
    function togglePriceTrend() {
        isInflation = !isInflation;
        const line = document.getElementById('trend-line');
        const fifoC = document.getElementById('fifo-circle');
        const fifoL = document.getElementById('fifo-label');
        const fifoS = document.getElementById('fifo-sub');
        const lifoC = document.getElementById('lifo-circle');
        const lifoL = document.getElementById('lifo-label');
        const lifoS = document.getElementById('lifo-sub');
        const label = document.getElementById('trend-label');
        const desc = document.getElementById('trend-desc');

        if(isInflation) {
            // Inflation State
            label.innerText = "Inflation";
            desc.innerHTML = "<strong>Inflation:</strong> FIFO uses older (lower) costs. LIFO uses newer (higher) costs.";
            // Line: Upward
            line.setAttribute("y1", "300"); // Start Low
            line.setAttribute("y2", "50");  // End High
            // FIFO: Bottom Left (Older, Lower)
            fifoC.setAttribute("cx", "100"); fifoC.setAttribute("cy", "275");
            fifoL.setAttribute("x", "100"); fifoL.setAttribute("y", "275");
            fifoS.setAttribute("x", "100"); fifoS.setAttribute("y", "290");
            // LIFO: Top Right (Newer, Higher)
            lifoC.setAttribute("cx", "500"); lifoC.setAttribute("cy", "75");
            lifoL.setAttribute("x", "500"); lifoL.setAttribute("y", "75");
            lifoS.setAttribute("x", "500"); lifoS.setAttribute("y", "90");
        } else {
            // Deflation State
            label.innerText = "Deflation";
            desc.innerHTML = "<strong>Deflation:</strong> FIFO uses older (higher) costs. LIFO uses newer (lower) costs.";
            // Line: Downward
            line.setAttribute("y1", "50");  // Start High
            line.setAttribute("y2", "300"); // End Low
            
            // FIFO (Older/Left): Now High Cost
            fifoC.setAttribute("cx", "100"); fifoC.setAttribute("cy", "75");
            fifoL.setAttribute("x", "100"); fifoL.setAttribute("y", "75");
            fifoS.setAttribute("x", "100"); fifoS.setAttribute("y", "90");
            
            // LIFO (Newer/Right): Now Low Cost
            lifoC.setAttribute("cx", "500"); lifoC.setAttribute("cy", "275");
            lifoL.setAttribute("x", "500"); lifoL.setAttribute("y", "275");
            lifoS.setAttribute("x", "500"); lifoS.setAttribute("y", "290");
        }
    }

    /* Liq Sim Logic */
    function initLiqSim(resetTable = true) {
        const s = document.getElementById('liq-source'), c = document.getElementById('liq-cogs');
        s.innerHTML=''; c.innerHTML=''; 
        
        if(resetTable) {
            document.getElementById('col-a').classList.remove('active-col','dim-col');
            document.getElementById('col-b').classList.remove('active-col','dim-col');
            ['cogs','gp','tax'].forEach(k => {
                 document.getElementById('res-a-'+k).innerText = '-';
                 document.getElementById('res-b-'+k).innerText = '-';
            });
        }

        // Add 1-3
        for(let i=1; i<=3; i++) {
            const d = document.createElement('div'); d.className='inv-block cost-old'; d.draggable=true;
            d.innerHTML=`#${i} $1 (Old)`; d.id=`liq-${i}`; d.dataset.c=1;
            d.ondragstart=ev=>{ev.dataTransfer.setData("id",ev.target.id);};
            s.appendChild(d);
        }
    }
    
    function resetDraggables() {
        initLiqSim(false);
    }
    
    function liqRestock() {
        const s = document.getElementById('liq-source');
        s.innerHTML = '';
        for(let i=1; i<=3; i++) {
            const d = document.createElement('div'); d.className='inv-block cost-old'; d.draggable=true;
            d.innerHTML=`#${i} $1 (Old)`; d.id=`liq-${i}`; d.dataset.c=1;
            d.ondragstart=ev=>{ev.dataTransfer.setData("id",ev.target.id);};
            s.appendChild(d);
        }
        for(let i=4; i<=6; i++) {
            const d = document.createElement('div'); d.className='inv-block cost-new'; d.draggable=true;
            d.innerHTML=`#${i} $10 (New)`; d.id=`liq-${i}`; d.dataset.c=10;
            d.ondragstart=ev=>{ev.dataTransfer.setData("id",ev.target.id);};
            s.appendChild(d);
        }
    }
    function liqNoStock() {
        initLiqSim(false);
    }
    function checkLiqResult() {
        const c = document.getElementById('liq-cogs');
        if(c.children.length === 3) {
            let totalCost = 0;
            for(let el of c.children) totalCost += parseFloat(el.dataset.c);
            const revenue = 60; // 3 units * $20
            const gp = revenue - totalCost;
            const tax = gp * 0.21;
            
            // Update Table
            if(totalCost === 30) {
                // A
                document.getElementById('res-a-cogs').innerText = "$30";
                document.getElementById('res-a-gp').innerText = "$30";
                document.getElementById('res-a-tax').innerText = "$" + tax.toFixed(2);
                document.getElementById('col-a').classList.add('active-col');
                document.getElementById('col-a').classList.remove('dim-col');
                document.getElementById('col-b').classList.add('dim-col');
                document.getElementById('col-b').classList.remove('active-col');
            } else {
                // B
                document.getElementById('res-b-cogs').innerText = "$" + totalCost;
                document.getElementById('res-b-gp').innerText = "$" + gp;
                document.getElementById('res-b-tax').innerText = "$" + tax.toFixed(2);
                document.getElementById('col-b').classList.add('active-col');
                document.getElementById('col-b').classList.remove('dim-col');
                document.getElementById('col-a').classList.add('dim-col');
                document.getElementById('col-a').classList.remove('active-col');
            }
        }
    }

    /* Calculators */
    function calcRatios() {
        const cogs = parseFloat(document.getElementById('inp-cogs').value);
        const inv = parseFloat(document.getElementById('inp-inv').value);
        if(cogs && inv) {
            const t = cogs / inv;
            const d = 365 / t;
            document.getElementById('ratio-results').innerHTML = `Turnover: ${t.toFixed(1)}x<br>DIO: ${d.toFixed(1)} Days`;
            
            let interp = "";
            if(d > 100) interp = "Interpretation: <strong>Slow Moving / High Stock.</strong> Risk of obsolescence.";
            else if(d < 30) interp = "Interpretation: <strong>Fast Moving / Efficient.</strong> Good cash flow, but check for stockouts.";
            else interp = "Interpretation: <strong>Moderate.</strong> Typical for many industries.";
            
            const div = document.getElementById('ratio-interpret');
            div.innerHTML = interp;
            div.style.display = 'block';
        }
    }
    
    function calcCashFlow() {
        const cogs = parseFloat(document.getElementById('inp-cf-cogs').value);
        if(cogs) {
            const val = cogs / 365;
            document.getElementById('cf-result').innerText = `Value of 1 Day = $${val.toFixed(2)} Million`;
        }
    }

    /* Consolidation Animation */
    function performConsolidation() {
        document.getElementById('elim-fb-lia').classList.add('eliminated');
        document.getElementById('elim-spe-asset').classList.add('eliminated');
    }

    /* CCC Interactive */
    function updateCCC() {
        const inputs = document.querySelectorAll('#slide-42 input');
        const vDio = parseInt(inputs[0].value);
        const vDso = parseInt(inputs[1].value);
        const vDpo = parseInt(inputs[2].value);

        document.getElementById('val-dio').innerText = vDio;
        document.getElementById('val-dso').innerText = vDso;
        document.getElementById('val-dpo').innerText = vDpo;

        const scale = 2; 
        const barDio = document.getElementById('bar-dio');
        const barDso = document.getElementById('bar-dso');
        const barDpo = document.getElementById('bar-dpo');
        const lineCcc = document.getElementById('line-ccc');
        const labelCcc = document.getElementById('label-ccc');

        barDio.style.width = (vDio * scale) + 'px';
        barDio.innerText = `DIO: ${vDio}`;
        
        barDso.style.width = (vDso * scale) + 'px';
        barDso.style.left = (20 + vDio * scale) + 'px';
        barDso.innerText = `DSO: ${vDso}`;

        barDpo.style.width = (vDpo * scale) + 'px';
        barDpo.innerText = `DPO: ${vDpo}`;

        const ccc = vDio + vDso - vDpo;
        const startX = 20 + (vDpo * scale);
        const endX = 20 + ((vDio + vDso) * scale);
        const width = endX - startX;

        if (width > 0) {
            lineCcc.style.left = startX + 'px';
            lineCcc.style.width = width + 'px';
            lineCcc.style.display = 'block';
            labelCcc.innerText = `CCC = ${ccc} Days`;
            labelCcc.style.left = (startX + width/2 - 40) + 'px';
        } else {
            lineCcc.style.display = 'none';
            labelCcc.innerText = `CCC = ${ccc} Days (Negative!)`;
            labelCcc.style.left = '20px';
        }
    }

    /* Summary Reveal */
    let summaryIndex = 0;
    function revealNextSummary() {
        const items = document.querySelectorAll('.summary-item');
        if(summaryIndex < items.length) {
            items[summaryIndex].classList.add('visible');
            summaryIndex++;
        }
    }

    /* Quiz */
    const quizData = [
        {q:"Rising prices: highest Net Income?", o:["LIFO","FIFO","W-Avg"], a:1},
        {q:"LIFO Liquidation causes...", o:["Lower Taxes","Higher Taxes","No Change"], a:1},
        {q:"CCC Formula?", o:["DIO+DSO-DPO","DIO-DSO+DPO","DIO+DSO+DPO"], a:0},
        {q:"NRV < Cost effect?", o:["No Entry","Write-down","Write-up"], a:1},
        {q:"LIFO Reserve purpose?", o:["Tax Evasion","Comparability","Marketing"], a:1},
        {q:"First Brands issue?", o:["High Revenue","Hidden Debt","Inventory Theft"], a:1},
        {q:"Inventory Turnover Formula?", o:["Avg Inv / COGS","COGS / Avg Inv","Sales / Cash"], a:1},
        {q:"COGS is on the...", o:["Balance Sheet","Income Statement","Cash Flow"], a:1},
        {q:"Lower DPO means...", o:["Paying Faster","Paying Slower","More Cash"], a:0},
        {q:"Inventory Factoring is?", o:["A Sale","Borrowing","Often Both"], a:2}
    ];
    let quizIdx = 0;

    function loadQuestion() {
        if(quizIdx >= quizData.length) {
            document.getElementById('quiz-question').innerText = "Quiz Complete!";
            document.getElementById('quiz-options').innerHTML = "";
            return;
        }
        const d = quizData[quizIdx];
        document.getElementById('quiz-question').innerText = d.q;
        const c = document.getElementById('quiz-options');
        c.innerHTML = '';
        document.getElementById('quiz-feedback').style.display = 'none';
        
        d.o.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'quiz-option';
            div.innerText = opt;
            div.onclick = () => {
                if(i === d.a) {
                    div.classList.add('correct');
                    document.getElementById('quiz-feedback').innerText = "Correct!";
                    document.getElementById('quiz-feedback').style.display = 'block';
                    document.getElementById('quiz-feedback').style.background = '#dcfce7';
                    document.getElementById('quiz-feedback').style.color = 'var(--color-midnight)';
                } else {
                    div.classList.add('wrong');
                    document.getElementById('quiz-feedback').innerText = "Incorrect.";
                    document.getElementById('quiz-feedback').style.display = 'block';
                    document.getElementById('quiz-feedback').style.background = '#fee2e2';
                    document.getElementById('quiz-feedback').style.color = 'var(--color-midnight)';
                }
            };
            c.appendChild(div);
        });
        document.getElementById('quiz-progress').innerText = `${quizIdx+1} / 10`;
    }

    function nextQuestion() { quizIdx++; loadQuestion(); }
    
    function revealPoll(el, msg) {
        const r = el.parentElement.querySelector('.poll-reveal');
        r.style.display = 'block'; r.innerText = msg;
        if(msg.includes('Correct')) { el.style.background='#dcfce7'; el.style.borderColor='var(--color-success)'; } else { el.style.background='#fee2e2'; el.style.borderColor='var(--color-error)'; }
    }

    // Init
    generateTOC();
    updateUI();
</script>

</body>
</html>
