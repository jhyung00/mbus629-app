<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparative Financial Analysis: NVIDIA vs Intel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .sidebar { transition: all 0.3s; }
        .nav-item { transition: all 0.2s; cursor: pointer; }
        .nav-item:hover { background-color: #374151; }
        .nav-item.active { background-color: #10b981; color: white; border-right: 4px solid #065f46; }
        .nav-item.active-intel { background-color: #3b82f6; border-right: 4px solid #1e3a8a; } /* Blue for Intel */
        .card { transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68D391;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #68D391;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="sidebar w-72 bg-gray-900 text-gray-300 flex flex-col shadow-xl z-20 hidden md:flex">
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-3 mb-4">
                <div id="logo-box" class="w-8 h-8 bg-green-500 rounded flex items-center justify-center text-white font-bold transition-colors duration-300">N</div>
                <h1 class="text-xl font-bold text-white tracking-wide">Financials <span class="text-xs font-normal text-gray-400 block">Comparative Analysis</span></h1>
            </div>

            <!-- Company Selector -->
            <div class="bg-gray-800 rounded p-1 flex justify-between text-xs font-bold">
                <button onclick="setMode('nvidia')" id="btn-nvidia" class="flex-1 py-1 rounded bg-gray-700 text-white shadow">NVIDIA</button>
                <button onclick="setMode('compare')" id="btn-compare" class="flex-1 py-1 rounded hover:bg-gray-700">VS</button>
                <button onclick="setMode('intel')" id="btn-intel" class="flex-1 py-1 rounded hover:bg-gray-700">INTEL</button>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li class="nav-item px-6 py-3 active" onclick="loadModule('profitability', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span>Profitability</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('productivity', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        <span>Productivity & Growth</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('efficiency', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span>Efficiency & Working Capital</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('liquidity', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        <span>Liquidity</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('solvency', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                        <span>Solvency</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('valueCreation', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        <span>Value Creation</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('dupont', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        <span>DuPont Analysis</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('earningsQuality', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span>Earnings Quality</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('cashFlows', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span>Cash Flows</span>
                    </div>
                </li>
                <li class="nav-item px-6 py-3" onclick="loadModule('sustainability', this)">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span>Sustainability</span>
                    </div>
                </li>
            </ul>
        </nav>
        <div class="p-6 text-xs text-gray-500 border-t border-gray-800">
            Data Source: Comparative FS<br>NVIDIA FY20-24 | Intel FY19-23
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed w-full bg-gray-900 text-white z-50 p-4 flex justify-between items-center">
        <span class="font-bold">Comparative Analysis</span>
        <button onclick="document.querySelector('.sidebar').classList.toggle('hidden'); document.querySelector('.sidebar').classList.toggle('absolute');" class="focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>
    </div>

    <!-- Main Content -->
    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6 md:p-10 pt-20 md:pt-10">
        <div id="content-header" class="mb-8">
            <h2 id="section-title" class="text-3xl font-bold text-gray-800">Analysis of Profitability</h2>
            <p id="section-subtitle" class="text-gray-600 mt-2">Historical margin trends and performance commentary.</p>
        </div>

        <div id="dashboard-content" class="space-y-6">
            <!-- Dynamic Content Injected Here -->
        </div>
    </main>

    <script>
        // --- Data Source ---
        // Aligned Periods: Index 0 is Oldest (2019/20), Index 4 is Newest (2023/24)
        const commonYears = ["2019/20", "2020/21", "2021/22", "2022/23", "2023/24"];
        // Adjusted years for Efficiency charts (limited to last 2 periods)
        const efficiencyYears = ["2022/23", "2023/24"];
        
        const reportData = {
            nvidia: {
                color: '#10b981',
                bg: 'rgba(16, 185, 129, 0.1)',
                profitability: {
                    trendAnalysis: "NVIDIA had exceptional profitability in the last 5 years. Margins increased considerably from 2023 to 2024 due to AI boom.",
                    metrics: [
                        { name: "Gross Profit %", data: [0.619, 0.623, 0.649, 0.569, 0.727], comment: "Increased significantly in 2024 due to high demand." },
                        { name: "Operating Profit %", data: [0.332, 0.272, 0.373, 0.156, 0.541], comment: "Operating profit significantly increased in 2024." },
                        { name: "Net Profit %", data: [0.256, 0.259, 0.362, 0.161, 0.488], comment: "Exceptional profit margin in 2024." }
                    ]
                },
                earningsQuality: {
                    trendAnalysis: "Earnings quality from 2020 to 2024 looks to be improving. Net income shows explosive growth as well as cash flows from operations.",
                    metrics: [
                         { name: "NI/CFO Ratio", data: [0.587, 0.744, 1.071, 0.774, 1.059], comment: "Consistent alignment between income and cash flow." }
                    ]
                },
                productivity: {
                    metrics: [
                        { name: "Net Sales ($M)", data: [10918, 16675, 26914, 26974, 60922], comment: "Explosive 126% growth in 2024 driven by AI/Data Center." },
                        { name: "Operating Income ($M)", data: [2970, 4409, 10041, 4224, 32972], comment: "Almost 8-fold increase in 2024." },
                        { name: "Net Income ($M)", data: [2796, 4332, 9752, 4368, 29760], comment: "Remarkable increase in profitability." },
                        { name: "Operating Expenses ($M)", data: [3922, 5864, 7434, 11132, 11329], comment: "Disciplined cost control despite revenue growth." }
                    ]
                },
                efficiency: {
                    // Split into two groups for better charting
                    turnoverMetrics: [
                        { name: "Inventory Turnover", data: [2.99, 3.18], comment: "Slight improvement in 2024 (3.18) vs 2023 (2.99), faster turnover." },
                        { name: "Receivables Turnover", data: [6.36, 8.81], comment: "Increased (8.81) in 2024, quicker collection." },
                        { name: "Payables Turnover", data: [7.81, 8.54], comment: "Increased (8.54) in 2024, quicker payment to suppliers." },
                        { name: "PPE Turnover", data: [8.19, 15.78], comment: "Increased significantly in 2024 (15.78), efficient asset use." }
                    ],
                    daysMetrics: [
                        { name: "DIO (Days)", data: [122.0, 114.6], comment: "Reduced to 114.6 days in 2024, better inventory management." },
                        { name: "DSO (Days)", data: [57.4, 41.4], comment: "Decreased to 41.4 days in 2024, improved collection efficiency." },
                        { name: "DPO (Days)", data: [46.7, 42.7], comment: "Decreased to 42.7 days in 2024, faster payment cycles." },
                        { name: "Cash Conversion Cycle", data: [132.6, 113.3], comment: "Improved to 113.3 days in 2024, enhanced efficiency." }
                    ]
                },
                liquidity: {
                    metrics: [
                        { name: "Current Ratio", data: [7.67, 4.09, 6.65, 3.52, 4.17], comment: "Well above 1.0, liquidity is not a problem." },
                        { name: "Quick Ratio", data: [7.04, 3.56, 5.96, 2.61, 3.38], comment: "High liquidity resources." }
                    ]
                },
                solvency: {
                    metrics: [
                        { name: "Debt-to-Equity", data: [0.42, 0.70, 0.66, 0.86, 0.53], comment: "Low leverage and lower risk of insolvency." },
                        { name: "Debt-to-Assets", data: [0.30, 0.41, 0.40, 0.46, 0.35], comment: "Remains below 0.5, healthy balance." },
                        { name: "TIE Ratio", data: [58.11, 24.96, 43.12, 16.96, 132.58], comment: "Extremely good ability to cover interest." }
                    ]
                },
                valueCreation: {
                    summary: "Positive trend with dramatic ROE increase in 2024.",
                    metrics: [
                        { name: "ROE", latest: 0.915, prev: 0.179, comment: "Dramatic increase due to margin expansion." },
                        { name: "Asset Turnover", latest: 1.14, prev: 0.63, comment: "Generated 54 cents per dollar of assets." },
                        { name: "Fin. Leverage", latest: 1.64, prev: 1.75, comment: "Structure remains steady." }
                    ]
                },
                dupont: {
                    summary: "Comparison of RNOA (Operating) vs ROE (Total) reveals driver of returns.",
                    metrics: [
                         { name: "RNOA (Net Operating)", data: [null, null, null, 0.234, 1.198], comment: "Massive core operating efficiency (119.8%) in 2024." },
                         { name: "ROA (Return on Assets)", data: [null, null, null, 0.102, 0.557], comment: "Overall asset return driven by high margins." },
                         { name: "ROE (Return on Equity)", data: [0.256, 0.259, 0.362, 0.179, 0.915], comment: "Shareholder returns magnified by leverage." }
                    ]
                },
                cashFlows: {
                    cfoTrend: {
                        cfo: [4761.0, 5822.0, 9108.0, 5641.0, 28090.0],
                        change: [0, 0.22, 0.56, -0.38, 3.98]
                    },
                    cards: [
                        { title: "CFO (Operations)", status: "Positive", text: "Generated $28 billion. Primary source of cash." },
                        { title: "CFI (Investing)", status: "Negative", text: "Investing excess cash in marketable securities." },
                        { title: "CFF (Financing)", status: "Negative", text: "Returning cash via repurchases and dividends." },
                        { title: "Conclusion", status: "Healthy", text: "Self-sustaining, significantly improved financial health in 2024." }
                    ]
                },
                sustainability: {
                     esg: { score: "C+ (Medium)", provider: "ISS", comment: "Truvalue 16th Percentile (Below Avg)" },
                     env: { title: "Emissions / EVIC", val: "2.02", detail: "Majority Scope 3 (6.9M tCO2e). No Paris-Aligned reduction initiatives." },
                     soc: { title: "Diversity", val: "33% F", detail: "Board is 33% Female, Management 19%." },
                     spotlight: { title: "Recent Spotlight", text: "Scrutiny over CoreWeave investment ($2B) and China AI chip sales." }
                }
            },
            intel: {
                color: '#3b82f6',
                bg: 'rgba(59, 130, 246, 0.1)',
                profitability: {
                    trendAnalysis: "Downward trend from 2019 to 2023. Margins decreased significantly, with pronounced drops in 2023 suggesting cost/pricing challenges.",
                    metrics: [
                        { name: "Gross Profit %", data: [0.586, 0.560, 0.554, 0.426, 0.400], comment: "Declining steadily; significant drop in 2023." },
                        { name: "Operating Profit %", data: [0.306, 0.304, 0.246, 0.037, 0.002], comment: "Dramatic decrease, nearly negligible margin in 2023." },
                        { name: "Net Profit %", data: [0.292, 0.268, 0.251, 0.127, 0.031], comment: "Notably lower profitability in 2023." }
                    ]
                },
                earningsQuality: {
                    trendAnalysis: "Earnings quality has deteriorated. NI/CFO ratio significantly decreased, suggesting a smaller proportion of net income is converted to cash flow.",
                    metrics: [
                         { name: "NI/CFO Ratio", data: [0.635, 0.590, 0.662, 0.519, 0.146], comment: "Sharp decline in 2023 indicating lower earnings quality." }
                    ]
                },
                productivity: {
                    metrics: [
                        { name: "Net Sales ($M)", data: [71965, 77867, 79024, 63054, 54228], comment: "Sales have contracted in recent years." },
                        { name: "Operating Income ($M)", data: [22035, 23678, 19456, 2334, 93], comment: "Collapsed in 2023 reflecting operational challenges." },
                        { name: "Net Income ($M)", data: [21048, 20899, 19868, 8017, 1675], comment: "Sharp decline indicating substantial decrease in profitability." },
                        { name: "Operating Expenses ($M)", data: [5434, 669, 19456, 2334, 21618], comment: "Fluctuating expenses with high burden in 2023." }
                    ]
                },
                efficiency: {
                    // Data restricted to last 2 comparable periods
                    turnoverMetrics: [
                        { name: "Inventory Turnover", data: [3.01, 2.67], comment: "Decreased (2.67) in 2023, selling less frequently." },
                        { name: "Receivables Turnover", data: [9.28, 14.39], comment: "Increased (14.39) in 2023, faster collection." },
                        { name: "Payables Turnover", data: [4.72, 3.58], comment: "Decreased (3.58) in 2023, taking longer to pay suppliers." },
                        { name: "PPE Turnover", data: [0.88, 0.61], comment: "Decreased to 0.61, generating less sales per PPE dollar." }
                    ],
                    daysMetrics: [
                        { name: "DIO (Days)", data: [121.0, 136.7], comment: "Increased to 136.7 days, holding inventory longer." },
                        { name: "DSO (Days)", data: [39.3, 25.4], comment: "Decreased to 25.4 days, collecting receivables faster." },
                        { name: "DPO (Days)", data: [77.4, 102.0], comment: "Increased to 102.0 days, slower payment to suppliers." },
                        { name: "Cash Conversion Cycle", data: [83.0, 60.0], comment: "Decreased to 60.0 days, improved cash management cycle." }
                    ]
                },
                liquidity: {
                    metrics: [
                        { name: "Current Ratio", data: [1.40, 1.91, 2.10, 1.57, 1.54], comment: "Above 1.0 but trend is deteriorating." },
                        { name: "Quick Ratio", data: [1.01, 1.57, 1.71, 1.16, 1.15], comment: "Close to 1.0; needs to improve liquidity." }
                    ]
                },
                solvency: {
                    metrics: [
                        { name: "Debt-to-Equity", data: [0.76, 0.89, 0.77, 0.80, 0.81], comment: "Moderate leverage, risk remains managed." },
                        { name: "Debt-to-Assets", data: [0.43, 0.47, 0.43, 0.44, 0.45], comment: "Assets exceed liabilities." },
                        { name: "TIE Ratio", data: [50.2, 40.9, 37.4, 16.7, 1.9], comment: "Fell significantly in 2023; income barely covers interest." }
                    ]
                },
                valueCreation: {
                    summary: "Negative trend. Profit margin decreased dramatically, causing ROE to drop.",
                    metrics: [
                        { name: "ROE", latest: 0.016, prev: 0.081, comment: "Decreased dramatically due to low margins." },
                        { name: "Asset Turnover", latest: 0.29, prev: 0.36, comment: "Generating less revenue per asset dollar." },
                        { name: "Fin. Leverage", latest: 1.81, prev: 1.78, comment: "Capital structure remains mostly steady." }
                    ]
                },
                dupont: {
                    summary: "Low RNOA indicates challenges in core operations, not just financing.",
                    metrics: [
                         { name: "RNOA (Net Operating)", data: [null, null, null, 0.048, 0.012], comment: "Dropped to 1.2% in 2023; operational struggle." },
                         { name: "ROA (Return on Assets)", data: [null, null, null, 0.046, 0.009], comment: "Low asset return reflecting margin compression." },
                         { name: "ROE (Return on Equity)", data: [0.292, 0.268, 0.251, 0.081, 0.016], comment: "Declining shareholder returns over 5 years." }
                    ]
                },
                cashFlows: {
                    cfoTrend: {
                        cfo: [33145.0, 35384.0, 29991.0, 15433.0, 11471.0],
                        change: [0, 0.07, -0.15, -0.49, -0.26]
                    },
                    cards: [
                        { title: "CFO (Operations)", status: "Positive", text: "Decreased in 2023. CFO < CFI + CFF, not self-sustaining currently." },
                        { title: "CFI (Investing)", status: "Negative", text: "Investing excess cash (marketable securities) & Capex." },
                        { title: "CFF (Financing)", status: "Positive", text: "Issuance of debt. Dividends payments are declining." },
                        { title: "Conclusion", status: "Declining", text: "Financial health is substantially declining. CFO insufficient to cover obligations." }
                    ]
                },
                sustainability: {
                     esg: { score: "B- (Good)", provider: "ISS", comment: "Sustainalytics Low Risk (19.1)" },
                     env: { title: "Weakness", val: "Low Rank", detail: "Energy Management & Product Design rank very low (5th-7th percentile)." },
                     soc: { title: "Supply Chain", val: "Vol: 19%", detail: "Top category by volume but poor performance (15th/16th rank)." },
                     spotlight: { title: "Recent Spotlight", text: "Panther Lake & Arc B390 launches driving attention in Energy/GHG." }
                }
            }
        };

        let currentMode = 'nvidia'; // nvidia, intel, compare
        let currentModule = 'profitability';

        // --- Core Logic ---

        function setMode(mode) {
            currentMode = mode;
            
            // Update UI Buttons
            document.getElementById('btn-nvidia').className = `flex-1 py-1 rounded shadow ${mode === 'nvidia' ? 'bg-green-600 text-white' : 'bg-gray-700 hover:bg-gray-600'}`;
            document.getElementById('btn-compare').className = `flex-1 py-1 rounded shadow ${mode === 'compare' ? 'bg-purple-600 text-white' : 'bg-gray-700 hover:bg-gray-600'}`;
            document.getElementById('btn-intel').className = `flex-1 py-1 rounded shadow ${mode === 'intel' ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600'}`;

            // Update Logo
            const logo = document.getElementById('logo-box');
            if (mode === 'nvidia') { logo.innerText = 'N'; logo.className = "w-8 h-8 bg-green-500 rounded flex items-center justify-center text-white font-bold transition-colors duration-300"; }
            else if (mode === 'intel') { logo.innerText = 'I'; logo.className = "w-8 h-8 bg-blue-500 rounded flex items-center justify-center text-white font-bold transition-colors duration-300"; }
            else { logo.innerText = 'VS'; logo.className = "w-8 h-8 bg-purple-500 rounded flex items-center justify-center text-white font-bold transition-colors duration-300"; }

            // Sidebar Highlight Color
            document.querySelectorAll('.nav-item').forEach(el => {
                if (mode === 'intel') { el.classList.remove('active'); if(el.dataset.id === currentModule) el.classList.add('active-intel'); }
                else { el.classList.remove('active-intel'); if(el.dataset.id === currentModule) el.classList.add('active'); }
            });

            loadModule(currentModule);
        }

        // --- Render Helpers ---

        function createMetricCard(metricName, nData, iData, isShort=false) {
            const showNvidia = currentMode === 'nvidia' || currentMode === 'compare';
            const showIntel = currentMode === 'intel' || currentMode === 'compare';
            
            let html = `<div class="card bg-white rounded-lg shadow-sm border border-gray-200 p-6">`;
            html += `<h3 class="font-bold text-gray-800 text-lg mb-4">${metricName}</h3>`;

            if (currentMode === 'compare') {
                html += `<div class="flex justify-between items-center mb-2 pb-2 border-b border-gray-100">
                            <span class="text-xs font-bold text-green-600 uppercase">NVIDIA</span>
                            <span class="text-xl font-bold text-gray-800">${nData.val}</span>
                         </div>
                         <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-blue-600 uppercase">INTEL</span>
                            <span class="text-xl font-bold text-gray-800">${iData.val}</span>
                         </div>
                         <p class="text-xs text-gray-400 mt-3 text-center">Comparison (Latest Year)</p>
                         `;
            } else {
                const data = currentMode === 'nvidia' ? nData : iData;
                const color = currentMode === 'nvidia' ? 'text-green-600' : 'text-blue-600';
                html += `
                    <div class="flex justify-between items-start">
                        <div class="text-3xl font-bold ${color}">${data.val}</div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">${data.comment}</p>
                `;
            }
            html += `</div>`;
            return html;
        }

        function renderChart(canvasId, datasets, labels) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            if(window[canvasId] instanceof Chart) window[canvasId].destroy();

            // Filter datasets based on mode
            let activeDatasets = [];
            if (currentMode === 'nvidia' || currentMode === 'compare') {
                activeDatasets.push(...datasets.nvidia);
            }
            if (currentMode === 'intel' || currentMode === 'compare') {
                activeDatasets.push(...datasets.intel);
            }

            window[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels || commonYears,
                    datasets: activeDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { backgroundColor: 'rgba(17, 24, 39, 0.9)', padding: 12, cornerRadius: 4 }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#e5e7eb' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function getMetricData(companyData, category, index) {
            const m = companyData[category].metrics[index];
            const latestVal = m.data[4]; // 5th element is latest
            return { val: latestVal.toLocaleString(), comment: m.comment };
        }

        // --- Module Renderers ---

        function renderStandardModule(moduleId, chartId) {
            const container = document.getElementById('dashboard-content');
            const nv = reportData.nvidia[moduleId];
            const intc = reportData.intel[moduleId];

            // 1. Commentary Block
            let commentHtml = '';
            if (currentMode !== 'compare') {
                const data = currentMode === 'nvidia' ? nv : intc;
                const borderClass = currentMode === 'nvidia' ? 'border-green-500 text-green-700 bg-green-50' : 'border-blue-500 text-blue-700 bg-blue-50';
                if (data.trendAnalysis) {
                    commentHtml = `<div class="${borderClass} border-l-4 p-4 rounded mb-6"><p class="font-semibold">Trend Analysis</p><p class="text-sm">${data.trendAnalysis}</p></div>`;
                }
            }

            // 2. Chart
            // Prepare datasets
            const nvDatasets = nv.metrics.map((m, i) => ({
                label: `NVDA ${m.name}`,
                data: m.data,
                borderColor: i===0?'#10b981':(i===1?'#059669':'#047857'),
                backgroundColor: 'rgba(0,0,0,0)',
                borderWidth: 2,
                tension: 0.3
            }));
            const intcDatasets = intc.metrics.map((m, i) => ({
                label: `INTC ${m.name}`,
                data: m.data,
                borderColor: i===0?'#3b82f6':(i===1?'#2563eb':'#1d4ed8'),
                backgroundColor: 'rgba(0,0,0,0)',
                borderDash: [5, 5],
                borderWidth: 2,
                tension: 0.3
            }));

            // 3. Cards
            const cardCount = Math.max(nv.metrics.length, intc.metrics.length);
            let cardsHtml = '';
            for(let i=0; i<cardCount; i++) {
                const nValRaw = nv.metrics[i]?.data[4];
                const iValRaw = intc.metrics[i]?.data[4];
                // Formatter
                const formatVal = (v) => typeof v === 'number' ? v.toFixed(2) : (v || '-');

                const nData = { val: formatVal(nValRaw), comment: nv.metrics[i]?.comment || '' };
                const iData = { val: formatVal(iValRaw), comment: intc.metrics[i]?.comment || '' };
                cardsHtml += createMetricCard(nv.metrics[i]?.name || intc.metrics[i].name, nData, iData);
            }

            container.innerHTML = `
                ${commentHtml}
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 h-80">
                    <canvas id="${chartId}"></canvas>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${cardsHtml}
                </div>
            `;

            renderChart(chartId, { nvidia: nvDatasets, intel: intcDatasets }, commonYears);
        }

        function renderEfficiency() {
            const container = document.getElementById('dashboard-content');
            const nv = reportData.nvidia.efficiency;
            const intc = reportData.intel.efficiency;

            // Generate datasets helper for efficiency specific structure
            const createDatasets = (metricGroup) => {
                const nvD = nv[metricGroup].map((m, i) => ({
                    label: `NVDA ${m.name}`,
                    data: m.data,
                    borderColor: '#10b981', 
                    // Use varied greens or just one color with different styles if many lines, 
                    // but for clarity let's use colors from palette if needed or keep simple.
                    // Let's use different shades for different metrics to distinguish them
                    borderColor: ['#10b981', '#059669', '#34d399', '#064e3b'][i%4],
                    backgroundColor: 'rgba(0,0,0,0)',
                    borderWidth: 2,
                    tension: 0.1
                }));
                const intcD = intc[metricGroup].map((m, i) => ({
                    label: `INTC ${m.name}`,
                    data: m.data,
                    borderColor: ['#3b82f6', '#2563eb', '#60a5fa', '#1e3a8a'][i%4],
                    backgroundColor: 'rgba(0,0,0,0)',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    tension: 0.1
                }));
                return { nvidia: nvD, intel: intcD };
            };

            // Cards generator
            const generateCards = (metricGroup) => {
                const count = Math.max(nv[metricGroup].length, intc[metricGroup].length);
                let html = '';
                for(let i=0; i<count; i++) {
                    // Latest value is at index 1 (since data array has 2 elements: [prev, latest])
                    const nValRaw = nv[metricGroup][i]?.data[1];
                    const iValRaw = intc[metricGroup][i]?.data[1];
                    const formatVal = (v) => typeof v === 'number' ? v.toFixed(2) : (v || '-');
                    const nData = { val: formatVal(nValRaw), comment: nv[metricGroup][i]?.comment || '' };
                    const iData = { val: formatVal(iValRaw), comment: intc[metricGroup][i]?.comment || '' };
                    html += createMetricCard(nv[metricGroup][i]?.name || intc[metricGroup][i].name, nData, iData);
                }
                return html;
            };

            container.innerHTML = `
                <!-- Turnover Ratios Section -->
                <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">Turnover Ratios</h3>
                <div class="bg-white p-6 rounded-lg shadow-md mb-6 h-72">
                    <canvas id="turnoverChart"></canvas>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 mb-10">
                    ${generateCards('turnoverMetrics')}
                </div>

                <!-- Days Outstanding Section -->
                <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">Days Outstanding & Cycle</h3>
                <div class="bg-white p-6 rounded-lg shadow-md mb-6 h-72">
                    <canvas id="daysChart"></canvas>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
                    ${generateCards('daysMetrics')}
                </div>
            `;

            renderChart('turnoverChart', createDatasets('turnoverMetrics'), efficiencyYears);
            renderChart('daysChart', createDatasets('daysMetrics'), efficiencyYears);
        }

        function renderValueCreation() {
            const container = document.getElementById('dashboard-content');
            const nv = reportData.nvidia.valueCreation;
            const intc = reportData.intel.valueCreation;

            const makeRow = (label, nvVal, intcVal) => `
                <div class="flex flex-col md:flex-row items-center justify-between text-center md:space-x-4 p-4 border rounded bg-white shadow-sm">
                    <div class="text-sm font-bold text-gray-500 uppercase w-full md:w-1/3">${label}</div>
                    <div class="flex-1 w-full flex justify-between md:justify-around items-center mt-2 md:mt-0">
                        <div class="${currentMode !== 'intel' ? 'block' : 'hidden'}">
                            <div class="text-xs text-green-600 font-bold mb-1">NVDA</div>
                            <div class="text-2xl font-bold text-gray-800">${nvVal}</div>
                        </div>
                        <div class="${currentMode === 'compare' ? 'block' : 'hidden'} w-px h-8 bg-gray-200 mx-4"></div>
                        <div class="${currentMode !== 'nvidia' ? 'block' : 'hidden'}">
                            <div class="text-xs text-blue-600 font-bold mb-1">INTC</div>
                            <div class="text-2xl font-bold text-gray-800">${intcVal}</div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = `
                <div class="space-y-4">
                    ${makeRow("Return on Equity", (nv.metrics[0].latest*100).toFixed(1)+'%', (intc.metrics[0].latest*100).toFixed(1)+'%')}
                    ${makeRow("Asset Turnover", nv.metrics[1].latest, intc.metrics[1].latest)}
                    ${makeRow("Financial Leverage", nv.metrics[2].latest, intc.metrics[2].latest)}
                </div>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-green-50 p-4 rounded text-green-800 ${currentMode==='intel'?'hidden':''} border border-green-200">
                        <span class="font-bold block mb-2">NVIDIA Summary</span> ${nv.summary}
                    </div>
                    <div class="bg-blue-50 p-4 rounded text-blue-800 ${currentMode==='nvidia'?'hidden':''} border border-blue-200">
                        <span class="font-bold block mb-2">Intel Summary</span> ${intc.summary}
                    </div>
                </div>
            `;
        }

        function renderDupont() {
            const container = document.getElementById('dashboard-content');
            const nv = reportData.nvidia.dupont;
            const intc = reportData.intel.dupont;

            // 1. Chart
            const nvDatasets = nv.metrics.map((m, i) => ({
                label: `NVDA ${m.name.split(' ')[0]}`,
                data: m.data,
                borderColor: i===0?'#10b981':(i===1?'#059669':'#047857'),
                backgroundColor: 'rgba(0,0,0,0)',
                borderWidth: 2,
                tension: 0.3,
                spanGaps: true
            }));
            const intcDatasets = intc.metrics.map((m, i) => ({
                label: `INTC ${m.name.split(' ')[0]}`,
                data: m.data,
                borderColor: i===0?'#3b82f6':(i===1?'#2563eb':'#1d4ed8'),
                backgroundColor: 'rgba(0,0,0,0)',
                borderDash: [5, 5],
                borderWidth: 2,
                tension: 0.3,
                spanGaps: true
            }));

            // 2. Cards
            let cardsHtml = '';
            for(let i=0; i<3; i++) {
                const nValRaw = nv.metrics[i].data[4];
                const iValRaw = intc.metrics[i].data[4];
                const nData = { 
                    val: nValRaw ? (nValRaw * 100).toFixed(1) + '%' : '-', 
                    comment: nv.metrics[i].comment 
                };
                const iData = { 
                    val: iValRaw ? (iValRaw * 100).toFixed(1) + '%' : '-', 
                    comment: intc.metrics[i].comment 
                };
                cardsHtml += createMetricCard(nv.metrics[i].name, nData, iData);
            }

            container.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 h-80">
                    <canvas id="dupontChart"></canvas>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${cardsHtml}
                </div>
            `;

            renderChart('dupontChart', { nvidia: nvDatasets, intel: intcDatasets }, commonYears);
        }

        function renderCashFlows() {
            const container = document.getElementById('dashboard-content');
            const nv = reportData.nvidia.cashFlows;
            const intc = reportData.intel.cashFlows;
            
            // Build datasets for trend chart
            const datasets = {
                nvidia: [
                    {
                        label: 'NVDA CFO ($M)',
                        data: nv.cfoTrend.cfo,
                        borderColor: '#10b981',
                        yAxisID: 'y',
                        tension: 0.2
                    },
                    {
                        label: 'NVDA % Change',
                        data: nv.cfoTrend.change.map(v => v*100),
                        borderColor: '#059669',
                        borderDash: [5,5],
                        yAxisID: 'y1',
                        tension: 0.2
                    }
                ],
                intel: [
                    {
                        label: 'INTC CFO ($M)',
                        data: intc.cfoTrend.cfo,
                        borderColor: '#3b82f6',
                        yAxisID: 'y',
                        tension: 0.2
                    },
                    {
                        label: 'INTC % Change',
                        data: intc.cfoTrend.change.map(v => v*100),
                        borderColor: '#2563eb',
                        borderDash: [5,5],
                        yAxisID: 'y1',
                        tension: 0.2
                    }
                ]
            };

            // Combine based on mode
            let activeDatasets = [];
            if (currentMode === 'nvidia' || currentMode === 'compare') activeDatasets.push(...datasets.nvidia);
            if (currentMode === 'intel' || currentMode === 'compare') activeDatasets.push(...datasets.intel);

            // Render Layout
            let cardsHtml = '';
            if (currentMode === 'compare') {
                 cardsHtml = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- NVDA Col -->
                        <div class="space-y-4">
                            <h3 class="font-bold text-green-700 border-b border-green-200 pb-2">NVIDIA</h3>
                            ${nv.cards.map(c => `<div class="bg-white p-4 rounded shadow-sm border-l-4 border-green-500"><h4 class="font-bold text-sm">${c.title}</h4><p class="text-xs mt-1 text-gray-600">${c.text}</p></div>`).join('')}
                        </div>
                        <!-- INTC Col -->
                        <div class="space-y-4">
                            <h3 class="font-bold text-blue-700 border-b border-blue-200 pb-2">INTEL</h3>
                            ${intc.cards.map(c => `<div class="bg-white p-4 rounded shadow-sm border-l-4 border-blue-500"><h4 class="font-bold text-sm">${c.title}</h4><p class="text-xs mt-1 text-gray-600">${c.text}</p></div>`).join('')}
                        </div>
                    </div>
                 `;
            } else {
                 const activeData = currentMode === 'nvidia' ? nv : intc;
                 cardsHtml = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${activeData.cards.map(card => `
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 flex flex-col h-full">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-bold text-gray-800 text-lg">${card.title}</h3>
                                    <span class="px-3 py-1 text-xs font-bold rounded-full 
                                        ${card.status.includes('Positive') || card.status === 'Healthy' ? 'bg-green-100 text-green-800' : (card.status==='Declining'?'bg-red-100 text-red-800':'bg-yellow-100 text-yellow-800')}">
                                        ${card.status}
                                    </span>
                                </div>
                                <p class="text-gray-600 text-sm flex-grow">${card.text}</p>
                            </div>
                        `).join('')}
                    </div>
                 `;
            }

            container.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 h-80">
                    <h3 class="font-bold text-gray-700 mb-2">CFO Trends & Growth</h3>
                    <canvas id="cfoChart"></canvas>
                </div>
                ${cardsHtml}
            `;

            // Init Chart with dual axis
            const ctx = document.getElementById('cfoChart').getContext('2d');
            if(window['cfoChart'] instanceof Chart) window['cfoChart'].destroy();
            
            window['cfoChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: commonYears,
                    datasets: activeDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { 
                            type: 'linear', 
                            display: true, 
                            position: 'left',
                            title: { display: true, text: 'CFO Amount ($M)' }
                        },
                        y1: { 
                            type: 'linear', 
                            display: true, 
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: '% Change' }
                        }
                    }
                }
            });
        }

        function renderSustainability() {
            const container = document.getElementById('dashboard-content');
            
            const makeCard = (company, data, color) => `
                <div class="bg-white rounded-lg shadow border-l-4 border-${color}-500 p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">${company} ESG Profile</h3>
                        <span class="bg-${color}-100 text-${color}-800 px-3 py-1 rounded-full text-sm font-bold">${data.esg.score}</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-gray-600 text-sm uppercase mb-2">Scores & Ratings</h4>
                            <ul class="text-sm space-y-2 text-gray-600">
                                <li><span class="font-semibold">Provider:</span> ${data.esg.provider}</li>
                                <li><span class="font-semibold">Detail:</span> ${data.esg.comment}</li>
                            </ul>
                        </div>
                        <div>
                             <h4 class="font-bold text-gray-600 text-sm uppercase mb-2">Environment</h4>
                             <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-semibold">${data.env.title}</span>
                                <span class="text-sm font-bold text-gray-800">${data.env.val}</span>
                             </div>
                             <p class="text-xs text-gray-500">${data.env.detail}</p>
                        </div>
                        <div>
                             <h4 class="font-bold text-gray-600 text-sm uppercase mb-2">Social / Governance</h4>
                             <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-semibold">${data.soc.title}</span>
                                <span class="text-sm font-bold text-gray-800">${data.soc.val}</span>
                             </div>
                             <p class="text-xs text-gray-500">${data.soc.detail}</p>
                        </div>
                         <div>
                             <h4 class="font-bold text-gray-600 text-sm uppercase mb-2">Spotlight Events</h4>
                             <div class="p-3 bg-gray-50 rounded text-xs text-gray-600 border border-gray-200">
                                ${data.spotlight.text}
                             </div>
                        </div>
                    </div>
                    
                </div>
            `;

            let html = '';
            if (currentMode === 'nvidia' || currentMode === 'compare') {
                html += makeCard('NVIDIA', reportData.nvidia.sustainability, 'green');
            }
            if (currentMode === 'intel' || currentMode === 'compare') {
                html += makeCard('Intel', reportData.intel.sustainability, 'blue');
            }
            
            container.innerHTML = html;
        }


        // --- Router ---
        function loadModule(moduleId, element) {
            currentModule = moduleId;

            // Titles
            const titles = {
                profitability: "Profitability Analysis",
                earningsQuality: "Earnings Quality",
                productivity: "Productivity & Growth",
                efficiency: "Efficiency & Working Capital",
                liquidity: "Liquidity Analysis",
                solvency: "Solvency Analysis",
                valueCreation: "Value Creation (ROE)",
                dupont: "Advanced DuPont Analysis",
                cashFlows: "Cash Flow Analysis",
                sustainability: "Sustainability (ESG) Profile"
            };
            const descs = {
                profitability: "Comparing margins and operational efficiency.",
                earningsQuality: "Assessment of Net Income vs Operating Cash Flow.",
                productivity: "Revenue growth and expense management.",
                efficiency: "Turnover ratios and Days Outstanding metrics (2022-2024).",
                liquidity: "Short-term financial health and obligations.",
                solvency: "Long-term debt stability and interest coverage.",
                valueCreation: "DuPont analysis and return on equity.",
                dupont: "Breakdown of RNOA, ROA, and ROE to identify performance drivers.",
                cashFlows: "Operating, investing, and financing cash movements.",
                sustainability: "Environmental, Social, and Governance ratings and key events."
            };

            document.getElementById('section-title').innerText = titles[moduleId];
            document.getElementById('section-subtitle').innerText = descs[moduleId];

            // Nav active state
            if (element) {
                document.querySelectorAll('.nav-item').forEach(el => {
                    el.classList.remove('active', 'active-intel');
                    // re-add tag for current mode logic in setMode
                });
                // setMode handles the actual coloring based on currentMode
            }
            // Ensure nav highlighting respects mode
            document.querySelectorAll('.nav-item').forEach(el => {
                if(el.dataset.id === moduleId) {
                    if(currentMode === 'intel') el.classList.add('active-intel');
                    else el.classList.add('active');
                } else {
                    el.classList.remove('active', 'active-intel');
                }
            });

            if(moduleId === 'valueCreation') renderValueCreation();
            else if(moduleId === 'dupont') renderDupont();
            else if(moduleId === 'cashFlows') renderCashFlows();
            else if(moduleId === 'sustainability') renderSustainability();
            else if(moduleId === 'efficiency') renderEfficiency();
            else renderStandardModule(moduleId, 'mainChart');
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            // Ensure nav items have data-id for styling logic
            const navs = document.querySelectorAll('.nav-item');
            navs[0].dataset.id = 'profitability';
            navs[1].dataset.id = 'earningsQuality';
            navs[2].dataset.id = 'productivity';
            navs[3].dataset.id = 'efficiency';
            navs[4].dataset.id = 'liquidity';
            navs[5].dataset.id = 'solvency';
            navs[6].dataset.id = 'valueCreation';
            navs[7].dataset.id = 'dupont';
            navs[8].dataset.id = 'cashFlows';
            navs[9].dataset.id = 'sustainability';

            loadModule('profitability');
        });

    </script>
</body>
</html>
