<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploring DEF14A Proxy Statement</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #f0f4f8; color: #1e293b; }
        
        .container { max-width: 1600px; margin: 0 auto; display: grid; grid-template-columns: 300px 1fr; height: 100vh; }
        
        /* Sidebar */
        aside { background: #ffffff; border-right: 1px solid #e2e8f0; padding: 30px; display: flex; flex-direction: column; overflow-y: auto; box-shadow: 4px 0 24px rgba(0,0,0,0.03); z-index: 10; }
        h1 { font-size: 24px; margin-bottom: 5px; color: #0f172a; letter-spacing: -0.5px; font-weight: 800; background: linear-gradient(135deg, #2563eb, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { color: #64748b; font-size: 12px; margin-bottom: 30px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        
        .nav-section { margin-bottom: 20px; }
        .nav-label { font-size: 11px; text-transform: uppercase; color: #94a3b8; font-weight: 700; margin-bottom: 12px; letter-spacing: 0.5px; }
        
        .company-switch { display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px; }
        .switch-btn { padding: 14px 16px; border: 1px solid #f1f5f9; border-radius: 12px; background: white; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 12px; color: #64748b; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .switch-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); color: #334155; }
        
        /* Company Specific Active States */
        .switch-btn.active { border-width: 2px; }
        .switch-btn.active.aapl { border-color: #9ca3af; color: #1f2937; background: #f3f4f6; } 
        .switch-btn.active.dis { border-color: #3b82f6; color: #1d4ed8; background: #eff6ff; } 
        .switch-btn.active.goog { border-color: #ea4335; color: #b91c1c; background: #fef2f2; } 
        .switch-btn.active.comp { border-color: #8b5cf6; color: #6d28d9; background: #f5f3ff; } 

        .stat-card { background: #f8fafc; padding: 16px; border-radius: 12px; margin-bottom: 16px; text-align: center; border: 1px solid #e2e8f0; }
        .stat-label { color: #64748b; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; }
        .stat-value { font-size: 24px; font-weight: 800; font-family: 'Inter', monospace; color: #0f172a; margin-top: 4px; }
        .stat-value.timer { color: #f59e0b; }
        
        .action-area { margin-top: auto; display: flex; flex-direction: column; gap: 10px; }
        
        button.primary { width: 100%; padding: 14px; background: #0f172a; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        button.primary:hover { background: #1e293b; transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        button.teacher-btn { width: 100%; padding: 12px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 13px; cursor: pointer; transition: 0.2s; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; }
        button.teacher-btn:hover { border-color: #cbd5e1; color: #475569; background: #f8fafc; }
        
        button.download-btn { width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        button.download-btn:hover { background: #059669; transform: translateY(-1px); }

        /* Main Content */
        main { padding: 40px 60px; overflow-y: auto; background: #f0f4f8; }
        
        .header-banner { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; border-left: 8px solid; overflow: hidden; position: relative; }
        .header-banner::after { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5)); pointer-events: none; }
        
        .header-banner.aapl { border-left-color: #9ca3af; }
        .header-banner.dis { border-left-color: #3b82f6; }
        .header-banner.goog { border-left-color: #ea4335; }
        .header-banner.comp { border-left-color: #8b5cf6; }
        
        .doc-link { padding: 12px 24px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 13px; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .doc-link:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .doc-link.aapl { background: #f3f4f6; color: #1f2937; }
        .doc-link.dis { background: #eff6ff; color: #1d4ed8; }
        .doc-link.goog { background: #fef2f2; color: #b91c1c; }

        .instruction-banner { background: #fffbeb; color: #b45309; padding: 12px; border-radius: 12px; margin-bottom: 30px; font-weight: 600; text-align: center; border: 1px solid #fcd34d; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 2px 4px rgba(251, 191, 36, 0.1); }
        .alert-badge { background: #ef4444; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75em; text-transform: uppercase; font-weight: 800; letter-spacing: 0.5px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(480px, 1fr)); gap: 24px; }
        
        .card { background: white; padding: 28px; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02), 0 2px 4px -1px rgba(0,0,0,0.02); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #f1f5f9; position: relative; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.01); border-color: #e2e8f0; }
        
        /* Card States */
        .card.solved { border-color: #22c55e; background: #f0fdf4; }
        .card.solved::after { content: '‚úì'; position: absolute; top: 20px; right: 20px; font-size: 24px; color: #22c55e; font-weight: 800; }
        
        .card.failed { border-color: #ef4444; background: #fef2f2; opacity: 0.9; }
        .card.failed::after { content: '‚úò'; position: absolute; top: 20px; right: 20px; font-size: 24px; color: #ef4444; font-weight: 800; }

        .q-tag { align-self: flex-start; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 0.5px; display: inline-block; }
        .tag-board { background: #e0f2fe; color: #0284c7; }
        .tag-ratio { background: #ffedd5; color: #c2410c; }
        .tag-vote { background: #dcfce7; color: #15803d; }
        .tag-ceo { background: #f1f5f9; color: #475569; }
        .tag-gov { background: #f3e8ff; color: #7e22ce; }
        .tag-comp { background: #fee2e2; color: #b91c1c; }
        .tag-structure { background: #fff7ed; color: #c2410c; }

        .q-text { font-size: 16px; font-weight: 600; line-height: 1.5; margin-bottom: 24px; color: #1e293b; flex-grow: 1; }
        
        .q-hint { font-size: 12px; color: #64748b; margin-bottom: 15px; font-style: italic; background: #f8fafc; padding: 8px 12px; border-radius: 8px; border: 1px dashed #e2e8f0; display: inline-block; width: 100%; }
        
        /* Inputs */
        input { width: 100%; padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 15px; font-family: 'Inter', monospace; outline: none; transition: 0.2s; color: #334155; background: #f8fafc; }
        input:focus { border-color: #3b82f6; background: white; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .solved input { border-color: #22c55e; color: #15803d; font-weight: 600; background: white; }
        .failed input { text-decoration: line-through; color: #ef4444; border-color: #ef4444; background: white; }

        /* Attempt Indicator */
        .attempts { font-size: 11px; font-weight: 700; color: #94a3b8; text-align: right; margin-top: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
        .attempts.warn { color: #f59e0b; }
        .attempts.crit { color: #ef4444; }
        
        /* MCQ Buttons */
        .mcq-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .mcq-opt { width: 100%; text-align: left; padding: 14px 16px; border: 2px solid #f1f5f9; border-radius: 12px; background: #f8fafc; cursor: pointer; font-size: 14px; transition: all 0.2s; color: #475569; font-weight: 500; }
        .mcq-opt:hover { background: #eef2ff; border-color: #cbd5e1; color: #1e293b; transform: translateY(-2px); }
        .mcq-opt.correct { background: #22c55e; color: white; border-color: #22c55e; box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3); }
        .mcq-opt.wrong { background: #ef4444; color: white; border-color: #ef4444; opacity: 0.8; }

        /* Visualization for At Risk Pay */
        .pay-viz { margin: 15px 0; background: #f1f5f9; height: 32px; border-radius: 16px; overflow: hidden; display: flex; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        .pay-bar { height: 100%; display: flex; align-items: center; justify-content: center; font-size: 11px; color: white; font-weight: 700; transition: width 1s ease-out; width: 0; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .bar-fixed { background: #94a3b8; }
        .bar-risk { background: #ef4444; }

        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.7); align-items: center; justify-content: center; z-index: 100; backdrop-filter: blur(8px); }
        .modal-content { background: white; padding: 40px; border-radius: 24px; width: 90%; max-width: 900px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; font-size: 14px; }
        th { text-align: left; color: #64748b; font-size: 11px; text-transform: uppercase; padding: 16px; border-bottom: 2px solid #e2e8f0; background: #f8fafc; position: sticky; top: 0; font-weight: 700; letter-spacing: 0.5px; }
        td { text-align: left; padding: 16px; border-bottom: 1px solid #f1f5f9; font-weight: 500; color: #334155; vertical-align: top; }
        tr:hover { background: #f8fafc; }

        .auth-view { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .auth-input { width: 250px; padding: 12px; margin-bottom: 16px; text-align: center; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; outline: none; }
        .auth-input:focus { border-color: #3b82f6; }
        .error-msg { color: #ef4444; font-size: 13px; font-weight: 600; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <aside>
        <div>
            <h1>Exploring DEF14A</h1>
            <p class="subtitle">Corporate Governance</p>
            
            <div class="nav-section">
                <div class="nav-label">Select Module</div>
                <div class="company-switch">
                    <div id="btn-aapl" class="switch-btn active aapl" onclick="switchCompany('aapl')">
                        <span style="font-size:18px;">üçè</span> Apple Inc.
                    </div>
                    <div id="btn-dis" class="switch-btn" onclick="switchCompany('dis')">
                        <span style="font-size:18px;">üè∞</span> Disney
                    </div>
                    <div id="btn-goog" class="switch-btn" onclick="switchCompany('goog')">
                        <span style="font-size:18px;">üîç</span> Alphabet
                    </div>
                    <div id="btn-comp" class="switch-btn" onclick="switchCompany('comp')">
                        <span style="font-size:18px;">‚öñÔ∏è</span> Comparison
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Time Remaining</div>
                <div id="timer" class="stat-value timer">25:00</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Score</div>
                <div id="score" class="stat-value">0</div>
            </div>
        </div>
        
        <div class="action-area">
            <button class="primary" onclick="resetGame()">üîÑ Reset Module</button>
            <button class="teacher-btn" onclick="openModal('teacherModal')">üîí Teacher Access</button>
            <button class="download-btn" onclick="downloadReport()">üì• Download Report</button>
        </div>
    </aside>

    <main>
        <!-- Apple Header -->
        <div id="header-aapl" class="header-banner aapl">
            <div>
                <h2 style="font-size: 24px; margin-bottom: 6px; font-weight: 800; color: #1f2937;">Apple Inc. (AAPL)</h2>
                <p style="color: #6b7280; font-size: 14px; font-weight: 500;">Proxy Analysis: Board Matrix, Pay Ratio, Proposals.</p>
            </div>
            <a href="https://www.sec.gov/ix?doc=/Archives/edgar/data/0000320193/000130817925000008/aapl4359751-def14a.htm" target="_blank" class="doc-link aapl">üìÑ Open 2025 Proxy</a>
        </div>

        <!-- Disney Header -->
        <div id="header-dis" class="header-banner dis" style="display:none;">
            <div>
                <h2 style="font-size: 24px; margin-bottom: 6px; font-weight: 800; color: #1e3a8a;">The Walt Disney Company (DIS)</h2>
                <p style="color: #64748b; font-size: 14px; font-weight: 500;">Proxy Analysis: Peer Groups, Governance, Compensation.</p>
            </div>
            <a href="https://www.sec.gov/ix?doc=/Archives/edgar/data/0001744489/000174448925000059/dis-20250123.htm" target="_blank" class="doc-link dis">üìÑ Open 2025 Proxy</a>
        </div>

        <!-- Alphabet Header -->
        <div id="header-goog" class="header-banner goog" style="display:none;">
            <div>
                <h2 style="font-size: 24px; margin-bottom: 6px; font-weight: 800; color: #b91c1c;">Alphabet Inc. (GOOG/GOOGL)</h2>
                <p style="color: #64748b; font-size: 14px; font-weight: 500;">Proxy Analysis: Dual-Class Stock, Moonshots, AI Governance.</p>
            </div>
            <a href="https://www.sec.gov/ix?doc=/Archives/edgar/data/0001652044/000130817925000511/goog012701-def14a.htm" target="_blank" class="doc-link goog">üìÑ Open 2025 Proxy</a>
        </div>

        <!-- Comparison Header -->
        <div id="header-comp" class="header-banner comp" style="display:none;">
            <div>
                <h2 style="font-size: 24px; margin-bottom: 6px; font-weight: 800; color: #6d28d9;">Cross-Company Analysis</h2>
                <p style="color: #64748b; font-size: 14px; font-weight: 500;">Comparing Governance Structures: Apple vs. Disney vs. Alphabet</p>
            </div>
            <div style="font-size:12px; color:#64748b; font-weight: 500;">Use all proxy links above</div>
        </div>

        <div class="instruction-banner">
            ‚ö†Ô∏è STRICT MODE: You have 2 attempts per question. <span class="alert-badge">2 STRIKES & OUT</span>
        </div>

        <div id="grid" class="grid"></div>
    </main>
</div>

<!-- Teacher Modal -->
<div id="teacherModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 20px;">
            <h2 style="margin:0; font-size: 24px; font-weight: 800; color: #0f172a;">Teacher Dashboard</h2>
            <button onclick="closeModal('teacherModal')" style="background:none; border:none; font-size:24px; cursor:pointer; color: #64748b;">&times;</button>
        </div>

        <!-- Auth View -->
        <div id="authView" class="auth-view">
            <div style="font-size: 48px; margin-bottom: 16px;">üîí</div>
            <p style="margin-bottom:24px; color:#64748b; font-size: 15px;">Enter instructor password to access keys.</p>
            <input type="password" id="teacherPass" class="auth-input" placeholder="Password">
            <button class="primary" style="width: auto; padding: 12px 40px;" onclick="checkTeacherPass()">Unlock</button>
            <div id="authError" class="error-msg">Incorrect Password</div>
        </div>

        <!-- Key View -->
        <div id="keyView" style="display:none; text-align:left;">
            <div style="background:#eff6ff; padding:16px; border-radius:12px; margin-bottom:24px; color:#1d4ed8; font-weight:600; font-size:14px; display: flex; align-items: center; gap: 12px; border: 1px solid #dbeafe;">
                <span style="font-size: 18px;">üîì</span> Access Granted: Master Answer Key
            </div>
            <div style="margin-bottom:24px; padding-bottom:16px; border-bottom:1px solid #f1f5f9;">
                <label style="font-size:12px; font-weight:700; color:#64748b; margin-right:12px; text-transform: uppercase; letter-spacing: 0.5px;">View Key For:</label>
                <select id="keySelect" onchange="renderKey()" style="padding:10px 16px; border-radius:10px; border:1px solid #cbd5e1; font-size: 14px; outline: none; color: #334155; font-weight: 600;">
                    <option value="aapl">Apple Inc.</option>
                    <option value="dis">Disney (DIS)</option>
                    <option value="goog">Alphabet (GOOG)</option>
                    <option value="comp">Comparison</option>
                </select>
            </div>
            <div style="overflow-x:auto;">
                <table id="keyTable">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Question</th>
                            <th>Correct Answer</th>
                            <th>Reference / Hint</th>
                        </tr>
                    </thead>
                    <tbody id="keyBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Reset Confirmation Modal -->
<div id="resetModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <h2 style="margin-bottom: 15px; font-size: 20px; color: #0f172a; font-weight: 800;">Reset Module?</h2>
        <p style="margin-bottom: 25px; color: #64748b;">Are you sure? All progress for this company will be lost.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="teacher-btn" style="width: auto; padding: 12px 20px;" onclick="closeModal('resetModal')">Cancel</button>
            <button class="primary" style="width: auto; padding: 12px 20px;" onclick="confirmReset()">Reset Now</button>
        </div>
    </div>
</div>

<!-- Name Input Modal -->
<div id="nameModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <h2 style="margin-bottom: 15px; font-size: 20px; color: #0f172a; font-weight: 800;">Download Report</h2>
        <p style="margin-bottom: 15px; color: #64748b;">Please enter your full name:</p>
        <input type="text" id="studentNameInput" class="auth-input" placeholder="Student Name" style="width: 100%; margin-bottom: 20px;">
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="teacher-btn" style="width: auto; padding: 12px 20px;" onclick="closeModal('nameModal')">Cancel</button>
            <button class="primary" style="width: auto; padding: 12px 20px;" onclick="confirmDownload()">Download</button>
        </div>
    </div>
</div>

<script>
// --- APPLE DATA (Existing) ---
const DATA_AAPL = [
    // Board Commitments
    { id: 101, cat: 'board', type: 'mcq', pts: 60, q: "According to Director Profiles, which Board member serves on NO other public company boards?", ans: "Art Levinson", opts: ["Art Levinson", "Tim Cook", "Ron Sugar", "Andrea Jung"], hint: "Refer to: Director Profiles section (look for Art Levinson's bio)" },
    { id: 102, cat: 'board', type: 'mcq', pts: 50, q: "Which director currently serves on the boards of both Amgen Inc. and Chevron Corporation?", ans: "Wanda Austin", opts: ["Wanda Austin", "Ron Sugar", "Andrea Jung", "Monica Lozano"], hint: "Refer to: Director Profiles section (look for Wanda Austin's bio)" },
    // CEO Pay Ratio
    { id: 201, cat: 'ratio', type: 'exact', pts: 60, q: "What was the 2024 annual total compensation of the median compensated employee?", ans: ["114738", "114,738", "$114,738"], hint: "Refer to: CEO Pay Ratio‚Äî2024 section (look for Median Employee)" },
    { id: 202, cat: 'ratio', type: 'exact', pts: 50, q: "What is the ratio of the CEO's compensation to the median employee's compensation?", ans: ["650", "650:1", "650 to 1"], hint: "Refer to: CEO Pay Ratio‚Äî2024 section (look for Ratio)" },
    // Board Diversity
    { id: 301, cat: 'board', type: 'mcq', pts: 40, q: "What percentage of the director nominees are women?", ans: "50%", opts: ["25%", "40%", "50%", "60%"], hint: "Refer to: Nominee Skills Matrix (count women vs total)" },
    // Comp Design
    { id: 401, cat: 'ceo', type: 'exact', pts: 50, q: "What was the 2024 Total Target CEO Compensation set by the Compensation Committee?", ans: ["59000000", "59,000,000", "$59 million"], hint: "Refer to: Executive Compensation section (Target Total Direct Compensation)" },
    { id: 402, cat: 'ceo', type: 'exact', pts: 40, q: "What is Mr. Cook's base salary? (It has remained the same since 2016)", ans: ["3000000", "3,000,000", "$3 million"], hint: "Refer to: Executive Compensation section (look for Base Salary)" },
    { id: 403, cat: 'ceo', type: 'mcq', pts: 50, q: "Which of these companies is NOT in Apple's Primary Peer Group?", ans: "Tesla", opts: ["Alphabet", "NVIDIA", "Tesla", "Disney"], hint: "Refer to: Executive Compensation section (look for Peer Group)" },
    // Proposals
    { id: 502, cat: 'vote', type: 'mcq', pts: 50, q: "In response to Proposal No. 4 (Ethical AI Report), what reason did Apple cite for voting AGAINST?", ans: "The proposal focuses criticisms on OpenAI/ChatGPT rather than Apple", opts: ["Apple does not use AI", "The proposal focuses criticisms on OpenAI/ChatGPT rather than Apple", "Too expensive", "No ethical AI principles"], hint: "Refer to: Proposal No. 4 section (look for Board's Statement in Opposition)" }
];

// --- DISNEY DATA (Existing) ---
const DATA_DIS = [
    // Board
    { id: 601, cat: 'board', type: 'mcq', pts: 50, q: "Who is the current Independent Chairman of the Board for Disney?", ans: "James P. Gorman", opts: ["Bob Iger", "James P. Gorman", "Mary Barra", "Safra Catz"], hint: "Refer to: Corporate Governance section (Board Leadership Structure)" },
    { id: 603, cat: 'board', type: 'mcq', pts: 40, q: "What percentage of board nominees identify as women?", ans: "42%", opts: ["33%", "42%", "50%", "55%"], hint: "Refer to: Proxy Summary section (Board Diversity, calculate 5/12)" },
    // Peer Groups
    { id: 604, cat: 'comp', type: 'mcq', pts: 60, q: "Disney uses two main peer groups for compensation. Which group includes companies like Microsoft, NIKE, and Oracle?", ans: "General Industry Peers", opts: ["Media Industry Peers", "General Industry Peers", "Performance Peers", "Technology Peers"], hint: "Refer to: Executive Compensation section (Summary of Peer Groups)" },
    { id: 605, cat: 'comp', type: 'mcq', pts: 50, q: "Which of the following is NOT a criterion for Disney's 'General Industry' peer group selection?", ans: "Must be headquartered in California", opts: ["Consumer orientation/strong brand", "Global presence", "Focus on technology", "Must be headquartered in California"], hint: "Refer to: Executive Compensation section (General Industry Peers criteria)" },
    // CEO Pay Ratio
    { id: 701, cat: 'ratio', type: 'exact', pts: 60, q: "What was the 2024 annual total compensation of the median Disney employee?", ans: ["63162", "63,162", "$63,162"], hint: "Refer to: CEO Pay Ratio section (look for Median Employee annual total compensation)" },
    { id: 702, cat: 'ratio', type: 'exact', pts: 50, q: "What is the ratio of CEO (Iger) compensation to the median employee?", ans: ["377", "377:1", "377 to 1"], hint: "Refer to: CEO Pay Ratio section (look for Ratio)" },
    // Comp Philosophy & Behavior
    { 
        id: 703, cat: 'comp', type: 'viz', pts: 80, 
        q: "Look at the chart below representing Bob Iger's 2024 Target Compensation. What percentage is 'At Risk' (Variable) vs. Fixed?", 
        ans: "94.2% At Risk", 
        opts: ["50% At Risk", "75% At Risk", "94.2% At Risk", "100% At Risk"], 
        hint: "Refer to: Executive Compensation section (Compensation at Risk chart)",
        viz: { fixed: 5.8, risk: 94.2 }
    },
    { 
        id: 704, cat: 'comp', type: 'mcq', pts: 100, 
        q: "Behavioral Analysis: With 94% of pay 'At Risk' and tied to stock/performance, how might this structure influence a CEO's decision making?", 
        ans: "Encourages focus on long-term stock growth and financial targets over guaranteed salary", 
        opts: ["Encourages safe, low-risk decisions to protect salary", "Encourages focus on long-term stock growth and financial targets over guaranteed salary", "Makes the CEO indifferent to stock price", "Focuses solely on employee satisfaction"], 
        hint: "Think: If your pay drops when stock drops, what do you prioritize?" 
    },
    // Proposals
    { id: 801, cat: 'vote', type: 'mcq', pts: 50, q: "What is the Board's recommendation for the shareholder proposal regarding 'Political Expenditure Congruency Report'?", ans: "AGAINST", opts: ["FOR", "AGAINST", "ABSTAIN", "No Recommendation"], hint: "Refer to: Shareholder Proposals section (Proposal 4)" }
];

// --- ALPHABET DATA (New) ---
const DATA_GOOG = [
    // Dual Class
    { id: 1001, cat: 'structure', type: 'mcq', pts: 70, q: "How many votes per share does Class B Common Stock carry compared to Class A?", ans: "10 Votes", opts: ["1 Vote (Same)", "2 Votes", "10 Votes", "20 Votes"], hint: "Refer to: General Information section (Voting Rights)" },
    { id: 1002, cat: 'structure', type: 'mcq', pts: 60, q: "Who controls the majority of the voting power due to this dual-class structure?", ans: "Larry Page and Sergey Brin", opts: ["Sundar Pichai", "Larry Page and Sergey Brin", "Institutional Investors", "The Board of Directors"], hint: "Refer to: General Information section (Voting Power of Class B stockholders)" },
    // Governance
    { id: 1003, cat: 'gov', type: 'mcq', pts: 50, q: "Alphabet has a specialized committee to oversee its AI development. What is it called?", ans: "Compliance and Risk Committee", opts: ["AI Safety Board", "Technology Committee", "Compliance and Risk Committee", "Innovation Audit Committee"], hint: "Refer to: Corporate Governance section (Board Committees)" },
    // Other Bets
    { id: 1004, cat: 'comp', type: 'mcq', pts: 50, q: "In financial reporting and compensation, Alphabet distinguishes 'Google Services' from high-risk, high-reward projects known as:", ans: "Other Bets", opts: ["Moonshots", "Other Bets", "Alpha Projects", "Venture Investments"], hint: "Refer to: Proxy Summary or Executive Compensation section" }
];

// --- COMPARISON DATA (Expanded) ---
const DATA_COMP = [
    { id: 901, cat: 'gov', type: 'mcq', pts: 100, q: "Compare Board Leadership: How do the structures differ?", ans: "Disney has an Independent Chair; Apple has an Independent Lead Director", opts: ["Both have Independent Chairs", "Disney has an Independent Chair; Apple has an Independent Lead Director", "Apple has an Independent Chair; Disney has a Lead Director", "Both CEOs also serve as Chairman"], hint: "Refer to: 'Board Leadership Structure' in both proxies" },
    { id: 902, cat: 'gov', type: 'mcq', pts: 80, q: "Compare Pay Ratios: Which company has the widest gap between CEO and Median Employee pay?", ans: "Apple (650:1)", opts: ["Apple (650:1)", "Disney (377:1)", "Alphabet (approx 400:1)", "They are all equal"], hint: "Refer to: 'CEO Pay Ratio' section in each proxy" },
    { id: 903, cat: 'structure', type: 'mcq', pts: 100, q: "Structure Analysis: Which of the three companies utilizes a Dual-Class Stock structure giving founders super-voting rights?", ans: "Alphabet (Google) only", opts: ["Apple only", "Disney only", "Alphabet (Google) only", "Both Apple and Alphabet"], hint: "Refer to: 'Voting Securities' or 'Description of Capital Stock' in each proxy" }
];

let currentCompany = 'aapl';
let state = {
    aapl: { score: 0, attempts: {}, solved: {} },
    dis: { score: 0, attempts: {}, solved: {} },
    goog: { score: 0, attempts: {}, solved: {} },
    comp: { score: 0, attempts: {}, solved: {} }
};

let timeLeft = 25 * 60; // 25 minutes in seconds

// Initialize attempts
[...DATA_AAPL, ...DATA_DIS, ...DATA_GOOG, ...DATA_COMP].forEach(q => {
    state.aapl.attempts[q.id] = 0;
    state.dis.attempts[q.id] = 0;
    state.goog.attempts[q.id] = 0;
    state.comp.attempts[q.id] = 0;
    
    state.aapl.solved[q.id] = false;
    state.dis.solved[q.id] = false;
    state.goog.solved[q.id] = false;
    state.comp.solved[q.id] = false;
});

function switchCompany(company) {
    currentCompany = company;
    
    // Update UI toggles
    document.querySelectorAll('.switch-btn').forEach(btn => {
        btn.classList.remove('active', 'aapl', 'dis', 'goog', 'comp');
        // Re-add active class logic based on current company
        if (btn.id === `btn-${company}`) {
            btn.classList.add('active', company);
        }
    });
    
    // Update Header
    document.querySelectorAll('.header-banner').forEach(el => el.style.display = 'none');
    document.getElementById(`header-${company}`).style.display = 'flex';
    
    // Update Score Display
    document.getElementById('score').innerText = state[company].score;
    
    // Render Grid
    init();
}

function init() {
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    
    let data;
    if(currentCompany === 'aapl') data = DATA_AAPL;
    else if(currentCompany === 'dis') data = DATA_DIS;
    else if(currentCompany === 'goog') data = DATA_GOOG;
    else data = DATA_COMP;
    
    data.forEach(item => {
        if(state[currentCompany].attempts[item.id] === undefined) {
            state[currentCompany].attempts[item.id] = 0;
        }

        const div = document.createElement('div');
        div.className = 'card';
        div.id = `card-${item.id}`;
        
        const attempts = state[currentCompany].attempts[item.id];
        const isSolved = state[currentCompany].solved[item.id];
        
        let content = `
            <span class="q-tag tag-${item.cat}">${getCatLabel(item.cat)}</span>
            <div class="q-text">${item.q}</div>
            <div class="q-hint">üí° Hint: ${item.hint}</div>
        `;

        if (item.type === 'viz') {
            content += `
                <div class="pay-viz">
                    <div class="pay-bar bar-fixed" style="width: ${item.viz.fixed}%">Fixed ${item.viz.fixed}%</div>
                    <div class="pay-bar bar-risk" style="width: ${item.viz.risk}%">At Risk ${item.viz.risk}%</div>
                </div>
                <div class="mcq-grid" style="margin-top:15px;">
                    ${item.opts.map(opt => `<button class="mcq-opt" onclick="handleMCQ(this, ${item.id}, '${opt}')">${opt}</button>`).join('')}
                </div>
            `;
        }
        else if (item.type === 'exact') {
            content += `
                <input type="text" placeholder="Type value & press Enter ‚Üµ" 
                    onkeydown="handleInput(event, ${item.id})">
            `;
        } else {
            content += `<div class="mcq-grid">` + item.opts.map(opt => 
                `<button class="mcq-opt" onclick="handleMCQ(this, ${item.id}, '${opt}')">${opt}</button>`
            ).join('') + `</div>`;
        }

        content += `<div class="attempts" id="attempts-${item.id}">Attempts: ${attempts}/2</div>`;
        div.innerHTML = content;
        grid.appendChild(div);
        
        // Restore solved state
        if(isSolved) {
            div.classList.add('solved');
            const input = div.querySelector('input');
            if(input) {
                input.disabled = true;
                input.classList.add('solved');
                input.value = "‚úì Correct";
            }
            const btns = div.querySelectorAll('.mcq-opt');
            btns.forEach(b => {
                b.disabled = true;
                if(b.innerText === item.ans) b.classList.add('correct');
            });
        }
        else if(attempts >= 2) {
            fail(item.id, true);
        }
    });
}

function getCatLabel(cat) {
    if(cat === 'board') return 'Board Gov';
    if(cat === 'ratio') return 'Pay Ratio';
    if(cat === 'vote') return 'Voting';
    if(cat === 'gov') return 'Governance';
    if(cat === 'comp') return 'Comp Strategy';
    if(cat === 'structure') return 'Stock Structure';
    return 'Comp Structure';
}

function handleInput(e, id) {
    if (e.key !== 'Enter') return;
    const input = e.target;
    
    let data;
    if(currentCompany === 'aapl') data = DATA_AAPL;
    else if(currentCompany === 'dis') data = DATA_DIS;
    else if(currentCompany === 'goog') data = DATA_GOOG;
    else data = DATA_COMP;

    const item = data.find(d => d.id === id);
    
    if(state[currentCompany].attempts[id] >= 2) return;

    const cleanVal = input.value.replace(/[$,%]/g, '').trim().toLowerCase();
    const isCorrect = item.ans.some(a => a.toString().replace(/[$,%]/g, '').trim().toLowerCase() === cleanVal);
    
    if (isCorrect) {
        success(id, item.pts);
        input.disabled = true;
        input.classList.add('solved');
        input.value = "‚úì " + input.value;
    } else {
        fail(id);
        input.value = ''; 
        input.placeholder = 'Try again...';
    }
}

function handleMCQ(btn, id, selected) {
    let data;
    if(currentCompany === 'aapl') data = DATA_AAPL;
    else if(currentCompany === 'dis') data = DATA_DIS;
    else if(currentCompany === 'goog') data = DATA_GOOG;
    else data = DATA_COMP;

    const item = data.find(d => d.id === id);
    
    if(state[currentCompany].attempts[id] >= 2) return;

    if (selected === item.ans) {
        btn.classList.add('correct');
        success(id, item.pts);
        const parent = btn.parentNode;
        Array.from(parent.children).forEach(child => child.disabled = true);
    } else {
        btn.classList.add('wrong');
        btn.disabled = true;
        fail(id);
    }
}

function success(id, pts) {
    const card = document.getElementById(`card-${id}`);
    if(!card.classList.contains('solved')) {
        card.classList.add('solved');
        state[currentCompany].score += pts;
        state[currentCompany].solved[id] = true;
        document.getElementById('score').innerText = state[currentCompany].score;
    }
}

function fail(id, restoreOnly = false) {
    if(!restoreOnly) {
        state[currentCompany].attempts[id]++;
    }
    
    const attempts = state[currentCompany].attempts[id];
    const el = document.getElementById(`attempts-${id}`);
    el.innerText = `Attempts: ${attempts}/2`;
    
    const card = document.getElementById(`card-${id}`);
    
    let data;
    if(currentCompany === 'aapl') data = DATA_AAPL;
    else if(currentCompany === 'dis') data = DATA_DIS;
    else if(currentCompany === 'goog') data = DATA_GOOG;
    else data = DATA_COMP;
    
    if (attempts >= 2) {
        card.classList.add('failed');
        el.innerText = "LOCKED - 0 PTS";
        el.classList.add('crit');
        
        const input = card.querySelector('input');
        if(input) {
            input.disabled = true;
            input.classList.add('failed');
            input.value = `Ans: ${data.find(d=>d.id===id).ans[0] || data.find(d=>d.id===id).ans}`;
        }
        
        const btns = card.querySelectorAll('.mcq-opt');
        btns.forEach(b => b.disabled = true);
    } else if (!restoreOnly) {
        el.classList.add('warn');
        card.classList.add('shake');
        setTimeout(() => card.classList.remove('shake'), 400);
    }
}

function startTimer() {
    const el = document.getElementById('timer');
    setInterval(() => {
        if(timeLeft > 0) {
            timeLeft--;
            const m = Math.floor(timeLeft / 60);
            const s = (timeLeft % 60).toString().padStart(2, '0');
            el.innerText = `${m}:${s}`;
        }
    }, 1000);
}

// === NEW MODAL FUNCTIONS ===

function openModal(id) {
    document.getElementById(id).style.display = 'flex';
}

function closeModal(id) {
    document.getElementById(id).style.display = 'none';
}

// Reset Logic using Custom Modal
function resetGame() {
    openModal('resetModal');
}

function confirmReset() {
    closeModal('resetModal');
    
    // Reset state for current company only
    state[currentCompany].score = 0;
    
    let data;
    if(currentCompany === 'aapl') data = DATA_AAPL;
    else if(currentCompany === 'dis') data = DATA_DIS;
    else if(currentCompany === 'goog') data = DATA_GOOG;
    else data = DATA_COMP;
    
    data.forEach(q => {
        state[currentCompany].attempts[q.id] = 0;
        state[currentCompany].solved[q.id] = false;
    });
    
    document.getElementById('score').innerText = 0;
    
    // Reset Timer to 25 minutes
    timeLeft = 25 * 60;
    document.getElementById('timer').innerText = "25:00";

    // Force complete re-render
    init();
}

// Download Logic using Custom Modal
function downloadReport() {
    openModal('nameModal');
    setTimeout(() => {
        document.getElementById('studentNameInput').focus();
    }, 100);
}

function confirmDownload() {
    const studentName = document.getElementById('studentNameInput').value.trim();
    
    if (!studentName) {
        alert("Please enter a name to continue.");
        return;
    }
    
    closeModal('nameModal');
    document.getElementById('studentNameInput').value = ''; // Clear input

    let report = "PROXY ANALYSIS REPORT\n";
    report += `Student Name: ${studentName}\n`;
    report += `Date: ${new Date().toLocaleDateString()}\n`;
    report += "----------------------------------------\n\n";

    const companies = [
        { code: 'aapl', name: 'Apple Inc.', data: DATA_AAPL },
        { code: 'dis', name: 'Disney', data: DATA_DIS },
        { code: 'goog', name: 'Alphabet', data: DATA_GOOG },
        { code: 'comp', name: 'Comparison', data: DATA_COMP }
    ];

    let totalScore = 0;

    companies.forEach(comp => {
        report += `### ${comp.name}\n`;
        const s = state[comp.code];
        report += `Score: ${s.score}\n`;
        
        // Detailed attempt breakdown
        comp.data.forEach(q => {
            const attempts = s.attempts[q.id];
            const isSolved = s.solved[q.id];
            
            let status = "Not Attempted";
            if (isSolved) status = "Correct";
            else if (attempts >= 2) status = "Failed";
            else if (attempts > 0) status = "In Progress";
            
            report += `  - Q${q.id} [${status}]: ${attempts}/2 attempts\n`;
        });
        report += "\n";
        totalScore += s.score;
    });

    report += "----------------------------------------\n";
    report += `FINAL TOTAL SCORE: ${totalScore}\n`;

    const blob = new Blob([report], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${studentName.replace(/\s+/g, '_')}_Proxy_Report.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// --- TEACHER MODE FUNCTIONS ---
// (Refactored to use new modal helper)
function checkTeacherPass() {
    const pass = document.getElementById('teacherPass').value;
    if (pass.toLowerCase() === 'teacher') {
        document.getElementById('authView').style.display = 'none';
        document.getElementById('keyView').style.display = 'block';
        renderKey();
    } else {
        document.getElementById('authError').style.display = 'block';
    }
}

function renderKey() {
    const selectedComp = document.getElementById('keySelect').value;
    const tbody = document.getElementById('keyBody');
    
    let data;
    if(selectedComp === 'aapl') data = DATA_AAPL;
    else if(selectedComp === 'dis') data = DATA_DIS;
    else if(selectedComp === 'goog') data = DATA_GOOG;
    else data = DATA_COMP;
    
    tbody.innerHTML = '';
    
    data.forEach(item => {
        const tr = document.createElement('tr');
        let displayAns = item.ans;
        if(Array.isArray(item.ans)) displayAns = item.ans[item.ans.length-1]; 
        
        tr.innerHTML = `
            <td style="font-weight:bold; color:#3b82f6;">${getCatLabel(item.cat)}</td>
            <td>${item.q}</td>
            <td style="font-family:monospace; font-weight:bold;">${displayAns}</td>
            <td style="color:#64748b; font-size:12px;">${item.hint}</td>
        `;
        tbody.appendChild(tr);
    });
}

// Init Game
startTimer();
init();
</script>

</body>
</html>